(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const Iu={cellSize:8,borderSize:0},ii={grid:Iu},Fu=30,Lu={r:0,g:0,b:0,a:1},Ar={fps:Fu,clearColor:Lu},Ou=8,zr={workgroupSize:Ou},Pu=30,Bu=50,Du=1,Rr={tickRate:Pu,decay:Bu,brushSize:Du};function di(n){n&&typeof n=="object"&&Object.keys(n).forEach(t=>{di(n[t])}),Object.freeze(n)}function ku(){return ii.grid.cellRatio=1-ii.grid.borderSize/ii.grid.cellSize,di(ii),di(Ar),di(zr),di(Rr),{core:ii,renderer:Ar,simulation:zr,input:Rr}}const Uu=`struct VertexInput {\r
    @location(0) pos: vec2f,\r
    @builtin(instance_index) instance: u32,\r
};\r
\r
struct VertexOutput {\r
    @builtin(position) pos: vec4f,\r
    @location(0) cell: vec2f,\r
    @location(1) state: f32, \r
};\r
\r
@group(0) @binding(0) var<uniform> grid: vec2f;\r
@group(0) @binding(1) var<storage> cellState: array<f32>;\r
@group(0) @binding(2) var<storage> inputArray: array<f32>;\r
\r
@vertex\r
fn vertexMain(input: VertexInput) -> VertexOutput {\r
    let i = f32(input.instance);\r
    let cell = vec2f(i % grid.x, floor(i / grid.x));\r
\r
    var state = cellState[input.instance];\r
    let userInput = inputArray[input.instance];\r
    state = max(state, userInput); \r
\r
    let cellOffset = cell / grid * 2;\r
    let gridPos = (input.pos + 1) / grid - 1 + cellOffset;\r
    \r
    var output: VertexOutput;\r
    output.pos = vec4f(gridPos, 0, 1);\r
    output.cell = cell;\r
    output.state = state; \r
    return output;\r
}\r
\r
struct FragInput {\r
    @location(0) cell: vec2f,\r
    @location(1) state: f32, \r
};\r
\r
@fragment\r
fn fragmentMain(input: FragInput) -> @location(0) vec4f {\r
    let state = clamp(input.state, 0.0, 1.0); \r
\r
    // if (state <= 0.01) {\r
    //     return vec4f(0.0, 0.0, 0.0, 1.0); \r
    // }\r
\r
    let shiftedState = pow(state, 0.85);\r
\r
    // let r = smoothstep(0.55, 1.05 - 0.15 * shiftedState, shiftedState) ; \r
    // let g = smoothstep(0.2, 0.85 - 0.15 * shiftedState, shiftedState) ; \r
    // let b = smoothstep(0.0, 0.55 - 0.2 * shiftedState, 1.0 - shiftedState); \r
\r
    let r = shiftedState + 0.2;\r
    let g = shiftedState + 0.2;\r
    let b = shiftedState + 0.3;\r
\r
    return vec4f(r * 0.5, g * 0.9, b, 1.0);\r
}`,Gu=`@group(0) @binding(0) var myTexture: texture_2d<f32>;\r
@group(0) @binding(1) var mySampler: sampler;\r
\r
struct VertexOutput {\r
    @builtin(position) pos: vec4f,\r
    @location(0) uv: vec2f,\r
};\r
\r
@vertex\r
fn vertexMain(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput {\r
    let positions = array(\r
        vec2f(-1.0, -1.0), vec2f( 1.0, -1.0), vec2f(-1.0,  1.0),\r
        vec2f(-1.0,  1.0), vec2f( 1.0, -1.0), vec2f( 1.0,  1.0)\r
    );\r
\r
    let uvs = array(\r
        vec2f(0.0, 1.0), vec2f(1.0, 1.0), vec2f(0.0, 0.0),\r
        vec2f(0.0, 0.0), vec2f(1.0, 1.0), vec2f(1.0, 0.0)\r
    );\r
\r
    var output: VertexOutput;\r
    output.pos = vec4f(positions[vertexIndex], 0.0, 1.0);\r
    output.uv = uvs[vertexIndex];\r
    return output;\r
}\r
\r
@fragment\r
// fn fragmentMain(input: VertexOutput) -> @location(0) vec4f {\r
//         let texSize = vec2f(textureDimensions(myTexture));\r
//     let uv = input.uv;\r
\r
//     let offsets = array(\r
//         vec2f(-10.0,  0.0), vec2f(-9.0,  0.0), vec2f(-8.0,  0.0), vec2f(-7.0,  0.0),\r
//         vec2f(-6.0,  0.0), vec2f(-5.0,  0.0), vec2f(-4.0,  0.0), vec2f(-3.0,  0.0),\r
//         vec2f(-2.0,  0.0), vec2f(-1.0,  0.0), vec2f( 0.0,  0.0), vec2f( 1.0,  0.0),\r
//         vec2f( 2.0,  0.0), vec2f( 3.0,  0.0), vec2f( 4.0,  0.0), vec2f( 5.0,  0.0),\r
//         vec2f( 6.0,  0.0), vec2f( 7.0,  0.0), vec2f( 8.0,  0.0), vec2f( 9.0,  0.0),\r
//         vec2f(10.0,  0.0)\r
//     );\r
\r
//     let weights = array<f32, 21>(\r
//         0.004, 0.007, 0.012, 0.017, 0.025, 0.035, 0.045, 0.055, 0.065, 0.075,\r
//         0.085, 0.075, 0.065, 0.055, 0.045, 0.035, 0.025, 0.017, 0.012, 0.007, 0.004\r
//     );\r
\r
//     var color = vec4f(0.0);\r
//     for (var i = 0; i < 21; i++) {\r
//         color += textureSample(myTexture, mySampler, uv + offsets[i] / texSize) * weights[i];\r
//     }\r
\r
//     return color;\r
// }\r
\r
fn fragmentMain(input: VertexOutput) -> @location(0) vec4f {\r
    let texSize = vec2f(textureDimensions(myTexture));\r
    let uv = input.uv;\r
\r
    let offsets = array(\r
        vec2f(-1.0,  0.0), vec2f(1.0,  0.0),\r
        vec2f( 0.0, -1.0), vec2f(0.0,  1.0),\r
        vec2f( 0.0,  0.0)\r
    );\r
\r
    let weights = array<f32, 5>(\r
        0.2, 0.2, \r
        0.2, 0.2, \r
        0.2\r
    );\r
\r
    var color = vec4f(0.0);\r
    for (var i = 0; i < 5; i++) {\r
        color += textureSample(myTexture, mySampler, uv + offsets[i] / texSize) * weights[i];\r
    }\r
\r
    return color;\r
}`;class Vr{constructor(t,e){this.width=t,this.height=e,this.cells=new Float32Array(t*e)}Get(t,e){return this.cells[e*this.width+t]}Set(t,e,s){this.cells[e*this.width+t]=s}Clear(){this.cells.fill(0)}Randomize(){for(let t=0;t<this.cells.length;t++)this.cells[t]=Math.random()<.5?0:1}GetArray(){return this.cells}SetArray(t){this.cells=t}}const Wu=`@group(0) @binding(0) var<uniform> grid: vec2f;\r
\r
@group(0) @binding(1) var<storage> pressureIn: array<f32>;\r
@group(0) @binding(2) var<storage> userInput: array<f32>;\r
@group(0) @binding(3) var<storage, read_write> pressureOut: array<f32>;\r
\r
const WAVE_SPEED: f32 = 1.5;\r
const DAMPING: f32 = 0.995;\r
\r
fn reflectBoundary(coord: i32, maxSize: i32) -> u32 {\r
    return u32(clamp(coord, 0, maxSize - 1)); \r
}\r
\r
fn cellIndex(cell: vec2i) -> u32 {\r
    let x = reflectBoundary(cell.x, i32(grid.x));\r
    let y = reflectBoundary(cell.y, i32(grid.y));\r
    return y * u32(grid.x) + x;\r
}\r
\r
fn cellValue(x: i32, y: i32) -> f32 {\r
    return max(pressureIn[cellIndex(vec2i(x, y))], userInput[cellIndex(vec2i(x, y))]);\r
}\r
\r
@compute\r
@workgroup_size(\${WORKGROUP_SIZE}, \${WORKGROUP_SIZE})\r
fn computeMain(@builtin(global_invocation_id) cell: vec3u) {\r
    let cellPos = vec2i(i32(cell.x), i32(cell.y));\r
\r
    let avgNeighbors = (cellValue(cellPos.x+1, cellPos.y) +\r
                        cellValue(cellPos.x-1, cellPos.y) +\r
                        cellValue(cellPos.x, cellPos.y+1) +\r
                        cellValue(cellPos.x, cellPos.y-1)) * 0.25;\r
\r
    let i = cellIndex(cellPos);\r
    let current = pressureIn[i];\r
    let previous = pressureOut[i];\r
\r
    var newPressure: f32 = (2.0 * current - previous) + (WAVE_SPEED * (avgNeighbors - current));\r
    newPressure *= DAMPING;\r
\r
    pressureOut[i] = newPressure;\r
}`;function qu(n,t){const e=Wu.replace(/\$\{WORKGROUP_SIZE\}/g,t.simulation.workgroupSize),s=n.gpu.device.createShaderModule({label:"Simulation Shader Module",code:e}),i=n.gpu.device.createComputePipeline({label:"Simulation Pipeline",layout:n.layouts.pipelineLayout,compute:{module:s,entryPoint:"computeMain"}});return n.simulationPipeline=i,n}async function Hu(n){const t={};if(!navigator.gpu)throw new Error("WebGPU is not supported");if(t.adapter=await navigator.gpu.requestAdapter(),!t.adapter)throw new Error("No adapter found");return t.device=await t.adapter.requestDevice(),n.gpu=t,n}function ju(n){const t={};return n.canvas=t,t.canvas=document.querySelector("canvas"),t.context=t.canvas.getContext("webgpu"),t.canvasFormat=navigator.gpu.getPreferredCanvasFormat(),t.context.configure({device:n.gpu.device,format:t.canvasFormat}),Cr(n),window.addEventListener("resize",()=>{Cr(n)}),n}function Cr(n){const t=n.canvas;return t.rect=t.canvas.getBoundingClientRect(),t.width=t.rect.width,t.height=t.rect.height,t.top=t.rect.top,t.bottom=t.rect.bottom,t.left=t.rect.left,t.right=t.rect.right,t.x=t.rect.x,t.y=t.rect.y,t.gridWidth=Math.floor(t.width/n.config.core.grid.cellSize),t.gridHeight=Math.floor(t.height/n.config.core.grid.cellSize),n}function Xu(n){const t={};return n.layouts=t,t.bindGroupLayout=$u(n),t.pipelineLayout=Yu(n),n}function $u(n){return n.gpu.device.createBindGroupLayout({label:"Bind Group Layout",entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT|GPUShaderStage.COMPUTE,buffer:{}},{binding:1,visibility:GPUShaderStage.VERTEX|GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.VERTEX|GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]})}function Yu(n){return n.gpu.device.createPipelineLayout({label:"Pipeline Layout",bindGroupLayouts:[n.layouts.bindGroupLayout]})}function th(n,t){return n.tickRate=t,n}function eh(n){const t={arrayStride:8,attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]},e=n.gpu.device.createShaderModule({label:"Shader Module",code:Uu});return n.gpu.device.createRenderPipeline({label:"Pipeline",layout:n.layouts.pipelineLayout,vertex:{module:e,entryPoint:"vertexMain",buffers:[t]},fragment:{module:e,entryPoint:"fragmentMain",targets:[{format:n.canvas.canvasFormat}]}})}async function Zu(n){const t=n.gpu.device,e=t.createShaderModule({code:Gu}),s=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:"filtering"}}]}),i=t.createPipelineLayout({bindGroupLayouts:[s]});return{blurPipeline:t.createRenderPipeline({layout:i,vertex:{module:e,entryPoint:"vertexMain"},fragment:{module:e,entryPoint:"fragmentMain",targets:[{format:n.canvas.canvasFormat}]},primitive:{topology:"triangle-list"}}),blurBindGroupLayout:s}}function sh(n,t){const e=n.gpu.device.createBuffer({label:"Cell Vertices",size:t.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});return n.gpu.device.queue.writeBuffer(e,0,t),{buffer:e,tris:t}}function ih(n,t){const e=sh(n,t);return n.vertices=e,n}function nh(n,t,e){const s=new Float32Array([t,e]),i=n.gpu.device.createBuffer({label:"Uniforms",size:s.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});return n.gpu.device.queue.writeBuffer(i,0,s),i}function Wn(n,t,e){console.log("stateArray type:",t.constructor.name);const s=n.gpu.device.createBuffer({label:e||"State Storage",size:t.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});return n.gpu.device.queue.writeBuffer(s,0,t),s}function Co(n,t){const e=t.map((i,o)=>({binding:o,resource:{buffer:i}}));return n.gpu.device.createBindGroup({label:"Grid Bind Group",layout:n.layouts.bindGroupLayout,entries:e})}function Ju(n,t,e){const s=n.gpu.device,i=s.createSampler({magFilter:"linear",minFilter:"linear"});return s.createBindGroup({layout:e,entries:[{binding:0,resource:t},{binding:1,resource:i}]})}function Qu(n){return n.gpu.device.createTexture({size:{width:n.canvas.width,height:n.canvas.height},format:n.canvas.canvasFormat,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}).createView()}async function oh(n){const t={renderStep:0};t.config=n,await Hu(t),ju(t),Xu(t),t.pipeline=eh(t),qu(t,n),t.uniformBuffer=nh(t,t.canvas.gridWidth,t.canvas.gridHeight),t.stateGrid=new Vr(t.canvas.gridWidth,t.canvas.gridHeight),t.cellStateArray=t.stateGrid.GetArray(),t.cellStateBuffers=[Wn(t,t.cellStateArray,"Cell State A"),Wn(t,t.cellStateArray,"Cell State B")],t.inputGrid=new Vr(t.canvas.gridWidth,t.canvas.gridHeight),t.drawArray&&t.inputGrid.SetArray(t.drawArray),t.inputStateArray=t.inputGrid.GetArray(),t.inputStateBuffer=Wn(t,t.inputStateArray,"Input State"),t.renderTarget=Qu(t);const{blurPipeline:e,blurBindGroupLayout:s}=await Zu(t);return t.postPipeline=e,t.blurBindGroupLayout=s,t.postBindGroup=Ju(t,t.renderTarget,t.blurBindGroupLayout),t}function rh(n){const t=[Co(n,[n.uniformBuffer,n.cellStateBuffers[0],n.inputStateBuffer,n.cellStateBuffers[1]]),Co(n,[n.uniformBuffer,n.cellStateBuffers[1],n.inputStateBuffer,n.cellStateBuffers[0]])];n.bindGroups=t}function ah(n,t,e){const s=n.gpu.device.createCommandEncoder(),i=s.beginComputePass();i.setPipeline(n.simulationPipeline),i.setBindGroup(0,n.bindGroups[n.renderStep%2]);const o=n.config.simulation.workgroupSize,r=Math.ceil(n.canvas.gridWidth/o),a=Math.ceil(n.canvas.gridHeight/o);i.dispatchWorkgroups(r,a),i.end();const h=s.beginRenderPass({colorAttachments:[{view:n.renderTarget,loadOp:"clear",clearValue:n.config.renderer.clearColor,storeOp:"store"}]});h.setPipeline(n.pipeline),h.setVertexBuffer(0,n.vertices.buffer),h.setBindGroup(0,e),h.draw(n.vertices.tris.length/2,t),h.end();const c=s.beginRenderPass({colorAttachments:[{view:n.canvas.context.getCurrentTexture().createView(),loadOp:"load",clearValue:n.config.renderer.clearColor,storeOp:"store"}]});c.setPipeline(n.postPipeline),c.setBindGroup(0,n.postBindGroup),c.draw(6),c.end(),n.gpu.device.queue.submit([s.finish()])}function Ku(n){const t=n.inputStateBuffer;n.gpu.device.queue.writeBuffer(t,0,n.drawArray)}function td(n,t){n.renderStep++,Ku(n),ah(n,n.canvas.gridWidth*n.canvas.gridHeight,n.bindGroups[n.renderStep%2])}const ed=Object.freeze(Object.defineProperty({__proto__:null,AddVertices:ih,CreateBindGroup:Co,CreatePipeline:eh,CreateUniformBuffer:nh,CreateVertexBuffer:sh,Init:oh,PreRender:rh,Render:ah,SetTickRate:th,Tick:td},Symbol.toStringTag,{value:"Module"})),Er={VERTEX:"vertex"},st={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},_n=["x","y","z","w"];/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const hh="165",Eo=0,ch=1,Ir=1,Fr=100,Lr=204,Or=205,Pr=3,sr=0,yi=0,sd=1,id=2,nd=3,od=4,rd=6,lh=300,Br=1e3,pi=1001,Dr=1002,$e=1003,uh=1006,dh=1008,ad=1009,hd=1014,ph=1015,cd=1016,ld=1020,ud=1023,qn=1026,kr=1027,Ye=0,dd=1,mh="",Ce="srgb",$s="srgb-linear",pd="display-p3",fh="display-p3-linear",Io="linear",Ur="srgb",Gr="rec709",Wr="p3",Ns=7680,qr=519,md=513,fd=515,pn=35044,Fo=35048,Ie=2e3,xi=2001;class ms{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const i=this._listeners[t];if(i!==void 0){const o=i.indexOf(e);o!==-1&&i.splice(o,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const s=this._listeners[t.type];if(s!==void 0){t.target=this;const i=s.slice(0);for(let o=0,r=i.length;o<r;o++)i[o].call(this,t);t.target=null}}}const Ct=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Hr=1234567;const mi=Math.PI/180,Ni=180/Math.PI;function Le(){const n=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(Ct[n&255]+Ct[n>>8&255]+Ct[n>>16&255]+Ct[n>>24&255]+"-"+Ct[t&255]+Ct[t>>8&255]+"-"+Ct[t>>16&15|64]+Ct[t>>24&255]+"-"+Ct[e&63|128]+Ct[e>>8&255]+"-"+Ct[e>>16&255]+Ct[e>>24&255]+Ct[s&255]+Ct[s>>8&255]+Ct[s>>16&255]+Ct[s>>24&255]).toLowerCase()}function It(n,t,e){return Math.max(t,Math.min(e,n))}function ir(n,t){return(n%t+t)%t}function gd(n,t,e,s,i){return s+(n-t)*(i-s)/(e-t)}function yd(n,t,e){return n!==t?(e-n)/(t-n):0}function fi(n,t,e){return(1-e)*n+e*t}function xd(n,t,e,s){return fi(n,t,1-Math.exp(-e*s))}function Nd(n,t=1){return t-Math.abs(ir(n,t*2)-t)}function Md(n,t,e){return n<=t?0:n>=e?1:(n=(n-t)/(e-t),n*n*(3-2*n))}function wd(n,t,e){return n<=t?0:n>=e?1:(n=(n-t)/(e-t),n*n*n*(n*(n*6-15)+10))}function Td(n,t){return n+Math.floor(Math.random()*(t-n+1))}function vd(n,t){return n+Math.random()*(t-n)}function Sd(n){return n*(.5-Math.random())}function bd(n){n!==void 0&&(Hr=n);let t=Hr+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function _d(n){return n*mi}function Ad(n){return n*Ni}function zd(n){return(n&n-1)===0&&n!==0}function Rd(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Vd(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function Cd(n,t,e,s,i){const o=Math.cos,r=Math.sin,a=o(e/2),h=r(e/2),c=o((t+s)/2),l=r((t+s)/2),u=o((t-s)/2),d=r((t-s)/2),p=o((s-t)/2),m=r((s-t)/2);switch(i){case"XYX":n.set(a*l,h*u,h*d,a*c);break;case"YZY":n.set(h*d,a*l,h*u,a*c);break;case"ZXZ":n.set(h*u,h*d,a*l,a*c);break;case"XZX":n.set(a*l,h*m,h*p,a*c);break;case"YXY":n.set(h*p,a*l,h*m,a*c);break;case"ZYZ":n.set(h*m,h*p,a*l,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function re(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Z(n,t){switch(t.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const gh={DEG2RAD:mi,RAD2DEG:Ni,generateUUID:Le,clamp:It,euclideanModulo:ir,mapLinear:gd,inverseLerp:yd,lerp:fi,damp:xd,pingpong:Nd,smoothstep:Md,smootherstep:wd,randInt:Td,randFloat:vd,randFloatSpread:Sd,seededRandom:bd,degToRad:_d,radToDeg:Ad,isPowerOfTwo:zd,ceilPowerOfTwo:Rd,floorPowerOfTwo:Vd,setQuaternionFromProperEuler:Cd,normalize:Z,denormalize:re};class W{constructor(t=0,e=0){W.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,i=t.elements;return this.x=i[0]*e+i[3]*s+i[6],this.y=i[1]*e+i[4]*s+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(It(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),i=Math.sin(e),o=this.x-t.x,r=this.y-t.y;return this.x=o*s-r*i+t.x,this.y=o*i+r*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ve{constructor(t,e,s,i,o,r,a,h,c){ve.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,s,i,o,r,a,h,c)}set(t,e,s,i,o,r,a,h,c){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=e,l[4]=o,l[5]=h,l[6]=s,l[7]=r,l[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,o=this.elements,r=s[0],a=s[3],h=s[6],c=s[1],l=s[4],u=s[7],d=s[2],p=s[5],m=s[8],y=i[0],w=i[3],S=i[6],R=i[1],z=i[4],C=i[7],O=i[2],P=i[5],F=i[8];return o[0]=r*y+a*R+h*O,o[3]=r*w+a*z+h*P,o[6]=r*S+a*C+h*F,o[1]=c*y+l*R+u*O,o[4]=c*w+l*z+u*P,o[7]=c*S+l*C+u*F,o[2]=d*y+p*R+m*O,o[5]=d*w+p*z+m*P,o[8]=d*S+p*C+m*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],i=t[2],o=t[3],r=t[4],a=t[5],h=t[6],c=t[7],l=t[8];return e*r*l-e*a*c-s*o*l+s*a*h+i*o*c-i*r*h}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],o=t[3],r=t[4],a=t[5],h=t[6],c=t[7],l=t[8],u=l*r-a*c,d=a*h-l*o,p=c*o-r*h,m=e*u+s*d+i*p;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/m;return t[0]=u*y,t[1]=(i*c-l*s)*y,t[2]=(a*s-i*r)*y,t[3]=d*y,t[4]=(l*e-i*h)*y,t[5]=(i*o-a*e)*y,t[6]=p*y,t[7]=(s*h-c*e)*y,t[8]=(r*e-s*o)*y,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,i,o,r,a){const h=Math.cos(o),c=Math.sin(o);return this.set(s*h,s*c,-s*(h*r+c*a)+r+t,-i*c,i*h,-i*(-c*r+h*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(Hn.makeScale(t,e)),this}rotate(t){return this.premultiply(Hn.makeRotation(-t)),this}translate(t,e){return this.premultiply(Hn.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<9;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Hn=new ve;function Ed(n){for(let t=n.length-1;t>=0;--t)if(n[t]>=65535)return!0;return!1}function jr(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}const Xr={};function yh(n){n in Xr||(Xr[n]=!0,console.warn(n))}const $r=new ve().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Yr=new ve().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Ui={[$s]:{transfer:Io,primaries:Gr,toReference:n=>n,fromReference:n=>n},[Ce]:{transfer:Ur,primaries:Gr,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[fh]:{transfer:Io,primaries:Wr,toReference:n=>n.applyMatrix3(Yr),fromReference:n=>n.applyMatrix3($r)},[pd]:{transfer:Ur,primaries:Wr,toReference:n=>n.convertSRGBToLinear().applyMatrix3(Yr),fromReference:n=>n.applyMatrix3($r).convertLinearToSRGB()}},Id=new Set([$s,fh]),ee={enabled:!0,_workingColorSpace:$s,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!Id.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,t,e){if(this.enabled===!1||t===e||!t||!e)return n;const s=Ui[t].toReference,i=Ui[e].fromReference;return i(s(n))},fromWorkingColorSpace:function(n,t){return this.convert(n,this._workingColorSpace,t)},toWorkingColorSpace:function(n,t){return this.convert(n,t,this._workingColorSpace)},getPrimaries:function(n){return Ui[n].primaries},getTransfer:function(n){return n===mh?Io:Ui[n].transfer}};function Ps(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function jn(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Ms;class Fd{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{Ms===void 0&&(Ms=jr("canvas")),Ms.width=t.width,Ms.height=t.height;const s=Ms.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),e=Ms}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=jr("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const i=s.getImageData(0,0,t.width,t.height),o=i.data;for(let r=0;r<o.length;r++)o[r]=Ps(o[r]/255)*255;return s.putImageData(i,0,0),e}else if(t.data){const e=t.data.slice(0);for(let s=0;s<e.length;s++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[s]=Math.floor(Ps(e[s]/255)*255):e[s]=Ps(e[s]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Ld=0;class xh{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Ld++}),this.uuid=Le(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(i!==null){let o;if(Array.isArray(i)){o=[];for(let r=0,a=i.length;r<a;r++)i[r].isDataTexture?o.push(Xn(i[r].image)):o.push(Xn(i[r]))}else o=Xn(i);s.url=o}return e||(t.images[this.uuid]=s),s}}function Xn(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?Fd.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Od=0;class ce extends ms{constructor(t=ce.DEFAULT_IMAGE,e=ce.DEFAULT_MAPPING,s=pi,i=pi,o=uh,r=dh,a=ud,h=ad,c=ce.DEFAULT_ANISOTROPY,l=mh){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Od++}),this.uuid=Le(),this.name="",this.source=new xh(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=i,this.magFilter=o,this.minFilter=r,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=h,this.offset=new W(0,0),this.repeat=new W(1,1),this.center=new W(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ve,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==lh)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Br:t.x=t.x-Math.floor(t.x);break;case pi:t.x=t.x<0?0:1;break;case Dr:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Br:t.y=t.y-Math.floor(t.y);break;case pi:t.y=t.y<0?0:1;break;case Dr:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}ce.DEFAULT_IMAGE=null;ce.DEFAULT_MAPPING=lh;ce.DEFAULT_ANISOTROPY=1;class xt{constructor(t=0,e=0,s=0,i=1){xt.prototype.isVector4=!0,this.x=t,this.y=e,this.z=s,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,s,i){return this.x=t,this.y=e,this.z=s,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,o=this.w,r=t.elements;return this.x=r[0]*e+r[4]*s+r[8]*i+r[12]*o,this.y=r[1]*e+r[5]*s+r[9]*i+r[13]*o,this.z=r[2]*e+r[6]*s+r[10]*i+r[14]*o,this.w=r[3]*e+r[7]*s+r[11]*i+r[15]*o,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,s,i,o;const h=t.elements,c=h[0],l=h[4],u=h[8],d=h[1],p=h[5],m=h[9],y=h[2],w=h[6],S=h[10];if(Math.abs(l-d)<.01&&Math.abs(u-y)<.01&&Math.abs(m-w)<.01){if(Math.abs(l+d)<.1&&Math.abs(u+y)<.1&&Math.abs(m+w)<.1&&Math.abs(c+p+S-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const z=(c+1)/2,C=(p+1)/2,O=(S+1)/2,P=(l+d)/4,F=(u+y)/4,L=(m+w)/4;return z>C&&z>O?z<.01?(s=0,i=.707106781,o=.707106781):(s=Math.sqrt(z),i=P/s,o=F/s):C>O?C<.01?(s=.707106781,i=0,o=.707106781):(i=Math.sqrt(C),s=P/i,o=L/i):O<.01?(s=.707106781,i=.707106781,o=0):(o=Math.sqrt(O),s=F/o,i=L/o),this.set(s,i,o,e),this}let R=Math.sqrt((w-m)*(w-m)+(u-y)*(u-y)+(d-l)*(d-l));return Math.abs(R)<.001&&(R=1),this.x=(w-m)/R,this.y=(u-y)/R,this.z=(d-l)/R,this.w=Math.acos((c+p+S-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this.w=t.w+(e.w-t.w)*s,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ls extends ms{constructor(t=1,e=1,s={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new xt(0,0,t,e),this.scissorTest=!1,this.viewport=new xt(0,0,t,e);const i={width:t,height:e,depth:1};s=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:uh,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},s);const o=new ce(i,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.colorSpace);o.flipY=!1,o.generateMipmaps=s.generateMipmaps,o.internalFormat=s.internalFormat,this.textures=[];const r=s.count;for(let a=0;a<r;a++)this.textures[a]=o.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,this.resolveDepthBuffer=s.resolveDepthBuffer,this.resolveStencilBuffer=s.resolveStencilBuffer,this.depthTexture=s.depthTexture,this.samples=s.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,s=1){if(this.width!==t||this.height!==e||this.depth!==s){this.width=t,this.height=e,this.depth=s;for(let i=0,o=this.textures.length;i<o;i++)this.textures[i].image.width=t,this.textures[i].image.height=e,this.textures[i].image.depth=s;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let s=0,i=t.textures.length;s<i;s++)this.textures[s]=t.textures[s].clone(),this.textures[s].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new xh(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Pd extends ce{constructor(t=null,e=1,s=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:s,depth:i},this.magFilter=$e,this.minFilter=$e,this.wrapR=pi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class _i{constructor(t=0,e=0,s=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=i}static slerpFlat(t,e,s,i,o,r,a){let h=s[i+0],c=s[i+1],l=s[i+2],u=s[i+3];const d=o[r+0],p=o[r+1],m=o[r+2],y=o[r+3];if(a===0){t[e+0]=h,t[e+1]=c,t[e+2]=l,t[e+3]=u;return}if(a===1){t[e+0]=d,t[e+1]=p,t[e+2]=m,t[e+3]=y;return}if(u!==y||h!==d||c!==p||l!==m){let w=1-a;const S=h*d+c*p+l*m+u*y,R=S>=0?1:-1,z=1-S*S;if(z>Number.EPSILON){const O=Math.sqrt(z),P=Math.atan2(O,S*R);w=Math.sin(w*P)/O,a=Math.sin(a*P)/O}const C=a*R;if(h=h*w+d*C,c=c*w+p*C,l=l*w+m*C,u=u*w+y*C,w===1-a){const O=1/Math.sqrt(h*h+c*c+l*l+u*u);h*=O,c*=O,l*=O,u*=O}}t[e]=h,t[e+1]=c,t[e+2]=l,t[e+3]=u}static multiplyQuaternionsFlat(t,e,s,i,o,r){const a=s[i],h=s[i+1],c=s[i+2],l=s[i+3],u=o[r],d=o[r+1],p=o[r+2],m=o[r+3];return t[e]=a*m+l*u+h*p-c*d,t[e+1]=h*m+l*d+c*u-a*p,t[e+2]=c*m+l*p+a*d-h*u,t[e+3]=l*m-a*u-h*d-c*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const s=t._x,i=t._y,o=t._z,r=t._order,a=Math.cos,h=Math.sin,c=a(s/2),l=a(i/2),u=a(o/2),d=h(s/2),p=h(i/2),m=h(o/2);switch(r){case"XYZ":this._x=d*l*u+c*p*m,this._y=c*p*u-d*l*m,this._z=c*l*m+d*p*u,this._w=c*l*u-d*p*m;break;case"YXZ":this._x=d*l*u+c*p*m,this._y=c*p*u-d*l*m,this._z=c*l*m-d*p*u,this._w=c*l*u+d*p*m;break;case"ZXY":this._x=d*l*u-c*p*m,this._y=c*p*u+d*l*m,this._z=c*l*m+d*p*u,this._w=c*l*u-d*p*m;break;case"ZYX":this._x=d*l*u-c*p*m,this._y=c*p*u+d*l*m,this._z=c*l*m-d*p*u,this._w=c*l*u+d*p*m;break;case"YZX":this._x=d*l*u+c*p*m,this._y=c*p*u+d*l*m,this._z=c*l*m-d*p*u,this._w=c*l*u-d*p*m;break;case"XZY":this._x=d*l*u-c*p*m,this._y=c*p*u-d*l*m,this._z=c*l*m+d*p*u,this._w=c*l*u+d*p*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],i=e[4],o=e[8],r=e[1],a=e[5],h=e[9],c=e[2],l=e[6],u=e[10],d=s+a+u;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(l-h)*p,this._y=(o-c)*p,this._z=(r-i)*p}else if(s>a&&s>u){const p=2*Math.sqrt(1+s-a-u);this._w=(l-h)/p,this._x=.25*p,this._y=(i+r)/p,this._z=(o+c)/p}else if(a>u){const p=2*Math.sqrt(1+a-s-u);this._w=(o-c)/p,this._x=(i+r)/p,this._y=.25*p,this._z=(h+l)/p}else{const p=2*Math.sqrt(1+u-s-a);this._w=(r-i)/p,this._x=(o+c)/p,this._y=(h+l)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(It(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(s===0)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,o=t._z,r=t._w,a=e._x,h=e._y,c=e._z,l=e._w;return this._x=s*l+r*a+i*c-o*h,this._y=i*l+r*h+o*a-s*c,this._z=o*l+r*c+s*h-i*a,this._w=r*l-s*a-i*h-o*c,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const s=this._x,i=this._y,o=this._z,r=this._w;let a=r*t._w+s*t._x+i*t._y+o*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=r,this._x=s,this._y=i,this._z=o,this;const h=1-a*a;if(h<=Number.EPSILON){const p=1-e;return this._w=p*r+e*this._w,this._x=p*s+e*this._x,this._y=p*i+e*this._y,this._z=p*o+e*this._z,this.normalize(),this}const c=Math.sqrt(h),l=Math.atan2(c,a),u=Math.sin((1-e)*l)/c,d=Math.sin(e*l)/c;return this._w=r*u+this._w*d,this._x=s*u+this._x*d,this._y=i*u+this._y*d,this._z=o*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),s=Math.random(),i=Math.sqrt(1-s),o=Math.sqrt(s);return this.set(i*Math.sin(t),i*Math.cos(t),o*Math.sin(e),o*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class v{constructor(t=0,e=0,s=0){v.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return s===void 0&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Zr.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Zr.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,i=this.z,o=t.elements;return this.x=o[0]*e+o[3]*s+o[6]*i,this.y=o[1]*e+o[4]*s+o[7]*i,this.z=o[2]*e+o[5]*s+o[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,o=t.elements,r=1/(o[3]*e+o[7]*s+o[11]*i+o[15]);return this.x=(o[0]*e+o[4]*s+o[8]*i+o[12])*r,this.y=(o[1]*e+o[5]*s+o[9]*i+o[13])*r,this.z=(o[2]*e+o[6]*s+o[10]*i+o[14])*r,this}applyQuaternion(t){const e=this.x,s=this.y,i=this.z,o=t.x,r=t.y,a=t.z,h=t.w,c=2*(r*i-a*s),l=2*(a*e-o*i),u=2*(o*s-r*e);return this.x=e+h*c+r*u-a*l,this.y=s+h*l+a*c-o*u,this.z=i+h*u+o*l-r*c,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,i=this.z,o=t.elements;return this.x=o[0]*e+o[4]*s+o[8]*i,this.y=o[1]*e+o[5]*s+o[9]*i,this.z=o[2]*e+o[6]*s+o[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(t,Math.min(e,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,i=t.y,o=t.z,r=e.x,a=e.y,h=e.z;return this.x=i*h-o*a,this.y=o*r-s*h,this.z=s*a-i*r,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return $n.copy(this).projectOnVector(t),this.sub($n)}reflect(t){return this.sub($n.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(It(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return e*e+s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const i=Math.sin(e)*t;return this.x=i*Math.sin(s),this.y=Math.cos(e)*t,this.z=i*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,s=Math.sqrt(1-e*e);return this.x=s*Math.cos(t),this.y=e,this.z=s*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const $n=new v,Zr=new _i;class Ai{constructor(t=new v(1/0,1/0,1/0),e=new v(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e+=3)this.expandByPoint(se.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,s=t.count;e<s;e++)this.expandByPoint(se.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=se.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const s=t.geometry;if(s!==void 0){const o=s.getAttribute("position");if(e===!0&&o!==void 0&&t.isInstancedMesh!==!0)for(let r=0,a=o.count;r<a;r++)t.isMesh===!0?t.getVertexPosition(r,se):se.fromBufferAttribute(o,r),se.applyMatrix4(t.matrixWorld),this.expandByPoint(se);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),Gi.copy(t.boundingBox)):(s.boundingBox===null&&s.computeBoundingBox(),Gi.copy(s.boundingBox)),Gi.applyMatrix4(t.matrixWorld),this.union(Gi)}const i=t.children;for(let o=0,r=i.length;o<r;o++)this.expandByObject(i[o],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,se),se.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ni),Wi.subVectors(this.max,ni),ws.subVectors(t.a,ni),Ts.subVectors(t.b,ni),vs.subVectors(t.c,ni),Be.subVectors(Ts,ws),De.subVectors(vs,Ts),ts.subVectors(ws,vs);let e=[0,-Be.z,Be.y,0,-De.z,De.y,0,-ts.z,ts.y,Be.z,0,-Be.x,De.z,0,-De.x,ts.z,0,-ts.x,-Be.y,Be.x,0,-De.y,De.x,0,-ts.y,ts.x,0];return!Yn(e,ws,Ts,vs,Wi)||(e=[1,0,0,0,1,0,0,0,1],!Yn(e,ws,Ts,vs,Wi))?!1:(qi.crossVectors(Be,De),e=[qi.x,qi.y,qi.z],Yn(e,ws,Ts,vs,Wi))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,se).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(se).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(_e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),_e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),_e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),_e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),_e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),_e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),_e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),_e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(_e),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const _e=[new v,new v,new v,new v,new v,new v,new v,new v],se=new v,Gi=new Ai,ws=new v,Ts=new v,vs=new v,Be=new v,De=new v,ts=new v,ni=new v,Wi=new v,qi=new v,es=new v;function Yn(n,t,e,s,i){for(let o=0,r=n.length-3;o<=r;o+=3){es.fromArray(n,o);const a=i.x*Math.abs(es.x)+i.y*Math.abs(es.y)+i.z*Math.abs(es.z),h=t.dot(es),c=e.dot(es),l=s.dot(es);if(Math.max(-Math.max(h,c,l),Math.min(h,c,l))>a)return!1}return!0}const Bd=new Ai,oi=new v,Zn=new v;class nr{constructor(t=new v,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const s=this.center;e!==void 0?s.copy(e):Bd.setFromPoints(t).getCenter(s);let i=0;for(let o=0,r=t.length;o<r;o++)i=Math.max(i,s.distanceToSquared(t[o]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const s=this.center.distanceToSquared(t);return e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;oi.subVectors(t,this.center);const e=oi.lengthSq();if(e>this.radius*this.radius){const s=Math.sqrt(e),i=(s-this.radius)*.5;this.center.addScaledVector(oi,i/s),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(Zn.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(oi.copy(t.center).add(Zn)),this.expandByPoint(oi.copy(t.center).sub(Zn))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Ae=new v,Jn=new v,Hi=new v,ke=new v,Qn=new v,ji=new v,Kn=new v;class Dd{constructor(t=new v,e=new v(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Ae)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const s=e.dot(this.direction);return s<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Ae.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Ae.copy(this.origin).addScaledVector(this.direction,e),Ae.distanceToSquared(t))}distanceSqToSegment(t,e,s,i){Jn.copy(t).add(e).multiplyScalar(.5),Hi.copy(e).sub(t).normalize(),ke.copy(this.origin).sub(Jn);const o=t.distanceTo(e)*.5,r=-this.direction.dot(Hi),a=ke.dot(this.direction),h=-ke.dot(Hi),c=ke.lengthSq(),l=Math.abs(1-r*r);let u,d,p,m;if(l>0)if(u=r*h-a,d=r*a-h,m=o*l,u>=0)if(d>=-m)if(d<=m){const y=1/l;u*=y,d*=y,p=u*(u+r*d+2*a)+d*(r*u+d+2*h)+c}else d=o,u=Math.max(0,-(r*d+a)),p=-u*u+d*(d+2*h)+c;else d=-o,u=Math.max(0,-(r*d+a)),p=-u*u+d*(d+2*h)+c;else d<=-m?(u=Math.max(0,-(-r*o+a)),d=u>0?-o:Math.min(Math.max(-o,-h),o),p=-u*u+d*(d+2*h)+c):d<=m?(u=0,d=Math.min(Math.max(-o,-h),o),p=d*(d+2*h)+c):(u=Math.max(0,-(r*o+a)),d=u>0?o:Math.min(Math.max(-o,-h),o),p=-u*u+d*(d+2*h)+c);else d=r>0?-o:o,u=Math.max(0,-(r*d+a)),p=-u*u+d*(d+2*h)+c;return s&&s.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(Jn).addScaledVector(Hi,d),p}intersectSphere(t,e){Ae.subVectors(t.center,this.origin);const s=Ae.dot(this.direction),i=Ae.dot(Ae)-s*s,o=t.radius*t.radius;if(i>o)return null;const r=Math.sqrt(o-i),a=s-r,h=s+r;return h<0?null:a<0?this.at(h,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(t.normal)+t.constant)/e;return s>=0?s:null}intersectPlane(t,e){const s=this.distanceToPlane(t);return s===null?null:this.at(s,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let s,i,o,r,a,h;const c=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(s=(t.min.x-d.x)*c,i=(t.max.x-d.x)*c):(s=(t.max.x-d.x)*c,i=(t.min.x-d.x)*c),l>=0?(o=(t.min.y-d.y)*l,r=(t.max.y-d.y)*l):(o=(t.max.y-d.y)*l,r=(t.min.y-d.y)*l),s>r||o>i||((o>s||isNaN(s))&&(s=o),(r<i||isNaN(i))&&(i=r),u>=0?(a=(t.min.z-d.z)*u,h=(t.max.z-d.z)*u):(a=(t.max.z-d.z)*u,h=(t.min.z-d.z)*u),s>h||a>i)||((a>s||s!==s)&&(s=a),(h<i||i!==i)&&(i=h),i<0)?null:this.at(s>=0?s:i,e)}intersectsBox(t){return this.intersectBox(t,Ae)!==null}intersectTriangle(t,e,s,i,o){Qn.subVectors(e,t),ji.subVectors(s,t),Kn.crossVectors(Qn,ji);let r=this.direction.dot(Kn),a;if(r>0){if(i)return null;a=1}else if(r<0)a=-1,r=-r;else return null;ke.subVectors(this.origin,t);const h=a*this.direction.dot(ji.crossVectors(ke,ji));if(h<0)return null;const c=a*this.direction.dot(Qn.cross(ke));if(c<0||h+c>r)return null;const l=-a*ke.dot(Kn);return l<0?null:this.at(l/r,o)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ft{constructor(t,e,s,i,o,r,a,h,c,l,u,d,p,m,y,w){ft.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,s,i,o,r,a,h,c,l,u,d,p,m,y,w)}set(t,e,s,i,o,r,a,h,c,l,u,d,p,m,y,w){const S=this.elements;return S[0]=t,S[4]=e,S[8]=s,S[12]=i,S[1]=o,S[5]=r,S[9]=a,S[13]=h,S[2]=c,S[6]=l,S[10]=u,S[14]=d,S[3]=p,S[7]=m,S[11]=y,S[15]=w,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ft().fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,i=1/Ss.setFromMatrixColumn(t,0).length(),o=1/Ss.setFromMatrixColumn(t,1).length(),r=1/Ss.setFromMatrixColumn(t,2).length();return e[0]=s[0]*i,e[1]=s[1]*i,e[2]=s[2]*i,e[3]=0,e[4]=s[4]*o,e[5]=s[5]*o,e[6]=s[6]*o,e[7]=0,e[8]=s[8]*r,e[9]=s[9]*r,e[10]=s[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,i=t.y,o=t.z,r=Math.cos(s),a=Math.sin(s),h=Math.cos(i),c=Math.sin(i),l=Math.cos(o),u=Math.sin(o);if(t.order==="XYZ"){const d=r*l,p=r*u,m=a*l,y=a*u;e[0]=h*l,e[4]=-h*u,e[8]=c,e[1]=p+m*c,e[5]=d-y*c,e[9]=-a*h,e[2]=y-d*c,e[6]=m+p*c,e[10]=r*h}else if(t.order==="YXZ"){const d=h*l,p=h*u,m=c*l,y=c*u;e[0]=d+y*a,e[4]=m*a-p,e[8]=r*c,e[1]=r*u,e[5]=r*l,e[9]=-a,e[2]=p*a-m,e[6]=y+d*a,e[10]=r*h}else if(t.order==="ZXY"){const d=h*l,p=h*u,m=c*l,y=c*u;e[0]=d-y*a,e[4]=-r*u,e[8]=m+p*a,e[1]=p+m*a,e[5]=r*l,e[9]=y-d*a,e[2]=-r*c,e[6]=a,e[10]=r*h}else if(t.order==="ZYX"){const d=r*l,p=r*u,m=a*l,y=a*u;e[0]=h*l,e[4]=m*c-p,e[8]=d*c+y,e[1]=h*u,e[5]=y*c+d,e[9]=p*c-m,e[2]=-c,e[6]=a*h,e[10]=r*h}else if(t.order==="YZX"){const d=r*h,p=r*c,m=a*h,y=a*c;e[0]=h*l,e[4]=y-d*u,e[8]=m*u+p,e[1]=u,e[5]=r*l,e[9]=-a*l,e[2]=-c*l,e[6]=p*u+m,e[10]=d-y*u}else if(t.order==="XZY"){const d=r*h,p=r*c,m=a*h,y=a*c;e[0]=h*l,e[4]=-u,e[8]=c*l,e[1]=d*u+y,e[5]=r*l,e[9]=p*u-m,e[2]=m*u-p,e[6]=a*l,e[10]=y*u+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(kd,t,Ud)}lookAt(t,e,s){const i=this.elements;return Wt.subVectors(t,e),Wt.lengthSq()===0&&(Wt.z=1),Wt.normalize(),Ue.crossVectors(s,Wt),Ue.lengthSq()===0&&(Math.abs(s.z)===1?Wt.x+=1e-4:Wt.z+=1e-4,Wt.normalize(),Ue.crossVectors(s,Wt)),Ue.normalize(),Xi.crossVectors(Wt,Ue),i[0]=Ue.x,i[4]=Xi.x,i[8]=Wt.x,i[1]=Ue.y,i[5]=Xi.y,i[9]=Wt.y,i[2]=Ue.z,i[6]=Xi.z,i[10]=Wt.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,o=this.elements,r=s[0],a=s[4],h=s[8],c=s[12],l=s[1],u=s[5],d=s[9],p=s[13],m=s[2],y=s[6],w=s[10],S=s[14],R=s[3],z=s[7],C=s[11],O=s[15],P=i[0],F=i[4],L=i[8],K=i[12],rt=i[1],lt=i[5],Ot=i[9],yt=i[13],Pe=i[2],Fi=i[6],Li=i[10],Oi=i[14],Pi=i[3],Bi=i[7],Di=i[11],ki=i[15];return o[0]=r*P+a*rt+h*Pe+c*Pi,o[4]=r*F+a*lt+h*Fi+c*Bi,o[8]=r*L+a*Ot+h*Li+c*Di,o[12]=r*K+a*yt+h*Oi+c*ki,o[1]=l*P+u*rt+d*Pe+p*Pi,o[5]=l*F+u*lt+d*Fi+p*Bi,o[9]=l*L+u*Ot+d*Li+p*Di,o[13]=l*K+u*yt+d*Oi+p*ki,o[2]=m*P+y*rt+w*Pe+S*Pi,o[6]=m*F+y*lt+w*Fi+S*Bi,o[10]=m*L+y*Ot+w*Li+S*Di,o[14]=m*K+y*yt+w*Oi+S*ki,o[3]=R*P+z*rt+C*Pe+O*Pi,o[7]=R*F+z*lt+C*Fi+O*Bi,o[11]=R*L+z*Ot+C*Li+O*Di,o[15]=R*K+z*yt+C*Oi+O*ki,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],i=t[8],o=t[12],r=t[1],a=t[5],h=t[9],c=t[13],l=t[2],u=t[6],d=t[10],p=t[14],m=t[3],y=t[7],w=t[11],S=t[15];return m*(+o*h*u-i*c*u-o*a*d+s*c*d+i*a*p-s*h*p)+y*(+e*h*p-e*c*d+o*r*d-i*r*p+i*c*l-o*h*l)+w*(+e*c*u-e*a*p-o*r*u+s*r*p+o*a*l-s*c*l)+S*(-i*a*l-e*h*u+e*a*d+i*r*u-s*r*d+s*h*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],o=t[3],r=t[4],a=t[5],h=t[6],c=t[7],l=t[8],u=t[9],d=t[10],p=t[11],m=t[12],y=t[13],w=t[14],S=t[15],R=u*w*c-y*d*c+y*h*p-a*w*p-u*h*S+a*d*S,z=m*d*c-l*w*c-m*h*p+r*w*p+l*h*S-r*d*S,C=l*y*c-m*u*c+m*a*p-r*y*p-l*a*S+r*u*S,O=m*u*h-l*y*h-m*a*d+r*y*d+l*a*w-r*u*w,P=e*R+s*z+i*C+o*O;if(P===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const F=1/P;return t[0]=R*F,t[1]=(y*d*o-u*w*o-y*i*p+s*w*p+u*i*S-s*d*S)*F,t[2]=(a*w*o-y*h*o+y*i*c-s*w*c-a*i*S+s*h*S)*F,t[3]=(u*h*o-a*d*o-u*i*c+s*d*c+a*i*p-s*h*p)*F,t[4]=z*F,t[5]=(l*w*o-m*d*o+m*i*p-e*w*p-l*i*S+e*d*S)*F,t[6]=(m*h*o-r*w*o-m*i*c+e*w*c+r*i*S-e*h*S)*F,t[7]=(r*d*o-l*h*o+l*i*c-e*d*c-r*i*p+e*h*p)*F,t[8]=C*F,t[9]=(m*u*o-l*y*o-m*s*p+e*y*p+l*s*S-e*u*S)*F,t[10]=(r*y*o-m*a*o+m*s*c-e*y*c-r*s*S+e*a*S)*F,t[11]=(l*a*o-r*u*o-l*s*c+e*u*c+r*s*p-e*a*p)*F,t[12]=O*F,t[13]=(l*y*i-m*u*i+m*s*d-e*y*d-l*s*w+e*u*w)*F,t[14]=(m*a*i-r*y*i-m*s*h+e*y*h+r*s*w-e*a*w)*F,t[15]=(r*u*i-l*a*i+l*s*h-e*u*h-r*s*d+e*a*d)*F,this}scale(t){const e=this.elements,s=t.x,i=t.y,o=t.z;return e[0]*=s,e[4]*=i,e[8]*=o,e[1]*=s,e[5]*=i,e[9]*=o,e[2]*=s,e[6]*=i,e[10]*=o,e[3]*=s,e[7]*=i,e[11]*=o,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,i))}makeTranslation(t,e,s){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),i=Math.sin(e),o=1-s,r=t.x,a=t.y,h=t.z,c=o*r,l=o*a;return this.set(c*r+s,c*a-i*h,c*h+i*a,0,c*a+i*h,l*a+s,l*h-i*r,0,c*h-i*a,l*h+i*r,o*h*h+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,i,o,r){return this.set(1,s,o,0,t,1,r,0,e,i,1,0,0,0,0,1),this}compose(t,e,s){const i=this.elements,o=e._x,r=e._y,a=e._z,h=e._w,c=o+o,l=r+r,u=a+a,d=o*c,p=o*l,m=o*u,y=r*l,w=r*u,S=a*u,R=h*c,z=h*l,C=h*u,O=s.x,P=s.y,F=s.z;return i[0]=(1-(y+S))*O,i[1]=(p+C)*O,i[2]=(m-z)*O,i[3]=0,i[4]=(p-C)*P,i[5]=(1-(d+S))*P,i[6]=(w+R)*P,i[7]=0,i[8]=(m+z)*F,i[9]=(w-R)*F,i[10]=(1-(d+y))*F,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,s){const i=this.elements;let o=Ss.set(i[0],i[1],i[2]).length();const r=Ss.set(i[4],i[5],i[6]).length(),a=Ss.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),t.x=i[12],t.y=i[13],t.z=i[14],ie.copy(this);const c=1/o,l=1/r,u=1/a;return ie.elements[0]*=c,ie.elements[1]*=c,ie.elements[2]*=c,ie.elements[4]*=l,ie.elements[5]*=l,ie.elements[6]*=l,ie.elements[8]*=u,ie.elements[9]*=u,ie.elements[10]*=u,e.setFromRotationMatrix(ie),s.x=o,s.y=r,s.z=a,this}makePerspective(t,e,s,i,o,r,a=Ie){const h=this.elements,c=2*o/(e-t),l=2*o/(s-i),u=(e+t)/(e-t),d=(s+i)/(s-i);let p,m;if(a===Ie)p=-(r+o)/(r-o),m=-2*r*o/(r-o);else if(a===xi)p=-r/(r-o),m=-r*o/(r-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return h[0]=c,h[4]=0,h[8]=u,h[12]=0,h[1]=0,h[5]=l,h[9]=d,h[13]=0,h[2]=0,h[6]=0,h[10]=p,h[14]=m,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,s,i,o,r,a=Ie){const h=this.elements,c=1/(e-t),l=1/(s-i),u=1/(r-o),d=(e+t)*c,p=(s+i)*l;let m,y;if(a===Ie)m=(r+o)*u,y=-2*u;else if(a===xi)m=o*u,y=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return h[0]=2*c,h[4]=0,h[8]=0,h[12]=-d,h[1]=0,h[5]=2*l,h[9]=0,h[13]=-p,h[2]=0,h[6]=0,h[10]=y,h[14]=-m,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<16;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const Ss=new v,ie=new ft,kd=new v(0,0,0),Ud=new v(1,1,1),Ue=new v,Xi=new v,Wt=new v,Jr=new ft,Qr=new _i;class Ke{constructor(t=0,e=0,s=0,i=Ke.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,i=this._order){return this._x=t,this._y=e,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const i=t.elements,o=i[0],r=i[4],a=i[8],h=i[1],c=i[5],l=i[9],u=i[2],d=i[6],p=i[10];switch(e){case"XYZ":this._y=Math.asin(It(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-r,o)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-It(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(h,c)):(this._y=Math.atan2(-u,o),this._z=0);break;case"ZXY":this._x=Math.asin(It(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-r,c)):(this._y=0,this._z=Math.atan2(h,o));break;case"ZYX":this._y=Math.asin(-It(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(h,o)):(this._x=0,this._z=Math.atan2(-r,c));break;case"YZX":this._z=Math.asin(It(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-It(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-l,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,s===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return Jr.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Jr,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Qr.setFromEuler(this),this.setFromQuaternion(Qr,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ke.DEFAULT_ORDER="XYZ";class Gd{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Wd=0;const Kr=new v,bs=new _i,ze=new ft,$i=new v,ri=new v,qd=new v,Hd=new _i,ta=new v(1,0,0),ea=new v(0,1,0),sa=new v(0,0,1),ia={type:"added"},jd={type:"removed"},_s={type:"childadded",child:null},to={type:"childremoved",child:null};class Ft extends ms{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Wd++}),this.uuid=Le(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ft.DEFAULT_UP.clone();const t=new v,e=new Ke,s=new _i,i=new v(1,1,1);function o(){s.setFromEuler(e,!1)}function r(){e.setFromQuaternion(s,void 0,!1)}e._onChange(o),s._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new ft},normalMatrix:{value:new ve}}),this.matrix=new ft,this.matrixWorld=new ft,this.matrixAutoUpdate=Ft.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ft.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Gd,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return bs.setFromAxisAngle(t,e),this.quaternion.multiply(bs),this}rotateOnWorldAxis(t,e){return bs.setFromAxisAngle(t,e),this.quaternion.premultiply(bs),this}rotateX(t){return this.rotateOnAxis(ta,t)}rotateY(t){return this.rotateOnAxis(ea,t)}rotateZ(t){return this.rotateOnAxis(sa,t)}translateOnAxis(t,e){return Kr.copy(t).applyQuaternion(this.quaternion),this.position.add(Kr.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(ta,t)}translateY(t){return this.translateOnAxis(ea,t)}translateZ(t){return this.translateOnAxis(sa,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(ze.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?$i.copy(t):$i.set(t,e,s);const i=this.parent;this.updateWorldMatrix(!0,!1),ri.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ze.lookAt(ri,$i,this.up):ze.lookAt($i,ri,this.up),this.quaternion.setFromRotationMatrix(ze),i&&(ze.extractRotation(i.matrixWorld),bs.setFromRotationMatrix(ze),this.quaternion.premultiply(bs.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(ia),_s.child=t,this.dispatchEvent(_s),_s.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(jd),to.child=t,this.dispatchEvent(to),to.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),ze.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),ze.multiply(t.parent.matrixWorld)),t.applyMatrix4(ze),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(ia),_s.child=t,this.dispatchEvent(_s),_s.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,i=this.children.length;s<i;s++){const r=this.children[s].getObjectByProperty(t,e);if(r!==void 0)return r}}getObjectsByProperty(t,e,s=[]){this[t]===e&&s.push(this);const i=this.children;for(let o=0,r=i.length;o<r;o++)i[o].getObjectsByProperty(t,e,s);return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ri,t,qd),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ri,Hd,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,i=e.length;s<i;s++){const o=e[s];(o.matrixWorldAutoUpdate===!0||t===!0)&&o.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const s=this.parent;if(t===!0&&s!==null&&s.matrixWorldAutoUpdate===!0&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const i=this.children;for(let o=0,r=i.length;o<r;o++){const a=i[o];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function o(a,h){return a[h.uuid]===void 0&&(a[h.uuid]=h.toJSON(t)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=o(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const h=a.shapes;if(Array.isArray(h))for(let c=0,l=h.length;c<l;c++){const u=h[c];o(t.shapes,u)}else o(t.shapes,h)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let h=0,c=this.material.length;h<c;h++)a.push(o(t.materials,this.material[h]));i.material=a}else i.material=o(t.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const h=this.animations[a];i.animations.push(o(t.animations,h))}}if(e){const a=r(t.geometries),h=r(t.materials),c=r(t.textures),l=r(t.images),u=r(t.shapes),d=r(t.skeletons),p=r(t.animations),m=r(t.nodes);a.length>0&&(s.geometries=a),h.length>0&&(s.materials=h),c.length>0&&(s.textures=c),l.length>0&&(s.images=l),u.length>0&&(s.shapes=u),d.length>0&&(s.skeletons=d),p.length>0&&(s.animations=p),m.length>0&&(s.nodes=m)}return s.object=i,s;function r(a){const h=[];for(const c in a){const l=a[c];delete l.metadata,h.push(l)}return h}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let s=0;s<t.children.length;s++){const i=t.children[s];this.add(i.clone())}return this}}Ft.DEFAULT_UP=new v(0,1,0);Ft.DEFAULT_MATRIX_AUTO_UPDATE=!0;Ft.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ne=new v,Re=new v,eo=new v,Ve=new v,As=new v,zs=new v,na=new v,so=new v,io=new v,no=new v;class xe{constructor(t=new v,e=new v,s=new v){this.a=t,this.b=e,this.c=s}static getNormal(t,e,s,i){i.subVectors(s,e),ne.subVectors(t,e),i.cross(ne);const o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}static getBarycoord(t,e,s,i,o){ne.subVectors(i,e),Re.subVectors(s,e),eo.subVectors(t,e);const r=ne.dot(ne),a=ne.dot(Re),h=ne.dot(eo),c=Re.dot(Re),l=Re.dot(eo),u=r*c-a*a;if(u===0)return o.set(0,0,0),null;const d=1/u,p=(c*h-a*l)*d,m=(r*l-a*h)*d;return o.set(1-p-m,m,p)}static containsPoint(t,e,s,i){return this.getBarycoord(t,e,s,i,Ve)===null?!1:Ve.x>=0&&Ve.y>=0&&Ve.x+Ve.y<=1}static getInterpolation(t,e,s,i,o,r,a,h){return this.getBarycoord(t,e,s,i,Ve)===null?(h.x=0,h.y=0,"z"in h&&(h.z=0),"w"in h&&(h.w=0),null):(h.setScalar(0),h.addScaledVector(o,Ve.x),h.addScaledVector(r,Ve.y),h.addScaledVector(a,Ve.z),h)}static isFrontFacing(t,e,s,i){return ne.subVectors(s,e),Re.subVectors(t,e),ne.cross(Re).dot(i)<0}set(t,e,s){return this.a.copy(t),this.b.copy(e),this.c.copy(s),this}setFromPointsAndIndices(t,e,s,i){return this.a.copy(t[e]),this.b.copy(t[s]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,s,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,s),this.c.fromBufferAttribute(t,i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return ne.subVectors(this.c,this.b),Re.subVectors(this.a,this.b),ne.cross(Re).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return xe.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return xe.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,s,i,o){return xe.getInterpolation(t,this.a,this.b,this.c,e,s,i,o)}containsPoint(t){return xe.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return xe.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const s=this.a,i=this.b,o=this.c;let r,a;As.subVectors(i,s),zs.subVectors(o,s),so.subVectors(t,s);const h=As.dot(so),c=zs.dot(so);if(h<=0&&c<=0)return e.copy(s);io.subVectors(t,i);const l=As.dot(io),u=zs.dot(io);if(l>=0&&u<=l)return e.copy(i);const d=h*u-l*c;if(d<=0&&h>=0&&l<=0)return r=h/(h-l),e.copy(s).addScaledVector(As,r);no.subVectors(t,o);const p=As.dot(no),m=zs.dot(no);if(m>=0&&p<=m)return e.copy(o);const y=p*c-h*m;if(y<=0&&c>=0&&m<=0)return a=c/(c-m),e.copy(s).addScaledVector(zs,a);const w=l*m-p*u;if(w<=0&&u-l>=0&&p-m>=0)return na.subVectors(o,i),a=(u-l)/(u-l+(p-m)),e.copy(i).addScaledVector(na,a);const S=1/(w+y+d);return r=y*S,a=d*S,e.copy(s).addScaledVector(As,r).addScaledVector(zs,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Nh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ge={h:0,s:0,l:0},Yi={h:0,s:0,l:0};function oo(n,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+(t-n)*6*e:e<1/2?t:e<2/3?n+(t-n)*6*(2/3-e):n}class it{constructor(t,e,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,s)}set(t,e,s){if(e===void 0&&s===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,e,s);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Ce){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,ee.toWorkingColorSpace(this,e),this}setRGB(t,e,s,i=ee.workingColorSpace){return this.r=t,this.g=e,this.b=s,ee.toWorkingColorSpace(this,i),this}setHSL(t,e,s,i=ee.workingColorSpace){if(t=ir(t,1),e=It(e,0,1),s=It(s,0,1),e===0)this.r=this.g=this.b=s;else{const o=s<=.5?s*(1+e):s+e-s*e,r=2*s-o;this.r=oo(r,o,t+1/3),this.g=oo(r,o,t),this.b=oo(r,o,t-1/3)}return ee.toWorkingColorSpace(this,i),this}setStyle(t,e=Ce){function s(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let o;const r=i[1],a=i[2];switch(r){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,e);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,e);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const o=i[1],r=o.length;if(r===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,e);if(r===6)return this.setHex(parseInt(o,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=Ce){const s=Nh[t.toLowerCase()];return s!==void 0?this.setHex(s,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ps(t.r),this.g=Ps(t.g),this.b=Ps(t.b),this}copyLinearToSRGB(t){return this.r=jn(t.r),this.g=jn(t.g),this.b=jn(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Ce){return ee.fromWorkingColorSpace(Et.copy(this),t),Math.round(It(Et.r*255,0,255))*65536+Math.round(It(Et.g*255,0,255))*256+Math.round(It(Et.b*255,0,255))}getHexString(t=Ce){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ee.workingColorSpace){ee.fromWorkingColorSpace(Et.copy(this),e);const s=Et.r,i=Et.g,o=Et.b,r=Math.max(s,i,o),a=Math.min(s,i,o);let h,c;const l=(a+r)/2;if(a===r)h=0,c=0;else{const u=r-a;switch(c=l<=.5?u/(r+a):u/(2-r-a),r){case s:h=(i-o)/u+(i<o?6:0);break;case i:h=(o-s)/u+2;break;case o:h=(s-i)/u+4;break}h/=6}return t.h=h,t.s=c,t.l=l,t}getRGB(t,e=ee.workingColorSpace){return ee.fromWorkingColorSpace(Et.copy(this),e),t.r=Et.r,t.g=Et.g,t.b=Et.b,t}getStyle(t=Ce){ee.fromWorkingColorSpace(Et.copy(this),t);const e=Et.r,s=Et.g,i=Et.b;return t!==Ce?`color(${t} ${e.toFixed(3)} ${s.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(s*255)},${Math.round(i*255)})`}offsetHSL(t,e,s){return this.getHSL(Ge),this.setHSL(Ge.h+t,Ge.s+e,Ge.l+s)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,s){return this.r=t.r+(e.r-t.r)*s,this.g=t.g+(e.g-t.g)*s,this.b=t.b+(e.b-t.b)*s,this}lerpHSL(t,e){this.getHSL(Ge),t.getHSL(Yi);const s=fi(Ge.h,Yi.h,e),i=fi(Ge.s,Yi.s,e),o=fi(Ge.l,Yi.l,e);return this.setHSL(s,i,o),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,s=this.g,i=this.b,o=t.elements;return this.r=o[0]*e+o[3]*s+o[6]*i,this.g=o[1]*e+o[4]*s+o[7]*i,this.b=o[2]*e+o[5]*s+o[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Et=new it;it.NAMES=Nh;let Xd=0;class Yt extends ms{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Xd++}),this.uuid=Le(),this.name="",this.type="Material",this.blending=Ir,this.side=Eo,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Lr,this.blendDst=Or,this.blendEquation=Fr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new it(0,0,0),this.blendAlpha=0,this.depthFunc=Pr,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=qr,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ns,this.stencilZFail=Ns,this.stencilZPass=Ns,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const s=t[e];if(s===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];if(i===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(s):i&&i.isVector3&&s&&s.isVector3?i.copy(s):this[e]=s}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const s={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(s.dispersion=this.dispersion),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(s.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(t).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(t).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(t).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(t).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(t).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapRotation!==void 0&&(s.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==Ir&&(s.blending=this.blending),this.side!==Eo&&(s.side=this.side),this.vertexColors===!0&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=!0),this.blendSrc!==Lr&&(s.blendSrc=this.blendSrc),this.blendDst!==Or&&(s.blendDst=this.blendDst),this.blendEquation!==Fr&&(s.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(s.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(s.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(s.blendAlpha=this.blendAlpha),this.depthFunc!==Pr&&(s.depthFunc=this.depthFunc),this.depthTest===!1&&(s.depthTest=this.depthTest),this.depthWrite===!1&&(s.depthWrite=this.depthWrite),this.colorWrite===!1&&(s.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(s.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==qr&&(s.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(s.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ns&&(s.stencilFail=this.stencilFail),this.stencilZFail!==Ns&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==Ns&&(s.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(s.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaHash===!0&&(s.alphaHash=!0),this.alphaToCoverage===!0&&(s.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=!0),this.forceSinglePass===!0&&(s.forceSinglePass=!0),this.wireframe===!0&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=!0),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function i(o){const r=[];for(const a in o){const h=o[a];delete h.metadata,r.push(h)}return r}if(e){const o=i(t.textures),r=i(t.images);o.length>0&&(s.textures=o),r.length>0&&(s.images=r)}return s}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let s=null;if(e!==null){const i=e.length;s=new Array(i);for(let o=0;o!==i;++o)s[o]=e[o].clone()}return this.clippingPlanes=s,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class Mh extends Yt{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new it(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ke,this.combine=sr,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const pt=new v,Zi=new W;class Xe{constructor(t,e,s=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=s,this.usage=pn,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=ph,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return yh("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,s){t*=this.itemSize,s*=e.itemSize;for(let i=0,o=this.itemSize;i<o;i++)this.array[t+i]=e.array[s+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,s=this.count;e<s;e++)Zi.fromBufferAttribute(this,e),Zi.applyMatrix3(t),this.setXY(e,Zi.x,Zi.y);else if(this.itemSize===3)for(let e=0,s=this.count;e<s;e++)pt.fromBufferAttribute(this,e),pt.applyMatrix3(t),this.setXYZ(e,pt.x,pt.y,pt.z);return this}applyMatrix4(t){for(let e=0,s=this.count;e<s;e++)pt.fromBufferAttribute(this,e),pt.applyMatrix4(t),this.setXYZ(e,pt.x,pt.y,pt.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)pt.fromBufferAttribute(this,e),pt.applyNormalMatrix(t),this.setXYZ(e,pt.x,pt.y,pt.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)pt.fromBufferAttribute(this,e),pt.transformDirection(t),this.setXYZ(e,pt.x,pt.y,pt.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let s=this.array[t*this.itemSize+e];return this.normalized&&(s=re(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=Z(s,this.array)),this.array[t*this.itemSize+e]=s,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=re(e,this.array)),e}setX(t,e){return this.normalized&&(e=Z(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=re(e,this.array)),e}setY(t,e){return this.normalized&&(e=Z(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=re(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Z(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=re(e,this.array)),e}setW(t,e){return this.normalized&&(e=Z(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=Z(e,this.array),s=Z(s,this.array)),this.array[t+0]=e,this.array[t+1]=s,this}setXYZ(t,e,s,i){return t*=this.itemSize,this.normalized&&(e=Z(e,this.array),s=Z(s,this.array),i=Z(i,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this}setXYZW(t,e,s,i,o){return t*=this.itemSize,this.normalized&&(e=Z(e,this.array),s=Z(s,this.array),i=Z(i,this.array),o=Z(o,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this.array[t+3]=o,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==pn&&(t.usage=this.usage),t}}class $d extends Xe{constructor(t,e,s){super(new Uint16Array(t),e,s)}}class Yd extends Xe{constructor(t,e,s){super(new Uint32Array(t),e,s)}}class Lo extends Xe{constructor(t,e,s){super(new Float32Array(t),e,s)}}let Zd=0;const Jt=new ft,ro=new Ft,Rs=new v,qt=new Ai,ai=new Ai,wt=new v;class An extends ms{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Zd++}),this.uuid=Le(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Ed(t)?Yd:$d)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,s=0){this.groups.push({start:t,count:e,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const o=new ve().getNormalMatrix(t);s.applyNormalMatrix(o),s.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Jt.makeRotationFromQuaternion(t),this.applyMatrix4(Jt),this}rotateX(t){return Jt.makeRotationX(t),this.applyMatrix4(Jt),this}rotateY(t){return Jt.makeRotationY(t),this.applyMatrix4(Jt),this}rotateZ(t){return Jt.makeRotationZ(t),this.applyMatrix4(Jt),this}translate(t,e,s){return Jt.makeTranslation(t,e,s),this.applyMatrix4(Jt),this}scale(t,e,s){return Jt.makeScale(t,e,s),this.applyMatrix4(Jt),this}lookAt(t){return ro.lookAt(t),ro.updateMatrix(),this.applyMatrix4(ro.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Rs).negate(),this.translate(Rs.x,Rs.y,Rs.z),this}setFromPoints(t){const e=[];for(let s=0,i=t.length;s<i;s++){const o=t[s];e.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new Lo(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ai);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new v(-1/0,-1/0,-1/0),new v(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let s=0,i=e.length;s<i;s++){const o=e[s];qt.setFromBufferAttribute(o),this.morphTargetsRelative?(wt.addVectors(this.boundingBox.min,qt.min),this.boundingBox.expandByPoint(wt),wt.addVectors(this.boundingBox.max,qt.max),this.boundingBox.expandByPoint(wt)):(this.boundingBox.expandByPoint(qt.min),this.boundingBox.expandByPoint(qt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new nr);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new v,1/0);return}if(t){const s=this.boundingSphere.center;if(qt.setFromBufferAttribute(t),e)for(let o=0,r=e.length;o<r;o++){const a=e[o];ai.setFromBufferAttribute(a),this.morphTargetsRelative?(wt.addVectors(qt.min,ai.min),qt.expandByPoint(wt),wt.addVectors(qt.max,ai.max),qt.expandByPoint(wt)):(qt.expandByPoint(ai.min),qt.expandByPoint(ai.max))}qt.getCenter(s);let i=0;for(let o=0,r=t.count;o<r;o++)wt.fromBufferAttribute(t,o),i=Math.max(i,s.distanceToSquared(wt));if(e)for(let o=0,r=e.length;o<r;o++){const a=e[o],h=this.morphTargetsRelative;for(let c=0,l=a.count;c<l;c++)wt.fromBufferAttribute(a,c),h&&(Rs.fromBufferAttribute(t,c),wt.add(Rs)),i=Math.max(i,s.distanceToSquared(wt))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=e.position,i=e.normal,o=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Xe(new Float32Array(4*s.count),4));const r=this.getAttribute("tangent"),a=[],h=[];for(let L=0;L<s.count;L++)a[L]=new v,h[L]=new v;const c=new v,l=new v,u=new v,d=new W,p=new W,m=new W,y=new v,w=new v;function S(L,K,rt){c.fromBufferAttribute(s,L),l.fromBufferAttribute(s,K),u.fromBufferAttribute(s,rt),d.fromBufferAttribute(o,L),p.fromBufferAttribute(o,K),m.fromBufferAttribute(o,rt),l.sub(c),u.sub(c),p.sub(d),m.sub(d);const lt=1/(p.x*m.y-m.x*p.y);isFinite(lt)&&(y.copy(l).multiplyScalar(m.y).addScaledVector(u,-p.y).multiplyScalar(lt),w.copy(u).multiplyScalar(p.x).addScaledVector(l,-m.x).multiplyScalar(lt),a[L].add(y),a[K].add(y),a[rt].add(y),h[L].add(w),h[K].add(w),h[rt].add(w))}let R=this.groups;R.length===0&&(R=[{start:0,count:t.count}]);for(let L=0,K=R.length;L<K;++L){const rt=R[L],lt=rt.start,Ot=rt.count;for(let yt=lt,Pe=lt+Ot;yt<Pe;yt+=3)S(t.getX(yt+0),t.getX(yt+1),t.getX(yt+2))}const z=new v,C=new v,O=new v,P=new v;function F(L){O.fromBufferAttribute(i,L),P.copy(O);const K=a[L];z.copy(K),z.sub(O.multiplyScalar(O.dot(K))).normalize(),C.crossVectors(P,K);const lt=C.dot(h[L])<0?-1:1;r.setXYZW(L,z.x,z.y,z.z,lt)}for(let L=0,K=R.length;L<K;++L){const rt=R[L],lt=rt.start,Ot=rt.count;for(let yt=lt,Pe=lt+Ot;yt<Pe;yt+=3)F(t.getX(yt+0)),F(t.getX(yt+1)),F(t.getX(yt+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new Xe(new Float32Array(e.count*3),3),this.setAttribute("normal",s);else for(let d=0,p=s.count;d<p;d++)s.setXYZ(d,0,0,0);const i=new v,o=new v,r=new v,a=new v,h=new v,c=new v,l=new v,u=new v;if(t)for(let d=0,p=t.count;d<p;d+=3){const m=t.getX(d+0),y=t.getX(d+1),w=t.getX(d+2);i.fromBufferAttribute(e,m),o.fromBufferAttribute(e,y),r.fromBufferAttribute(e,w),l.subVectors(r,o),u.subVectors(i,o),l.cross(u),a.fromBufferAttribute(s,m),h.fromBufferAttribute(s,y),c.fromBufferAttribute(s,w),a.add(l),h.add(l),c.add(l),s.setXYZ(m,a.x,a.y,a.z),s.setXYZ(y,h.x,h.y,h.z),s.setXYZ(w,c.x,c.y,c.z)}else for(let d=0,p=e.count;d<p;d+=3)i.fromBufferAttribute(e,d+0),o.fromBufferAttribute(e,d+1),r.fromBufferAttribute(e,d+2),l.subVectors(r,o),u.subVectors(i,o),l.cross(u),s.setXYZ(d+0,l.x,l.y,l.z),s.setXYZ(d+1,l.x,l.y,l.z),s.setXYZ(d+2,l.x,l.y,l.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,s=t.count;e<s;e++)wt.fromBufferAttribute(t,e),wt.normalize(),t.setXYZ(e,wt.x,wt.y,wt.z)}toNonIndexed(){function t(a,h){const c=a.array,l=a.itemSize,u=a.normalized,d=new c.constructor(h.length*l);let p=0,m=0;for(let y=0,w=h.length;y<w;y++){a.isInterleavedBufferAttribute?p=h[y]*a.data.stride+a.offset:p=h[y]*l;for(let S=0;S<l;S++)d[m++]=c[p++]}return new Xe(d,l,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new An,s=this.index.array,i=this.attributes;for(const a in i){const h=i[a],c=t(h,s);e.setAttribute(a,c)}const o=this.morphAttributes;for(const a in o){const h=[],c=o[a];for(let l=0,u=c.length;l<u;l++){const d=c[l],p=t(d,s);h.push(p)}e.morphAttributes[a]=h}e.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let a=0,h=r.length;a<h;a++){const c=r[a];e.addGroup(c.start,c.count,c.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const c in h)h[c]!==void 0&&(t[c]=h[c]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const s=this.attributes;for(const h in s){const c=s[h];t.data.attributes[h]=c.toJSON(t.data)}const i={};let o=!1;for(const h in this.morphAttributes){const c=this.morphAttributes[h],l=[];for(let u=0,d=c.length;u<d;u++){const p=c[u];l.push(p.toJSON(t.data))}l.length>0&&(i[h]=l,o=!0)}o&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(t.data.groups=JSON.parse(JSON.stringify(r)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const s=t.index;s!==null&&this.setIndex(s.clone(e));const i=t.attributes;for(const c in i){const l=i[c];this.setAttribute(c,l.clone(e))}const o=t.morphAttributes;for(const c in o){const l=[],u=o[c];for(let d=0,p=u.length;d<p;d++)l.push(u[d].clone(e));this.morphAttributes[c]=l}this.morphTargetsRelative=t.morphTargetsRelative;const r=t.groups;for(let c=0,l=r.length;c<l;c++){const u=r[c];this.addGroup(u.start,u.count,u.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const h=t.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const oa=new ft,ss=new Dd,Ji=new nr,ra=new v,Vs=new v,Cs=new v,Es=new v,ao=new v,Qi=new v,Ki=new W,tn=new W,en=new W,aa=new v,ha=new v,ca=new v,sn=new v,nn=new v;class Jd extends Ft{constructor(t=new An,e=new Mh){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,r=i.length;o<r;o++){const a=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}getVertexPosition(t,e){const s=this.geometry,i=s.attributes.position,o=s.morphAttributes.position,r=s.morphTargetsRelative;e.fromBufferAttribute(i,t);const a=this.morphTargetInfluences;if(o&&a){Qi.set(0,0,0);for(let h=0,c=o.length;h<c;h++){const l=a[h],u=o[h];l!==0&&(ao.fromBufferAttribute(u,t),r?Qi.addScaledVector(ao,l):Qi.addScaledVector(ao.sub(e),l))}e.add(Qi)}return e}raycast(t,e){const s=this.geometry,i=this.material,o=this.matrixWorld;i!==void 0&&(s.boundingSphere===null&&s.computeBoundingSphere(),Ji.copy(s.boundingSphere),Ji.applyMatrix4(o),ss.copy(t.ray).recast(t.near),!(Ji.containsPoint(ss.origin)===!1&&(ss.intersectSphere(Ji,ra)===null||ss.origin.distanceToSquared(ra)>(t.far-t.near)**2))&&(oa.copy(o).invert(),ss.copy(t.ray).applyMatrix4(oa),!(s.boundingBox!==null&&ss.intersectsBox(s.boundingBox)===!1)&&this._computeIntersections(t,e,ss)))}_computeIntersections(t,e,s){let i;const o=this.geometry,r=this.material,a=o.index,h=o.attributes.position,c=o.attributes.uv,l=o.attributes.uv1,u=o.attributes.normal,d=o.groups,p=o.drawRange;if(a!==null)if(Array.isArray(r))for(let m=0,y=d.length;m<y;m++){const w=d[m],S=r[w.materialIndex],R=Math.max(w.start,p.start),z=Math.min(a.count,Math.min(w.start+w.count,p.start+p.count));for(let C=R,O=z;C<O;C+=3){const P=a.getX(C),F=a.getX(C+1),L=a.getX(C+2);i=on(this,S,t,s,c,l,u,P,F,L),i&&(i.faceIndex=Math.floor(C/3),i.face.materialIndex=w.materialIndex,e.push(i))}}else{const m=Math.max(0,p.start),y=Math.min(a.count,p.start+p.count);for(let w=m,S=y;w<S;w+=3){const R=a.getX(w),z=a.getX(w+1),C=a.getX(w+2);i=on(this,r,t,s,c,l,u,R,z,C),i&&(i.faceIndex=Math.floor(w/3),e.push(i))}}else if(h!==void 0)if(Array.isArray(r))for(let m=0,y=d.length;m<y;m++){const w=d[m],S=r[w.materialIndex],R=Math.max(w.start,p.start),z=Math.min(h.count,Math.min(w.start+w.count,p.start+p.count));for(let C=R,O=z;C<O;C+=3){const P=C,F=C+1,L=C+2;i=on(this,S,t,s,c,l,u,P,F,L),i&&(i.faceIndex=Math.floor(C/3),i.face.materialIndex=w.materialIndex,e.push(i))}}else{const m=Math.max(0,p.start),y=Math.min(h.count,p.start+p.count);for(let w=m,S=y;w<S;w+=3){const R=w,z=w+1,C=w+2;i=on(this,r,t,s,c,l,u,R,z,C),i&&(i.faceIndex=Math.floor(w/3),e.push(i))}}}}function Qd(n,t,e,s,i,o,r,a){let h;if(t.side===ch?h=s.intersectTriangle(r,o,i,!0,a):h=s.intersectTriangle(i,o,r,t.side===Eo,a),h===null)return null;nn.copy(a),nn.applyMatrix4(n.matrixWorld);const c=e.ray.origin.distanceTo(nn);return c<e.near||c>e.far?null:{distance:c,point:nn.clone(),object:n}}function on(n,t,e,s,i,o,r,a,h,c){n.getVertexPosition(a,Vs),n.getVertexPosition(h,Cs),n.getVertexPosition(c,Es);const l=Qd(n,t,e,s,Vs,Cs,Es,sn);if(l){i&&(Ki.fromBufferAttribute(i,a),tn.fromBufferAttribute(i,h),en.fromBufferAttribute(i,c),l.uv=xe.getInterpolation(sn,Vs,Cs,Es,Ki,tn,en,new W)),o&&(Ki.fromBufferAttribute(o,a),tn.fromBufferAttribute(o,h),en.fromBufferAttribute(o,c),l.uv1=xe.getInterpolation(sn,Vs,Cs,Es,Ki,tn,en,new W)),r&&(aa.fromBufferAttribute(r,a),ha.fromBufferAttribute(r,h),ca.fromBufferAttribute(r,c),l.normal=xe.getInterpolation(sn,Vs,Cs,Es,aa,ha,ca,new v),l.normal.dot(s.direction)>0&&l.normal.multiplyScalar(-1));const u={a,b:h,c,normal:new v,materialIndex:0};xe.getNormal(Vs,Cs,Es,u.normal),l.face=u}return l}class wh extends Ft{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ft,this.projectionMatrix=new ft,this.projectionMatrixInverse=new ft,this.coordinateSystem=Ie}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const We=new v,la=new W,ua=new W;class Th extends wh{constructor(t=50,e=1,s=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=s,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=Ni*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(mi*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Ni*2*Math.atan(Math.tan(mi*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,s){We.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(We.x,We.y).multiplyScalar(-t/We.z),We.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(We.x,We.y).multiplyScalar(-t/We.z)}getViewSize(t,e){return this.getViewBounds(t,la,ua),e.subVectors(ua,la)}setViewOffset(t,e,s,i,o,r){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=s,this.view.offsetY=i,this.view.width=o,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(mi*.5*this.fov)/this.zoom,s=2*e,i=this.aspect*s,o=-.5*i;const r=this.view;if(this.view!==null&&this.view.enabled){const h=r.fullWidth,c=r.fullHeight;o+=r.offsetX*i/h,e-=r.offsetY*s/c,i*=r.width/h,s*=r.height/c}const a=this.filmOffset;a!==0&&(o+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+i,e,e-s,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const ho=new v,Kd=new v,tp=new ve;class rs{constructor(t=new v(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,s,i){return this.normal.set(t,e,s),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,s){const i=ho.subVectors(s,e).cross(Kd.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const s=t.delta(ho),i=this.normal.dot(s);if(i===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const o=-(t.start.dot(this.normal)+this.constant)/i;return o<0||o>1?null:e.copy(t.start).addScaledVector(s,o)}intersectsLine(t){const e=this.distanceToPoint(t.start),s=this.distanceToPoint(t.end);return e<0&&s>0||s<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const s=e||tp.getNormalMatrix(t),i=this.coplanarPoint(ho).applyMatrix4(t),o=this.normal.applyMatrix3(s).normalize();return this.constant=-i.dot(o),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const is=new nr,rn=new v;class ep{constructor(t=new rs,e=new rs,s=new rs,i=new rs,o=new rs,r=new rs){this.planes=[t,e,s,i,o,r]}set(t,e,s,i,o,r){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(s),a[3].copy(i),a[4].copy(o),a[5].copy(r),this}copy(t){const e=this.planes;for(let s=0;s<6;s++)e[s].copy(t.planes[s]);return this}setFromProjectionMatrix(t,e=Ie){const s=this.planes,i=t.elements,o=i[0],r=i[1],a=i[2],h=i[3],c=i[4],l=i[5],u=i[6],d=i[7],p=i[8],m=i[9],y=i[10],w=i[11],S=i[12],R=i[13],z=i[14],C=i[15];if(s[0].setComponents(h-o,d-c,w-p,C-S).normalize(),s[1].setComponents(h+o,d+c,w+p,C+S).normalize(),s[2].setComponents(h+r,d+l,w+m,C+R).normalize(),s[3].setComponents(h-r,d-l,w-m,C-R).normalize(),s[4].setComponents(h-a,d-u,w-y,C-z).normalize(),e===Ie)s[5].setComponents(h+a,d+u,w+y,C+z).normalize();else if(e===xi)s[5].setComponents(a,u,y,z).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),is.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),is.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(is)}intersectsSprite(t){return is.center.set(0,0,0),is.radius=.7071067811865476,is.applyMatrix4(t.matrixWorld),this.intersectsSphere(is)}intersectsSphere(t){const e=this.planes,s=t.center,i=-t.radius;for(let o=0;o<6;o++)if(e[o].distanceToPoint(s)<i)return!1;return!0}intersectsBox(t){const e=this.planes;for(let s=0;s<6;s++){const i=e[s];if(rn.x=i.normal.x>0?t.max.x:t.min.x,rn.y=i.normal.y>0?t.max.y:t.min.y,rn.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(rn)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let s=0;s<6;s++)if(e[s].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class vh extends wh{constructor(t=-1,e=1,s=1,i=-1,o=.1,r=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=s,this.bottom=i,this.near=o,this.far=r,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,s,i,o,r){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=s,this.view.offsetY=i,this.view.width=o,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let o=s-t,r=s+t,a=i+e,h=i-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=c*this.view.offsetX,r=o+c*this.view.width,a-=l*this.view.offsetY,h=a-l*this.view.height}this.projectionMatrix.makeOrthographic(o,r,a,h,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}class zn extends ce{constructor(t,e,s,i,o,r,a,h,c,l=qn){if(l!==qn&&l!==kr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&l===qn&&(s=hd),s===void 0&&l===kr&&(s=ld),super(null,i,o,r,a,h,l,s,c),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:$e,this.minFilter=h!==void 0?h:$e,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}const sp=new zn(1,1);sp.compareFunction=fd;class Sh{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=pn,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=Le()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return yh("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,s){t*=this.stride,s*=e.stride;for(let i=0,o=this.stride;i<o;i++)this.array[t+i]=e.array[s+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Le()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(e,this.stride);return s.setUsage(this.usage),s}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Le()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Pt=new v;class or{constructor(t,e,s,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=s,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,s=this.data.count;e<s;e++)Pt.fromBufferAttribute(this,e),Pt.applyMatrix4(t),this.setXYZ(e,Pt.x,Pt.y,Pt.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)Pt.fromBufferAttribute(this,e),Pt.applyNormalMatrix(t),this.setXYZ(e,Pt.x,Pt.y,Pt.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)Pt.fromBufferAttribute(this,e),Pt.transformDirection(t),this.setXYZ(e,Pt.x,Pt.y,Pt.z);return this}getComponent(t,e){let s=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(s=re(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=Z(s,this.array)),this.data.array[t*this.data.stride+this.offset+e]=s,this}setX(t,e){return this.normalized&&(e=Z(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Z(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Z(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Z(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=re(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=re(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=re(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=re(e,this.array)),e}setXY(t,e,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=Z(e,this.array),s=Z(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this}setXYZ(t,e,s,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Z(e,this.array),s=Z(s,this.array),i=Z(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this}setXYZW(t,e,s,i,o){return t=t*this.data.stride+this.offset,this.normalized&&(e=Z(e,this.array),s=Z(s,this.array),i=Z(i,this.array),o=Z(o,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this.data.array[t+3]=o,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)e.push(this.data.array[i+o])}return new Xe(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new or(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)e.push(this.data.array[i+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ip extends Yt{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new it(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}class np extends Xe{constructor(t,e,s,i=1){super(t,e,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}class bh extends Yt{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new it(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}class _h extends Yt{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new it(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}class Ah extends ce{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=$e,this.minFilter=$e,this.generateMipmaps=!1,this.needsUpdate=!0}}class op extends Yt{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new it(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class zh extends Yt{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new it(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new it(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ye,this.normalScale=new W(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ke,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class rp extends zh{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new W(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return It(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new it(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new it(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new it(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class ap extends Yt{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new it(16777215),this.specular=new it(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new it(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ye,this.normalScale=new W(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ke,this.combine=sr,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class hp extends Yt{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new it(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new it(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ye,this.normalScale=new W(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class cp extends Yt{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ye,this.normalScale=new W(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class lp extends Yt{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new it(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new it(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ye,this.normalScale=new W(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ke,this.combine=sr,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class up extends Yt{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new it(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ye,this.normalScale=new W(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Rh extends bh{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}class zi extends Ft{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new it(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}}class dp extends zi{constructor(t,e,s){super(t,s),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ft.DEFAULT_UP),this.updateMatrix(),this.groundColor=new it(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const co=new ft,da=new v,pa=new v;class rr{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new W(512,512),this.map=null,this.mapPass=null,this.matrix=new ft,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ep,this._frameExtents=new W(1,1),this._viewportCount=1,this._viewports=[new xt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,s=this.matrix;da.setFromMatrixPosition(t.matrixWorld),e.position.copy(da),pa.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(pa),e.updateMatrixWorld(),co.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(co),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(co)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class pp extends rr{constructor(){super(new Th(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,s=Ni*2*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,o=t.distance||e.far;(s!==e.fov||i!==e.aspect||o!==e.far)&&(e.fov=s,e.aspect=i,e.far=o,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class Vh extends zi{constructor(t,e,s=0,i=Math.PI/3,o=0,r=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ft.DEFAULT_UP),this.updateMatrix(),this.target=new Ft,this.distance=s,this.angle=i,this.penumbra=o,this.decay=r,this.map=null,this.shadow=new pp}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const ma=new ft,hi=new v,lo=new v;class mp extends rr{constructor(){super(new Th(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new W(4,2),this._viewportCount=6,this._viewports=[new xt(2,1,1,1),new xt(0,1,1,1),new xt(3,1,1,1),new xt(1,1,1,1),new xt(3,0,1,1),new xt(1,0,1,1)],this._cubeDirections=[new v(1,0,0),new v(-1,0,0),new v(0,0,1),new v(0,0,-1),new v(0,1,0),new v(0,-1,0)],this._cubeUps=[new v(0,1,0),new v(0,1,0),new v(0,1,0),new v(0,1,0),new v(0,0,1),new v(0,0,-1)]}updateMatrices(t,e=0){const s=this.camera,i=this.matrix,o=t.distance||s.far;o!==s.far&&(s.far=o,s.updateProjectionMatrix()),hi.setFromMatrixPosition(t.matrixWorld),s.position.copy(hi),lo.copy(s.position),lo.add(this._cubeDirections[e]),s.up.copy(this._cubeUps[e]),s.lookAt(lo),s.updateMatrixWorld(),i.makeTranslation(-hi.x,-hi.y,-hi.z),ma.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ma)}}class fp extends zi{constructor(t,e,s=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=s,this.decay=i,this.shadow=new mp}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class gp extends rr{constructor(){super(new vh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class yp extends zi{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ft.DEFAULT_UP),this.updateMatrix(),this.target=new Ft,this.shadow=new gp}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class xp extends zi{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class Np extends Sh{constructor(t,e,s=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=s}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:hh}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=hh);function Ch(n,t=!1){let e="{";n.isNode===!0&&(e+=n.id);for(const{property:s,childNode:i}of mn(n))e+=","+s.slice(0,-4)+":"+i.getCacheKey(t);return e+="}",e}function*mn(n,t=!1){for(const e in n){if(e.startsWith("_")===!0)continue;const s=n[e];if(Array.isArray(s)===!0)for(let i=0;i<s.length;i++){const o=s[i];o&&(o.isNode===!0||t&&typeof o.toJSON=="function")&&(yield{property:e,index:i,childNode:o})}else if(s&&s.isNode===!0)yield{property:e,childNode:s};else if(typeof s=="object")for(const i in s){const o=s[i];o&&(o.isNode===!0||t&&typeof o.toJSON=="function")&&(yield{property:e,index:i,childNode:o})}}}function He(n){if(n==null)return null;const t=typeof n;return n.isNode===!0?"node":t==="number"?"float":t==="boolean"?"bool":t==="string"?"string":t==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function Eh(n,...t){const e=n?n.slice(-4):void 0;return t.length===1&&(e==="vec2"?t=[t[0],t[0]]:e==="vec3"?t=[t[0],t[0],t[0]]:e==="vec4"&&(t=[t[0],t[0],t[0],t[0]])),n==="color"?new it(...t):e==="vec2"?new W(...t):e==="vec3"?new v(...t):e==="vec4"?new xt(...t):e==="mat3"?new ve(...t):e==="mat4"?new ft(...t):n==="bool"?t[0]||!1:n==="float"||n==="int"||n==="uint"?t[0]||0:n==="string"?t[0]||"":n==="ArrayBuffer"?Fh(t[0]):null}function Ih(n){let t="";const e=new Uint8Array(n);for(let s=0;s<e.length;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function Fh(n){return Uint8Array.from(atob(n),t=>t.charCodeAt(0)).buffer}const fa=new Map;let Mp=0;class k extends ms{constructor(t=null){super(),this.nodeType=t,this.updateType=st.NONE,this.updateBeforeType=st.NONE,this.uuid=gh.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.global=!1,this.isNode=!0,Object.defineProperty(this,"id",{value:Mp++})}set needsUpdate(t){t===!0&&this.version++}get type(){return this.constructor.type}onUpdate(t,e){return this.updateType=e,this.update=t.bind(this.getSelf()),this}onFrameUpdate(t){return this.onUpdate(t,st.FRAME)}onRenderUpdate(t){return this.onUpdate(t,st.RENDER)}onObjectUpdate(t){return this.onUpdate(t,st.OBJECT)}onReference(t){return this.updateReference=t.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:t}of mn(this))yield t}dispose(){this.dispatchEvent({type:"dispose"})}traverse(t){t(this);for(const e of this.getChildren())e.traverse(t)}getCacheKey(t=!1){return t=t||this.version!==this._cacheKeyVersion,(t===!0||this._cacheKey===null)&&(this._cacheKey=Ch(this,t),this._cacheKeyVersion=this.version),this._cacheKey}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getElementType(t){const e=this.getNodeType(t);return t.getElementType(e)}getNodeType(t){const e=t.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(t):this.nodeType}getShared(t){const e=this.getHash(t);return t.getNodeFromHash(e)||this}setup(t){const e=t.getNodeProperties(this);let s=0;for(const i of this.getChildren())e["node"+s++]=i;return null}construct(t){return console.warn("THREE.Node: construct() is deprecated. Use setup() instead."),this.setup(t)}increaseUsage(t){const e=t.getDataFromNode(this);return e.usageCount=e.usageCount===void 0?1:e.usageCount+1,e.usageCount}analyze(t){if(this.increaseUsage(t)===1){const s=t.getNodeProperties(this);for(const i of Object.values(s))i&&i.isNode===!0&&i.build(t)}}generate(t,e){const{outputNode:s}=t.getNodeProperties(this);if(s&&s.isNode===!0)return s.build(t,e)}updateBefore(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(t,e=null){const s=this.getShared(t);if(this!==s)return s.build(t,e);t.addNode(this),t.addChain(this);let i=null;const o=t.getBuildStage();if(o==="setup"){this.updateReference(t);const r=t.getNodeProperties(this);if(r.initialized!==!0||t.context.tempRead===!1){const a=t.stack.nodes.length;r.initialized=!0,r.outputNode=this.setup(t),r.outputNode!==null&&t.stack.nodes.length!==a&&(r.outputNode=t.stack);for(const h of Object.values(r))h&&h.isNode===!0&&h.build(t)}}else if(o==="analyze")this.analyze(t);else if(o==="generate")if(this.generate.length===1){const a=this.getNodeType(t),h=t.getDataFromNode(this);i=h.snippet,i===void 0&&(i=this.generate(t)||"",h.snippet=i),i=t.format(i,a,e)}else i=this.generate(t,e)||"";return t.removeChain(this),i}getSerializeChildren(){return mn(this)}serialize(t){const e=this.getSerializeChildren(),s={};for(const{property:i,index:o,childNode:r}of e)o!==void 0?(s[i]===void 0&&(s[i]=Number.isInteger(o)?[]:{}),s[i][o]=r.toJSON(t.meta).uuid):s[i]=r.toJSON(t.meta).uuid;Object.keys(s).length>0&&(t.inputNodes=s)}deserialize(t){if(t.inputNodes!==void 0){const e=t.meta.nodes;for(const s in t.inputNodes)if(Array.isArray(t.inputNodes[s])){const i=[];for(const o of t.inputNodes[s])i.push(e[o]);this[s]=i}else if(typeof t.inputNodes[s]=="object"){const i={};for(const o in t.inputNodes[s]){const r=t.inputNodes[s][o];i[o]=e[r]}this[s]=i}else{const i=t.inputNodes[s];this[s]=e[i]}}}toJSON(t){const{uuid:e,type:s}=this,i=t===void 0||typeof t=="string";i&&(t={textures:{},images:{},nodes:{}});let o=t.nodes[e];o===void 0&&(o={uuid:e,type:s,meta:t,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},i!==!0&&(t.nodes[o.uuid]=o),this.serialize(o),delete o.meta);function r(a){const h=[];for(const c in a){const l=a[c];delete l.metadata,h.push(l)}return h}if(i){const a=r(t.textures),h=r(t.images),c=r(t.nodes);a.length>0&&(o.textures=a),h.length>0&&(o.images=h),c.length>0&&(o.nodes=c)}return o}}function A(n,t){if(typeof t!="function"||!n)throw new Error(`Node class ${n} is not a class`);if(fa.has(n)){console.warn(`Redefinition of node class ${n}`);return}fa.set(n,t),t.type=n}class tt extends k{constructor(t){super(t),this.isTempNode=!0}hasDependencies(t){return t.getDataFromNode(this).usageCount>1}build(t,e){if(t.getBuildStage()==="generate"){const i=t.getVectorType(this.getNodeType(t,e)),o=t.getDataFromNode(this);if(t.context.tempRead!==!1&&o.propertyName!==void 0)return t.format(o.propertyName,i,e);if(t.context.tempWrite!==!1&&i!=="void"&&e!=="void"&&this.hasDependencies(t)){const r=super.build(t,i),a=t.getVarFromNode(this,null,i),h=t.getPropertyName(a);return t.addLineFlowCode(`${h} = ${r}`),o.snippet=r,o.propertyName=h,t.format(o.propertyName,i,e)}}return super.build(t,e)}}A("TempNode",tt);class Ys extends k{constructor(t,e){super(),this.node=t,this.indexNode=e,this.isArrayElementNode=!0}getNodeType(t){return this.node.getElementType(t)}generate(t){const e=this.node.build(t),s=this.indexNode.build(t,"uint");return`${e}[ ${s} ]`}}A("ArrayElementNode",Ys);class ar extends k{constructor(t,e){super(),this.node=t,this.convertTo=e}getNodeType(t){const e=this.node.getNodeType(t);let s=null;for(const i of this.convertTo.split("|"))(s===null||t.getTypeLength(e)===t.getTypeLength(i))&&(s=i);return s}serialize(t){super.serialize(t),t.convertTo=this.convertTo}deserialize(t){super.deserialize(t),this.convertTo=t.convertTo}generate(t,e){const s=this.node,i=this.getNodeType(t),o=s.build(t,i);return t.format(o,i,e)}}A("ConvertNode",ar);class Lh extends tt{constructor(t=[],e=null){super(e),this.nodes=t}getNodeType(t){return this.nodeType!==null?t.getVectorType(this.nodeType):t.getTypeFromLength(this.nodes.reduce((e,s)=>e+t.getTypeLength(s.getNodeType(t)),0))}generate(t,e){const s=this.getNodeType(t),i=this.nodes,o=t.getComponentType(s),r=[];for(const h of i){let c=h.build(t);const l=t.getComponentType(h.getNodeType(t));l!==o&&(c=t.format(c,l,o)),r.push(c)}const a=`${t.getType(s)}( ${r.join(", ")} )`;return t.format(a,s,e)}}A("JoinNode",Lh);const wp=_n.join("");class Oo extends k{constructor(t,e="x"){super(),this.node=t,this.components=e,this.isSplitNode=!0}getVectorLength(){let t=this.components.length;for(const e of this.components)t=Math.max(_n.indexOf(e)+1,t);return t}getComponentType(t){return t.getComponentType(this.node.getNodeType(t))}getNodeType(t){return t.getTypeFromLength(this.components.length,this.getComponentType(t))}generate(t,e){const s=this.node,i=t.getTypeLength(s.getNodeType(t));let o=null;if(i>1){let r=null;this.getVectorLength()>=i&&(r=t.getTypeFromLength(this.getVectorLength(),this.getComponentType(t)));const h=s.build(t,r);this.components.length===i&&this.components===wp.slice(0,this.components.length)?o=t.format(h,r,e):o=t.format(`${h}.${this.components}`,this.getNodeType(t),e)}else o=s.build(t,e);return o}serialize(t){super.serialize(t),t.components=this.components}deserialize(t){super.deserialize(t),this.components=t.components}}A("SplitNode",Oo);class Oh extends tt{constructor(t,e,s){super(),this.sourceNode=t,this.components=e,this.targetNode=s}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{sourceNode:e,components:s,targetNode:i}=this,o=this.getNodeType(t),r=t.getTypeFromLength(s.length),a=i.build(t,r),h=e.build(t,o),c=t.getTypeLength(o),l=[];for(let u=0;u<c;u++){const d=_n[u];d===s[0]?(l.push(a),u+=s.length-1):l.push(h+"."+d)}return`${t.getType(o)}( ${l.join(", ")} )`}}A("SetNode",Oh);class Rn extends k{constructor(t,e=null){super(e),this.isInputNode=!0,this.value=t,this.precision=null}getNodeType(){return this.nodeType===null?He(this.value):this.nodeType}getInputType(t){return this.getNodeType(t)}setPrecision(t){return this.precision=t,this}serialize(t){super.serialize(t),t.value=this.value,this.value&&this.value.toArray&&(t.value=this.value.toArray()),t.valueType=He(this.value),t.nodeType=this.nodeType,t.valueType==="ArrayBuffer"&&(t.value=Ih(t.value)),t.precision=this.precision}deserialize(t){super.deserialize(t),this.nodeType=t.nodeType,this.value=Array.isArray(t.value)?Eh(t.valueType,...t.value):t.value,this.precision=t.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(t.value))}generate(){console.warn("Abstract function.")}}A("InputNode",Rn);class Se extends Rn{constructor(t,e=null){super(t,e),this.isConstNode=!0}generateConst(t){return t.generateConst(this.getNodeType(t),this.value)}generate(t,e){const s=this.getNodeType(t);return t.format(this.generateConst(t),s,e)}}A("ConstNode",Se);let Hs=null;const Is=new Map;function M(n,t){if(Is.has(n)){console.warn(`Redefinition of node element ${n}`);return}if(typeof t!="function")throw new Error(`Node element ${n} is not a function`);Is.set(n,t)}const ga=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),Ph={setup(n,t){const e=t.shift();return n(En(e),...t)},get(n,t,e){if(typeof t=="string"&&n[t]===void 0){if(n.isStackNode!==!0&&t==="assign")return(...s)=>(Hs.assign(e,...s),e);if(Is.has(t)){const s=Is.get(t);return n.isStackNode?(...i)=>e.add(s(...i)):(...i)=>s(e,...i)}else{if(t==="self")return n;if(t.endsWith("Assign")&&Is.has(t.slice(0,t.length-6))){const s=Is.get(t.slice(0,t.length-6));return n.isStackNode?(...i)=>e.assign(i[0],s(...i)):(...i)=>e.assign(s(e,...i))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(t)===!0)return t=ga(t),I(new Oo(e,t));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(t)===!0)return t=ga(t.slice(3).toLowerCase()),t=t.split("").sort().join(""),s=>I(new Oh(n,t,s));if(t==="width"||t==="height"||t==="depth")return t==="width"?t="x":t==="height"?t="y":t==="depth"&&(t="z"),I(new Oo(n,t));if(/^\d+$/.test(t)===!0)return I(new Ys(e,new Se(Number(t),"uint")))}}}return Reflect.get(n,t,e)},set(n,t,e,s){return typeof t=="string"&&n[t]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(t)===!0||t==="width"||t==="height"||t==="depth"||/^\d+$/.test(t)===!0)?(s[t].assign(e),!0):Reflect.set(n,t,e,s)}},uo=new WeakMap,ya=new WeakMap,Tp=function(n,t=null){const e=He(n);if(e==="node"){let s=uo.get(n);return s===void 0&&(s=new Proxy(n,Ph),uo.set(n,s),uo.set(s,s)),s}else{if(t===null&&(e==="float"||e==="boolean")||e&&e!=="shader"&&e!=="string")return I(Po(n,t));if(e==="shader")return b(n)}return n},vp=function(n,t=null){for(const e in n)n[e]=I(n[e],t);return n},Sp=function(n,t=null){const e=n.length;for(let s=0;s<e;s++)n[s]=I(n[s],t);return n},bp=function(n,t=null,e=null,s=null){const i=o=>I(s!==null?Object.assign(o,s):o);return t===null?(...o)=>i(new n(...Bs(o))):e!==null?(e=I(e),(...o)=>i(new n(t,...Bs(o),e))):(...o)=>i(new n(t,...Bs(o)))},_p=function(n,...t){return I(new n(...Bs(t)))};class Ap extends k{constructor(t,e){super(),this.shaderNode=t,this.inputNodes=e}getNodeType(t){const e=t.getNodeProperties(this);return e.outputNode===null&&(e.outputNode=this.setupOutput(t)),e.outputNode.getNodeType(t)}call(t){const{shaderNode:e,inputNodes:s}=this;if(e.layout){let r=ya.get(t.constructor);r===void 0&&(r=new WeakMap,ya.set(t.constructor,r));let a=r.get(e);return a===void 0&&(a=I(t.buildFunctionNode(e)),r.set(e,a)),t.currentFunctionNode!==null&&t.currentFunctionNode.includes.push(a),I(a.call(s))}const i=e.jsFunc,o=s!==null?i(s,t.stack,t):i(t.stack,t);return I(o)}setup(t){const{outputNode:e}=t.getNodeProperties(this);return e||this.setupOutput(t)}setupOutput(t){return t.addStack(),t.stack.outputNode=this.call(t),t.removeStack()}generate(t,e){const{outputNode:s}=t.getNodeProperties(this);return s===null?this.call(t).build(t,e):super.generate(t,e)}}class zp extends k{constructor(t){super(),this.jsFunc=t,this.layout=null}get isArrayInput(){return/^\((\s+)?\[/.test(this.jsFunc.toString())}setLayout(t){return this.layout=t,this}call(t=null){return En(t),I(new Ap(this,t))}setup(){return this.call()}}const Rp=[!1,!0],Vp=[0,1,2,3],Cp=[-1,-2],Bh=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],hr=new Map;for(const n of Rp)hr.set(n,new Se(n));const cr=new Map;for(const n of Vp)cr.set(n,new Se(n,"uint"));const lr=new Map([...cr].map(n=>new Se(n.value,"int")));for(const n of Cp)lr.set(n,new Se(n,"int"));const Vn=new Map([...lr].map(n=>new Se(n.value)));for(const n of Bh)Vn.set(n,new Se(n));for(const n of Bh)Vn.set(-n,new Se(-n));const Cn={bool:hr,uint:cr,ints:lr,float:Vn},xa=new Map([...hr,...Vn]),Po=(n,t)=>xa.has(n)?xa.get(n):n.isNode===!0?n:new Se(n,t),Ep=n=>{try{return n.getNodeType()}catch{return}},J=function(n,t=null){return(...e)=>{if((e.length===0||!["bool","float","int","uint"].includes(n)&&e.every(i=>typeof i!="object"))&&(e=[Eh(n,...e)]),e.length===1&&t!==null&&t.has(e[0]))return I(t.get(e[0]));if(e.length===1){const i=Po(e[0],n);return Ep(i)===n?I(i):I(new ar(i,n))}const s=e.map(i=>Po(i));return I(new Lh(s,n))}},Na=n=>n&&n.value,Ip=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function gi(n){return new Proxy(new zp(n),Ph)}const I=(n,t=null)=>Tp(n,t),En=(n,t=null)=>new vp(n,t),Bs=(n,t=null)=>new Sp(n,t),T=(...n)=>new bp(...n),V=(...n)=>new _p(...n),b=n=>{const t=new gi(n),e=(...s)=>{let i;return En(s),s[0]&&s[0].isNode?i=[...s]:i=s[0],t.call(i)};return e.shaderNode=t,e.setLayout=s=>(t.setLayout(s),e),e};A("ShaderNode",gi);M("toGlobal",n=>(n.global=!0,n));const Ma=n=>{Hs=n},Fp=()=>Hs,G=(...n)=>Hs.if(...n);function Lp(n){return Hs&&Hs.add(n),n}M("append",Lp);const Op=new J("color"),f=new J("float",Cn.float),g=new J("int",Cn.ints),E=new J("uint",Cn.uint),us=new J("bool",Cn.bool),D=new J("vec2"),cs=new J("ivec2"),Pp=new J("uvec2"),Bp=new J("bvec2"),x=new J("vec3"),Dp=new J("ivec3"),Ri=new J("uvec3"),Dh=new J("bvec3"),B=new J("vec4"),kp=new J("ivec4"),Up=new J("uvec4"),Gp=new J("bvec4"),ur=new J("mat2"),Wp=new J("imat2"),qp=new J("umat2"),Hp=new J("bmat2"),de=new J("mat3"),jp=new J("imat3"),Xp=new J("umat3"),$p=new J("bmat3"),Ds=new J("mat4"),Yp=new J("imat4"),Zp=new J("umat4"),Jp=new J("bmat4");M("toColor",Op);M("toFloat",f);M("toInt",g);M("toUint",E);M("toBool",us);M("toVec2",D);M("toIvec2",cs);M("toUvec2",Pp);M("toBvec2",Bp);M("toVec3",x);M("toIvec3",Dp);M("toUvec3",Ri);M("toBvec3",Dh);M("toVec4",B);M("toIvec4",kp);M("toUvec4",Up);M("toBvec4",Gp);M("toMat2",ur);M("toImat2",Wp);M("toUmat2",qp);M("toBmat2",Hp);M("toMat3",de);M("toImat3",jp);M("toUmat3",Xp);M("toBmat3",$p);M("toMat4",Ds);M("toImat4",Yp);M("toUmat4",Zp);M("toBmat4",Jp);const Qp=T(Ys),Kp=(n,t)=>I(new ar(I(n),t));M("element",Qp);M("convert",Kp);class kh extends tt{constructor(t,e){super(),this.targetNode=t,this.sourceNode=e}hasDependencies(){return!1}getNodeType(t,e){return e!=="void"?this.targetNode.getNodeType(t):"void"}needsSplitAssign(t){const{targetNode:e}=this;if(t.isAvailable("swizzleAssign")===!1&&e.isSplitNode&&e.components.length>1){const s=t.getTypeLength(e.node.getNodeType(t));return _n.join("").slice(0,s)!==e.components}return!1}generate(t,e){const{targetNode:s,sourceNode:i}=this,o=this.needsSplitAssign(t),r=s.getNodeType(t),a=s.context({assign:!0}).build(t),h=i.build(t,r),c=i.getNodeType(t),l=t.getDataFromNode(this);let u;if(l.initialized===!0)e!=="void"&&(u=a);else if(o){const d=t.getVarFromNode(this,null,r),p=t.getPropertyName(d);t.addLineFlowCode(`${p} = ${h}`);const m=s.node.context({assign:!0}).build(t);for(let y=0;y<s.components.length;y++){const w=s.components[y];t.addLineFlowCode(`${m}.${w} = ${p}[ ${y} ]`)}e!=="void"&&(u=a)}else u=`${a} = ${h}`,(e==="void"||c==="void")&&(t.addLineFlowCode(u),e!=="void"&&(u=a));return l.initialized=!0,t.format(u,r,e)}}const tm=T(kh);A("AssignNode",kh);M("assign",tm);class Uh extends k{constructor(t,e=null){super(),this.node=t,this.name=e,this.isVaryingNode=!0}isGlobal(){return!0}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}setupVarying(t){const e=t.getNodeProperties(this);let s=e.varying;if(s===void 0){const i=this.name,o=this.getNodeType(t);e.varying=s=t.getVaryingFromNode(this,i,o),e.node=this.node}return s.needsInterpolation||(s.needsInterpolation=t.shaderStage==="fragment"),s}setup(t){this.setupVarying(t)}generate(t){const e=t.getNodeProperties(this),s=this.setupVarying(t);if(e.propertyName===void 0){const i=this.getNodeType(t),o=t.getPropertyName(s,Er.VERTEX);t.flowNodeFromShaderStage(Er.VERTEX,this.node,i,o),e.propertyName=o}return t.getPropertyName(s)}}const gt=T(Uh);M("varying",gt);A("VaryingNode",Uh);class dr extends k{constructor(t,e=null,s=null){super(e),this.defaultNode=s,this._attributeName=t}isGlobal(){return!0}getHash(t){return this.getAttributeName(t)}getNodeType(t){let e=super.getNodeType(t);if(e===null){const s=this.getAttributeName(t);if(t.hasGeometryAttribute(s)){const i=t.geometry.getAttribute(s);e=t.getTypeFromAttribute(i)}else e="float"}return e}setAttributeName(t){return this._attributeName=t,this}getAttributeName(){return this._attributeName}generate(t){const e=this.getAttributeName(t),s=this.getNodeType(t);if(t.hasGeometryAttribute(e)===!0){const o=t.geometry.getAttribute(e),r=t.getTypeFromAttribute(o),a=t.getAttribute(e,r);return t.shaderStage==="vertex"?t.format(a.name,r,s):gt(this).build(t,s)}else{console.warn(`AttributeNode: Vertex attribute "${e}" not found on geometry.`);const{defaultNode:o}=this;return o!==null?o.build(t,s):t.generateConst(s)}}}const bt=(n,t,e)=>I(new dr(n,t,I(e)));A("AttributeNode",dr);class Gh extends k{constructor(t,e){super(),this.isBypassNode=!0,this.outputNode=t,this.callNode=e}getNodeType(t){return this.outputNode.getNodeType(t)}generate(t){const e=this.callNode.build(t,"void");return e!==""&&t.addLineFlowCode(e),this.outputNode.build(t)}}const Wh=T(Gh);M("bypass",Wh);A("BypassNode",Gh);let em=0;class sm{constructor(){this.id=em++,this.nodesData=new WeakMap}getNodeData(t){return this.nodesData.get(t)}setNodeData(t,e){this.nodesData.set(t,e)}}class qh extends k{constructor(t,e=new sm){super(),this.isCacheNode=!0,this.node=t,this.cache=e}getNodeType(t){return this.node.getNodeType(t)}build(t,...e){const s=t.getCache(),i=this.cache||t.globalCache;t.setCache(i);const o=this.node.build(t,...e);return t.setCache(s),o}}const fn=T(qh),im=n=>fn(n,null);M("cache",fn);M("globalCache",im);A("CacheNode",qh);class pr extends k{constructor(t,e={}){super(),this.isContextNode=!0,this.node=t,this.context=e}getNodeType(t){return this.node.getNodeType(t)}analyze(t){this.node.build(t)}setup(t){const e=t.getContext();t.setContext({...t.context,...this.context});const s=this.node.build(t);return t.setContext(e),s}generate(t,e){const s=t.getContext();t.setContext({...t.context,...this.context});const i=this.node.build(t,e);return t.setContext(s),i}}const Oe=T(pr),nm=(n,t)=>Oe(n,{label:t});M("context",Oe);M("label",nm);A("ContextNode",pr);class Me extends k{constructor(t){super("uint"),this.scope=t,this.isInstanceIndexNode=!0}generate(t){const e=this.getNodeType(t),s=this.scope;let i;if(s===Me.VERTEX)i=t.getVertexIndex();else if(s===Me.INSTANCE)i=t.getInstanceIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+s);let o;return t.shaderStage==="vertex"||t.shaderStage==="compute"?o=i:o=gt(this).build(t,e),o}}Me.VERTEX="vertex";Me.INSTANCE="instance";const om=V(Me,Me.VERTEX),Hh=V(Me,Me.INSTANCE);A("IndexNode",Me);class In{start(){}finish(){}direct(){}indirectDiffuse(){}indirectSpecular(){}ambientOcclusion(){}}class jh extends k{constructor(t,e=null){super(),this.node=t,this.name=e,this.isVarNode=!0}isGlobal(){return!0}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}generate(t){const{node:e,name:s}=this,i=t.getVarFromNode(this,s,t.getVectorType(this.getNodeType(t))),o=t.getPropertyName(i),r=e.build(t,i.type);return t.addLineFlowCode(`${o} = ${r}`),o}}const gn=T(jh);M("temp",gn);M("toVar",(...n)=>gn(...n).append());A("VarNode",jh);class $ extends k{constructor(t,e=null,s=!1){super(t),this.name=e,this.varying=s,this.isPropertyNode=!0}getHash(t){return this.name||super.getHash(t)}isGlobal(){return!0}generate(t){let e;return this.varying===!0?(e=t.getVaryingFromNode(this,this.name),e.needsInterpolation=!0):e=t.getVarFromNode(this,this.name),t.getPropertyName(e)}}const at=(n,t)=>I(new $(n,t)),fe=(n,t)=>I(new $(n,t,!0)),et=V($,"vec4","DiffuseColor"),je=V($,"float","Roughness"),yn=V($,"float","Metalness"),Bo=V($,"float","Clearcoat"),xn=V($,"float","ClearcoatRoughness"),Fs=V($,"vec3","Sheen"),mr=V($,"float","SheenRoughness"),fr=V($,"float","Iridescence"),Xh=V($,"float","IridescenceIOR"),$h=V($,"float","IridescenceThickness"),Do=V($,"float","AlphaT"),as=V($,"float","Anisotropy"),ln=V($,"vec3","AnisotropyT"),ks=V($,"vec3","AnisotropyB"),oe=V($,"color","SpecularColor"),Nn=V($,"float","SpecularF90"),ko=V($,"float","Shininess"),rm=V($,"vec4","Output"),Us=V($,"float","dashSize"),Mn=V($,"float","gapSize");V($,"float","pointWidth");const un=V($,"float","IOR"),Uo=V($,"float","Transmission"),Yh=V($,"float","Thickness"),Zh=V($,"float","AttenuationDistance"),Jh=V($,"color","AttenuationColor"),Qh=V($,"float","Dispersion");A("PropertyNode",$);class am extends ${constructor(t,e=null){super(t,e),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}A("ParameterNode",am);class gr extends k{constructor(t="",e=[],s=""){super("code"),this.isCodeNode=!0,this.code=t,this.language=s,this.includes=e}isGlobal(){return!0}setIncludes(t){return this.includes=t,this}getIncludes(){return this.includes}generate(t){const e=this.getIncludes(t);for(const i of e)i.build(t);const s=t.getCodeFromNode(this,this.getNodeType(t));return s.code=this.code,s.code}serialize(t){super.serialize(t),t.code=this.code,t.language=this.language}deserialize(t){super.deserialize(t),this.code=t.code,this.language=t.language}}T(gr);A("CodeNode",gr);class hm extends gr{constructor(t="",e=[],s=""){super(t,e,s),this.keywords={}}getNodeType(t){return this.getNodeFunction(t).type}getInputs(t){return this.getNodeFunction(t).inputs}getNodeFunction(t){const e=t.getDataFromNode(this);let s=e.nodeFunction;return s===void 0&&(s=t.parser.parseFunction(this.code),e.nodeFunction=s),s}generate(t,e){super.generate(t);const s=this.getNodeFunction(t),i=s.name,o=s.type,r=t.getCodeFromNode(this,o);i!==""&&(r.name=i);const a=t.getPropertyName(r);let h=this.getNodeFunction(t).getCode(a);const c=this.keywords,l=Object.keys(c);if(l.length>0)for(const u of l){const d=new RegExp(`\\b${u}\\b`,"g"),p=c[u].build(t,"property");h=h.replace(d,p)}return r.code=h+`
`,e==="property"?a:t.format(`${a}()`,o,e)}}A("FunctionNode",hm);class yr extends k{constructor(t,e=!1){super("string"),this.name=t,this.version=0,this.shared=e,this.isUniformGroup=!0}set needsUpdate(t){t===!0&&this.version++}}const cm=n=>new yr(n),Kh=n=>new yr(n,!0);Kh("frame");Kh("render");const lm=cm("object");A("UniformGroupNode",yr);class fs extends Rn{constructor(t,e=null){super(t,e),this.isUniformNode=!0,this.groupNode=lm}setGroup(t){return this.groupNode=t,this}getGroup(){return this.groupNode}getUniformHash(t){return this.getHash(t)}onUpdate(t,e){const s=this.getSelf();return t=t.bind(s),super.onUpdate(i=>{const o=t(i,s);o!==void 0&&(this.value=o)},e)}generate(t,e){const s=this.getNodeType(t),i=this.getUniformHash(t);let o=t.getNodeFromHash(i);o===void 0&&(t.setHashNode(this,i),o=this);const r=o.getInputType(t),a=t.getUniformFromNode(o,r,t.shaderStage,t.context.label),h=t.getPropertyName(a);return t.context.label!==void 0&&delete t.context.label,t.format(h,s,e)}}const j=(n,t)=>{const e=Ip(t||n),s=n&&n.isNode===!0?n.node&&n.node.value||n.value:n;return I(new fs(s,e))};A("UniformNode",fs);const be=n=>bt("uv"+(n>0?n:""),"vec2");class tc extends k{constructor(t,e=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=t,this.levelNode=e}generate(t,e){const s=this.textureNode.build(t,"property"),i=this.levelNode.build(t,"int");return t.format(`${t.getMethod("textureDimensions")}( ${s}, ${i} )`,this.getNodeType(t),e)}}const xr=T(tc);M("textureSize",xr);A("TextureSizeNode",tc);class ot extends tt{constructor(t,e,s,...i){if(super(),this.op=t,i.length>0){let o=s;for(let r=0;r<i.length;r++)o=new ot(t,o,i[r]);s=o}this.aNode=e,this.bNode=s}getNodeType(t,e){const s=this.op,i=this.aNode,o=this.bNode,r=i.getNodeType(t),a=typeof o<"u"?o.getNodeType(t):null;if(r==="void"||a==="void")return"void";if(s==="%")return r;if(s==="~"||s==="&"||s==="|"||s==="^"||s===">>"||s==="<<")return t.getIntegerType(r);if(s==="!"||s==="=="||s==="&&"||s==="||"||s==="^^")return"bool";if(s==="<"||s===">"||s==="<="||s===">="){const h=e?t.getTypeLength(e):Math.max(t.getTypeLength(r),t.getTypeLength(a));return h>1?`bvec${h}`:"bool"}else return r==="float"&&t.isMatrix(a)?a:t.isMatrix(r)&&t.isVector(a)?t.getVectorFromMatrix(r):t.isVector(r)&&t.isMatrix(a)?t.getVectorFromMatrix(a):t.getTypeLength(a)>t.getTypeLength(r)?a:r}generate(t,e){const s=this.op,i=this.aNode,o=this.bNode,r=this.getNodeType(t,e);let a=null,h=null;r!=="void"?(a=i.getNodeType(t),h=typeof o<"u"?o.getNodeType(t):null,s==="<"||s===">"||s==="<="||s===">="||s==="=="?t.isVector(a)?h=a:a=h="float":s===">>"||s==="<<"?(a=r,h=t.changeComponentType(h,"uint")):t.isMatrix(a)&&t.isVector(h)?h=t.getVectorFromMatrix(a):t.isVector(a)&&t.isMatrix(h)?a=t.getVectorFromMatrix(h):a=h=r):a=h=r;const c=i.build(t,a),l=typeof o<"u"?o.build(t,h):null,u=t.getTypeLength(e),d=t.getFunctionOperator(s);if(e!=="void")return s==="<"&&u>1?t.format(`${t.getMethod("lessThan")}( ${c}, ${l} )`,r,e):s==="<="&&u>1?t.format(`${t.getMethod("lessThanEqual")}( ${c}, ${l} )`,r,e):s===">"&&u>1?t.format(`${t.getMethod("greaterThan")}( ${c}, ${l} )`,r,e):s===">="&&u>1?t.format(`${t.getMethod("greaterThanEqual")}( ${c}, ${l} )`,r,e):s==="!"||s==="~"?t.format(`(${s}${c})`,a,e):d?t.format(`${d}( ${c}, ${l} )`,r,e):t.format(`( ${c} ${s} ${l} )`,r,e);if(a!=="void")return d?t.format(`${d}( ${c}, ${l} )`,r,e):t.format(`${c} ${s} ${l}`,r,e)}serialize(t){super.serialize(t),t.op=this.op}deserialize(t){super.deserialize(t),this.op=t.op}}const Zt=T(ot,"+"),dt=T(ot,"-"),H=T(ot,"*"),Ze=T(ot,"/"),um=T(ot,"%"),dm=T(ot,"=="),pm=T(ot,"!="),mm=T(ot,"<"),ec=T(ot,">"),fm=T(ot,"<="),gm=T(ot,">="),ym=T(ot,"&&"),xm=T(ot,"||"),Nm=T(ot,"!"),Mm=T(ot,"^^"),wm=T(ot,"&"),Tm=T(ot,"~"),vm=T(ot,"|"),Sm=T(ot,"^"),bm=T(ot,"<<"),_m=T(ot,">>");M("add",Zt);M("sub",dt);M("mul",H);M("div",Ze);M("remainder",um);M("equal",dm);M("notEqual",pm);M("lessThan",mm);M("greaterThan",ec);M("lessThanEqual",fm);M("greaterThanEqual",gm);M("and",ym);M("or",xm);M("not",Nm);M("xor",Mm);M("bitAnd",wm);M("bitNot",Tm);M("bitOr",vm);M("bitXor",Sm);M("shiftLeft",bm);M("shiftRight",_m);A("OperatorNode",ot);class N extends tt{constructor(t,e,s=null,i=null){super(),this.method=t,this.aNode=e,this.bNode=s,this.cNode=i}getInputType(t){const e=this.aNode.getNodeType(t),s=this.bNode?this.bNode.getNodeType(t):null,i=this.cNode?this.cNode.getNodeType(t):null,o=t.isMatrix(e)?0:t.getTypeLength(e),r=t.isMatrix(s)?0:t.getTypeLength(s),a=t.isMatrix(i)?0:t.getTypeLength(i);return o>r&&o>a?e:r>a?s:a>o?i:e}getNodeType(t){const e=this.method;return e===N.LENGTH||e===N.DISTANCE||e===N.DOT?"float":e===N.CROSS?"vec3":e===N.ALL?"bool":e===N.EQUALS?t.changeComponentType(this.aNode.getNodeType(t),"bool"):e===N.MOD?this.aNode.getNodeType(t):this.getInputType(t)}generate(t,e){const s=this.method,i=this.getNodeType(t),o=this.getInputType(t),r=this.aNode,a=this.bNode,h=this.cNode,c=t.renderer.isWebGLRenderer===!0;if(s===N.TRANSFORM_DIRECTION){let l=r,u=a;t.isMatrix(l.getNodeType(t))?u=B(x(u),0):l=B(x(l),0);const d=H(l,u).xyz;return Mi(d).build(t,e)}else{if(s===N.NEGATE)return t.format("( - "+r.build(t,o)+" )",i,e);if(s===N.ONE_MINUS)return dt(1,r).build(t,e);if(s===N.RECIPROCAL)return Ze(1,r).build(t,e);if(s===N.DIFFERENCE)return mt(dt(r,a)).build(t,e);{const l=[];return s===N.CROSS||s===N.MOD?l.push(r.build(t,i),a.build(t,i)):s===N.STEP?l.push(r.build(t,t.getTypeLength(r.getNodeType(t))===1?"float":o),a.build(t,o)):c&&(s===N.MIN||s===N.MAX)||s===N.MOD?l.push(r.build(t,o),a.build(t,t.getTypeLength(a.getNodeType(t))===1?"float":o)):s===N.REFRACT?l.push(r.build(t,o),a.build(t,o),h.build(t,"float")):s===N.MIX?l.push(r.build(t,o),a.build(t,o),h.build(t,t.getTypeLength(h.getNodeType(t))===1?"float":o)):(l.push(r.build(t,o)),a!==null&&l.push(a.build(t,o)),h!==null&&l.push(h.build(t,o))),t.format(`${t.getMethod(s,i)}( ${l.join(", ")} )`,i,e)}}}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}N.ALL="all";N.ANY="any";N.EQUALS="equals";N.RADIANS="radians";N.DEGREES="degrees";N.EXP="exp";N.EXP2="exp2";N.LOG="log";N.LOG2="log2";N.SQRT="sqrt";N.INVERSE_SQRT="inversesqrt";N.FLOOR="floor";N.CEIL="ceil";N.NORMALIZE="normalize";N.FRACT="fract";N.SIN="sin";N.COS="cos";N.TAN="tan";N.ASIN="asin";N.ACOS="acos";N.ATAN="atan";N.ABS="abs";N.SIGN="sign";N.LENGTH="length";N.NEGATE="negate";N.ONE_MINUS="oneMinus";N.DFDX="dFdx";N.DFDY="dFdy";N.ROUND="round";N.RECIPROCAL="reciprocal";N.TRUNC="trunc";N.FWIDTH="fwidth";N.BITCAST="bitcast";N.ATAN2="atan2";N.MIN="min";N.MAX="max";N.MOD="mod";N.STEP="step";N.REFLECT="reflect";N.DISTANCE="distance";N.DIFFERENCE="difference";N.DOT="dot";N.CROSS="cross";N.POW="pow";N.TRANSFORM_DIRECTION="transformDirection";N.MIX="mix";N.CLAMP="clamp";N.REFRACT="refract";N.SMOOTHSTEP="smoothstep";N.FACEFORWARD="faceforward";const sc=f(1e-6);f(1e6);const wa=f(Math.PI);f(Math.PI*2);const ic=T(N,N.ALL),Am=T(N,N.ANY),zm=T(N,N.EQUALS),Rm=T(N,N.RADIANS),Vm=T(N,N.DEGREES),nc=T(N,N.EXP),Go=T(N,N.EXP2),oc=T(N,N.LOG),Fn=T(N,N.LOG2),gs=T(N,N.SQRT),Cm=T(N,N.INVERSE_SQRT),Zs=T(N,N.FLOOR),rc=T(N,N.CEIL),Mi=T(N,N.NORMALIZE),Ln=T(N,N.FRACT),Ee=T(N,N.SIN),qe=T(N,N.COS),Em=T(N,N.TAN),Im=T(N,N.ASIN),Fm=T(N,N.ACOS),Lm=T(N,N.ATAN),mt=T(N,N.ABS),Nr=T(N,N.SIGN),Gs=T(N,N.LENGTH),Om=T(N,N.NEGATE),Pm=T(N,N.ONE_MINUS),Bm=T(N,N.DFDX),Dm=T(N,N.DFDY),km=T(N,N.ROUND),Um=T(N,N.RECIPROCAL),ac=T(N,N.TRUNC),Gm=T(N,N.FWIDTH);T(N,N.BITCAST);const Wm=T(N,N.ATAN2),ae=T(N,N.MIN),_t=T(N,N.MAX),qm=T(N,N.MOD),Hm=T(N,N.STEP),jm=T(N,N.REFLECT),Xm=T(N,N.DISTANCE),$m=T(N,N.DIFFERENCE),Js=T(N,N.DOT),hc=T(N,N.CROSS),Ne=T(N,N.POW),cc=T(N,N.POW,2),Ym=T(N,N.POW,3),Zm=T(N,N.POW,4),Jm=T(N,N.TRANSFORM_DIRECTION),Qm=n=>H(Nr(n),Ne(mt(n),1/3)),Km=n=>Js(n,n),Mt=T(N,N.MIX),js=(n,t=0,e=1)=>I(new N(N.CLAMP,I(n),I(t),I(e))),tf=n=>js(n),lc=T(N,N.REFRACT),we=T(N,N.SMOOTHSTEP),ef=T(N,N.FACEFORWARD),sf=(n,t,e)=>Mt(t,e,n),nf=(n,t,e)=>we(t,e,n);M("all",ic);M("any",Am);M("equals",zm);M("radians",Rm);M("degrees",Vm);M("exp",nc);M("exp2",Go);M("log",oc);M("log2",Fn);M("sqrt",gs);M("inverseSqrt",Cm);M("floor",Zs);M("ceil",rc);M("normalize",Mi);M("fract",Ln);M("sin",Ee);M("cos",qe);M("tan",Em);M("asin",Im);M("acos",Fm);M("atan",Lm);M("abs",mt);M("sign",Nr);M("length",Gs);M("lengthSq",Km);M("negate",Om);M("oneMinus",Pm);M("dFdx",Bm);M("dFdy",Dm);M("round",km);M("reciprocal",Um);M("trunc",ac);M("fwidth",Gm);M("atan2",Wm);M("min",ae);M("max",_t);M("mod",qm);M("step",Hm);M("reflect",jm);M("distance",Xm);M("dot",Js);M("cross",hc);M("pow",Ne);M("pow2",cc);M("pow3",Ym);M("pow4",Zm);M("transformDirection",Jm);M("mix",sf);M("clamp",js);M("refract",lc);M("smoothstep",nf);M("faceForward",ef);M("difference",$m);M("saturate",tf);M("cbrt",Qm);A("MathNode",N);const of=b(n=>{const{value:t}=n,{rgb:e}=t,s=e.mul(.9478672986).add(.0521327014).pow(2.4),i=e.mul(.0773993808),o=e.lessThanEqual(.04045),r=Mt(s,i,o);return B(r,t.a)}),rf=b(n=>{const{value:t}=n,{rgb:e}=t,s=e.pow(.41666).mul(1.055).sub(.055),i=e.mul(12.92),o=e.lessThanEqual(.0031308),r=Mt(s,i,o);return B(r,t.a)}),Ta=n=>{let t=null;return n===$s?t="Linear":n===Ce&&(t="sRGB"),t},uc=(n,t)=>Ta(n)+"To"+Ta(t);class Gt extends tt{constructor(t,e){super("vec4"),this.method=t,this.node=e}setup(){const{method:t,node:e}=this;return t===Gt.LINEAR_TO_LINEAR?e:af[t]({value:e})}}Gt.LINEAR_TO_LINEAR="LinearToLinear";Gt.LINEAR_TO_sRGB="LinearTosRGB";Gt.sRGB_TO_LINEAR="sRGBToLinear";const af={[Gt.LINEAR_TO_sRGB]:rf,[Gt.sRGB_TO_LINEAR]:of},hf=(n,t)=>I(new Gt(uc($s,t),I(n))),dc=(n,t)=>I(new Gt(uc(t,$s),I(n))),cf=T(Gt,Gt.LINEAR_TO_sRGB),lf=T(Gt,Gt.sRGB_TO_LINEAR);M("linearTosRGB",cf);M("sRGBToLinear",lf);M("linearToColorSpace",hf);M("colorSpaceToLinear",dc);A("ColorSpaceNode",Gt);class pc extends k{constructor(t="",e="void"){super(e),this.snippet=t}generate(t,e){const s=this.getNodeType(t),i=this.snippet;if(s==="void")t.addLineFlowCode(i);else return t.format(`( ${i} )`,s,e)}}const On=T(pc);A("ExpressionNode",pc);class mc extends fs{constructor(t){super(0),this.textureNode=t,this.updateType=st.FRAME}get texture(){return this.textureNode.value}update(){const t=this.texture,e=t.images,s=e&&e.length>0?e[0]&&e[0].image||e[0]:t.image;if(s&&s.width!==void 0){const{width:i,height:o}=s;this.value=Math.log2(Math.max(i,o))}}}const uf=T(mc);A("MaxMipLevelNode",mc);class ys extends fs{constructor(t,e=null,s=null){super(t),this.isTextureNode=!0,this.uvNode=e,this.levelNode=s,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=st.NONE,this.referenceNode=null,this._value=t,this.setUpdateMatrix(e===null)}set value(t){this.referenceNode?this.referenceNode.value=t:this._value=t}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":"vec4"}getInputType(){return"texture"}getDefaultUV(){return be(this.value.channel)}updateReference(){return this.value}getTransformedUV(t){const e=this.value;return j(e.matrix).mul(x(t,1)).xy}setUpdateMatrix(t){return this.updateMatrix=t,this.updateType=t?st.FRAME:st.NONE,this}setupUV(t,e){const s=this.value;return t.isFlipY()&&(s.isRenderTargetTexture===!0||s.isFramebufferTexture===!0||s.isDepthTexture===!0)&&(e=e.setY(e.y.oneMinus())),e}setup(t){const e=t.getNodeProperties(this);let s=this.uvNode;(s===null||t.context.forceUVContext===!0)&&t.context.getUV&&(s=t.context.getUV(this)),s||(s=this.getDefaultUV()),this.updateMatrix===!0&&(s=this.getTransformedUV(s)),s=this.setupUV(t,s);let i=this.levelNode;i===null&&t.context.getTextureLevel&&(i=t.context.getTextureLevel(this)),e.uvNode=s,e.levelNode=i,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.depthNode=this.depthNode}generateUV(t,e){return e.build(t,this.sampler===!0?"vec2":"ivec2")}generateSnippet(t,e,s,i,o,r,a){const h=this.value;let c;return i?c=t.generateTextureLevel(h,e,s,i,o):a?c=t.generateTextureGrad(h,e,s,a,o):r?c=t.generateTextureCompare(h,e,s,r,o):this.sampler===!1?c=t.generateTextureLoad(h,e,s,o):c=t.generateTexture(h,e,s,o),c}generate(t,e){const s=t.getNodeProperties(this),i=this.value;if(!i||i.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const o=super.generate(t,"property");if(e==="sampler")return o+"_sampler";if(t.isReference(e))return o;{const r=t.getDataFromNode(this);let a=r.propertyName;if(a===void 0){const{uvNode:l,levelNode:u,compareNode:d,depthNode:p,gradNode:m}=s,y=this.generateUV(t,l),w=u?u.build(t,"float"):null,S=p?p.build(t,"int"):null,R=d?d.build(t,"float"):null,z=m?[m[0].build(t,"vec2"),m[1].build(t,"vec2")]:null,C=t.getVarFromNode(this);a=t.getPropertyName(C);const O=this.generateSnippet(t,o,y,w,S,R,z);t.addLineFlowCode(`${a} = ${O}`),t.context.tempWrite!==!1&&(r.snippet=O,r.propertyName=a)}let h=a;const c=this.getNodeType(t);return t.needsColorSpaceToLinear(i)&&(h=dc(On(h,c),i.colorSpace).setup(t).build(t,c)),t.format(h,c,e)}}setSampler(t){return this.sampler=t,this}getSampler(){return this.sampler}uv(t){const e=this.clone();return e.uvNode=t,e.referenceNode=this,I(e)}blur(t){const e=this.clone();return e.levelNode=t.mul(uf(e)),e.referenceNode=this,I(e)}level(t){const e=this.clone();return e.levelNode=t,e.referenceNode=this,e}size(t){return xr(this,t)}compare(t){const e=this.clone();return e.compareNode=I(t),e.referenceNode=this,I(e)}grad(t,e){const s=this.clone();return s.gradNode=[I(t),I(e)],s.referenceNode=this,I(s)}depth(t){const e=this.clone();return e.depthNode=I(t),e.referenceNode=this,I(e)}serialize(t){super.serialize(t),t.value=this.value.toJSON(t.meta).uuid}deserialize(t){super.deserialize(t),this.value=t.meta.textures[t.value]}update(){const t=this.value;t.matrixAutoUpdate===!0&&t.updateMatrix()}clone(){const t=new this.constructor(this.value,this.uvNode,this.levelNode);return t.sampler=this.sampler,t}}const $t=T(ys),hs=(...n)=>$t(...n).setSampler(!1);M("texture",$t);A("TextureNode",ys);class Pn extends fs{constructor(t,e,s=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferCount=s}getElementType(t){return this.getNodeType(t)}getInputType(){return"buffer"}}const Mr=(n,t,e)=>I(new Pn(n,t,e));A("BufferNode",Pn);class df extends Ys{constructor(t,e){super(t,e),this.isArrayBufferElementNode=!0}getNodeType(t){return this.node.getElementType(t)}generate(t){const e=super.generate(t),s=this.getNodeType();return t.format(e,"vec4",s)}}class fc extends Pn{constructor(t,e=null){super(null,"vec4"),this.array=t,this.elementType=e,this._elementType=null,this._elementLength=0,this.updateType=st.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){const{array:t,value:e}=this,s=this.getElementLength(),i=this.getElementType();if(s===1)for(let o=0;o<t.length;o++){const r=o*4;e[r]=t[o]}else if(i==="color")for(let o=0;o<t.length;o++){const r=o*4,a=t[o];e[r]=a.r,e[r+1]=a.g,e[r+2]=a.b||0}else for(let o=0;o<t.length;o++){const r=o*4,a=t[o];e[r]=a.x,e[r+1]=a.y,e[r+2]=a.z||0,e[r+3]=a.w||0}}setup(t){const e=this.array.length;return this._elementType=this.elementType===null?He(this.array[0]):this.elementType,this._elementLength=t.getTypeLength(this._elementType),this.value=new Float32Array(e*4),this.bufferCount=e,super.setup(t)}element(t){return I(new df(this,I(t)))}}const Wo=(n,t)=>I(new fc(n,t));A("UniformsNode",fc);class pf extends Ys{constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),s=this.referenceNode.getNodeType(),i=this.getNodeType();return t.format(e,s,i)}}class Qs extends k{constructor(t,e,s=null,i=null){super(),this.property=t,this.uniformType=e,this.object=s,this.count=i,this.properties=t.split("."),this.reference=null,this.node=null,this.updateType=st.OBJECT}element(t){return I(new pf(this,I(t)))}setNodeType(t){let e=null;this.count!==null?e=Mr(null,t,this.count):Array.isArray(this.getValueFromReference())?e=Wo(null,t):t==="texture"?e=$t(null):e=j(null,t),this.node=e}getNodeType(t){return this.node===null&&this.updateValue(),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let s=t[e[0]];for(let i=1;i<e.length;i++)s=s[e[i]];return s}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}const pe=(n,t,e)=>I(new Qs(n,t,e)),mf=(n,t,e,s)=>I(new Qs(n,t,s,e));A("ReferenceNode",Qs);class gc extends Qs{constructor(t,e,s=null){super(t,e,s),this.material=s}updateReference(t){return this.reference=this.material!==null?this.material:t.material,this.reference}}const Fe=(n,t,e)=>I(new gc(n,t,e));A("MaterialReferenceNode",gc);const po=j("float").onRenderUpdate(({camera:n})=>n.near),mo=j("float").onRenderUpdate(({camera:n})=>n.far),ff=j("float").onRenderUpdate(({camera:n})=>2/(Math.log(n.far+1)/Math.LN2)),ge=j("mat4").onRenderUpdate(({camera:n})=>n.projectionMatrix),Ks=j("mat4").onRenderUpdate(({camera:n})=>n.matrixWorldInverse),yc=j(new v).onRenderUpdate(({camera:n},t)=>t.value.setFromMatrixPosition(n.matrixWorld));class U extends k{constructor(t=U.VIEW_MATRIX,e=null){super(),this.scope=t,this.object3d=e,this.updateType=st.OBJECT,this._uniformNode=new fs(null)}getNodeType(){const t=this.scope;if(t===U.WORLD_MATRIX||t===U.VIEW_MATRIX)return"mat4";if(t===U.NORMAL_MATRIX)return"mat3";if(t===U.POSITION||t===U.VIEW_POSITION||t===U.DIRECTION||t===U.SCALE)return"vec3"}update(t){const e=this.object3d,s=this._uniformNode,i=this.scope;if(i===U.VIEW_MATRIX)s.value=e.modelViewMatrix;else if(i===U.NORMAL_MATRIX)s.value=e.normalMatrix;else if(i===U.WORLD_MATRIX)s.value=e.matrixWorld;else if(i===U.POSITION)s.value=s.value||new v,s.value.setFromMatrixPosition(e.matrixWorld);else if(i===U.SCALE)s.value=s.value||new v,s.value.setFromMatrixScale(e.matrixWorld);else if(i===U.DIRECTION)s.value=s.value||new v,e.getWorldDirection(s.value);else if(i===U.VIEW_POSITION){const o=t.camera;s.value=s.value||new v,s.value.setFromMatrixPosition(e.matrixWorld),s.value.applyMatrix4(o.matrixWorldInverse)}}generate(t){const e=this.scope;return e===U.WORLD_MATRIX||e===U.VIEW_MATRIX?this._uniformNode.nodeType="mat4":e===U.NORMAL_MATRIX?this._uniformNode.nodeType="mat3":(e===U.POSITION||e===U.VIEW_POSITION||e===U.DIRECTION||e===U.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(t)}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}U.VIEW_MATRIX="viewMatrix";U.NORMAL_MATRIX="normalMatrix";U.WORLD_MATRIX="worldMatrix";U.POSITION="position";U.SCALE="scale";U.VIEW_POSITION="viewPosition";U.DIRECTION="direction";T(U,U.DIRECTION);T(U,U.VIEW_MATRIX);T(U,U.NORMAL_MATRIX);T(U,U.WORLD_MATRIX);const qo=T(U,U.POSITION);T(U,U.SCALE);const xc=T(U,U.VIEW_POSITION);A("Object3DNode",U);class Vt extends U{constructor(t=Vt.VIEW_MATRIX){super(t)}update(t){this.object3d=t.object,super.update(t)}}V(Vt,Vt.DIRECTION);const ds=V(Vt,Vt.VIEW_MATRIX).label("modelViewMatrix").temp("ModelViewMatrix"),Nc=V(Vt,Vt.NORMAL_MATRIX),wi=V(Vt,Vt.WORLD_MATRIX);V(Vt,Vt.POSITION);V(Vt,Vt.SCALE);V(Vt,Vt.VIEW_POSITION);const gf=j(new ft).onObjectUpdate(({object:n},t)=>t.value.copy(n.matrixWorld).invert());A("ModelNode",Vt);const wn=bt("normal","vec3",x(0,1,0)),me=wn.toVar("normalLocal"),Je=gt(Nc.mul(me),"v_normalView").normalize().toVar("normalView"),yf=gt(Je.transformDirection(Ks),"v_normalWorld").normalize().toVar("transformedNormalWorld"),ut=at("vec3","transformedNormalView"),Mc=ut.transformDirection(Ks).normalize().toVar("transformedNormalWorld"),Ls=at("vec3","transformedClearcoatNormalView"),va=new Map;class _ extends k{constructor(t){super(),this.scope=t}getCache(t,e){let s=va.get(t);return s===void 0&&(s=Fe(t,e),va.set(t,s)),s}getFloat(t){return this.getCache(t,"float")}getColor(t){return this.getCache(t,"color")}getTexture(t){return this.getCache(t==="map"?"map":t+"Map","texture")}setup(t){const e=t.context.material,s=this.scope;let i=null;if(s===_.COLOR){const o=this.getColor(s);e.map&&e.map.isTexture===!0?i=o.mul(this.getTexture("map")):i=o}else if(s===_.OPACITY){const o=this.getFloat(s);e.alphaMap&&e.alphaMap.isTexture===!0?i=o.mul(this.getTexture("alpha")):i=o}else if(s===_.SPECULAR_STRENGTH)e.specularMap&&e.specularMap.isTexture===!0?i=this.getTexture("specular").r:i=f(1);else if(s===_.SPECULAR_INTENSITY){const o=this.getFloat(s);e.specularMap?i=o.mul(this.getTexture(s).a):i=o}else if(s===_.SPECULAR_COLOR){const o=this.getColor(s);e.specularColorMap&&e.specularColorMap.isTexture===!0?i=o.mul(this.getTexture(s).rgb):i=o}else if(s===_.ROUGHNESS){const o=this.getFloat(s);e.roughnessMap&&e.roughnessMap.isTexture===!0?i=o.mul(this.getTexture(s).g):i=o}else if(s===_.METALNESS){const o=this.getFloat(s);e.metalnessMap&&e.metalnessMap.isTexture===!0?i=o.mul(this.getTexture(s).b):i=o}else if(s===_.EMISSIVE){const o=this.getColor(s);e.emissiveMap&&e.emissiveMap.isTexture===!0?i=o.mul(this.getTexture(s)):i=o}else if(s===_.NORMAL)e.normalMap?i=this.getTexture("normal").normalMap(this.getCache("normalScale","vec2")):e.bumpMap?i=this.getTexture("bump").r.bumpMap(this.getFloat("bumpScale")):i=Je;else if(s===_.CLEARCOAT){const o=this.getFloat(s);e.clearcoatMap&&e.clearcoatMap.isTexture===!0?i=o.mul(this.getTexture(s).r):i=o}else if(s===_.CLEARCOAT_ROUGHNESS){const o=this.getFloat(s);e.clearcoatRoughnessMap&&e.clearcoatRoughnessMap.isTexture===!0?i=o.mul(this.getTexture(s).r):i=o}else if(s===_.CLEARCOAT_NORMAL)e.clearcoatNormalMap?i=this.getTexture(s).normalMap(this.getCache(s+"Scale","vec2")):i=Je;else if(s===_.SHEEN){const o=this.getColor("sheenColor").mul(this.getFloat("sheen"));e.sheenColorMap&&e.sheenColorMap.isTexture===!0?i=o.mul(this.getTexture("sheenColor").rgb):i=o}else if(s===_.SHEEN_ROUGHNESS){const o=this.getFloat(s);e.sheenRoughnessMap&&e.sheenRoughnessMap.isTexture===!0?i=o.mul(this.getTexture(s).a):i=o,i=i.clamp(.07,1)}else if(s===_.ANISOTROPY)if(e.anisotropyMap&&e.anisotropyMap.isTexture===!0){const o=this.getTexture(s);i=ur(ci.x,ci.y,ci.y.negate(),ci.x).mul(o.rg.mul(2).sub(D(1)).normalize().mul(o.b))}else i=ci;else if(s===_.IRIDESCENCE_THICKNESS){const o=pe("1","float",e.iridescenceThicknessRange);if(e.iridescenceThicknessMap){const r=pe("0","float",e.iridescenceThicknessRange);i=o.sub(r).mul(this.getTexture(s).g).add(r)}else i=o}else if(s===_.TRANSMISSION){const o=this.getFloat(s);e.transmissionMap?i=o.mul(this.getTexture(s).r):i=o}else if(s===_.THICKNESS){const o=this.getFloat(s);e.thicknessMap?i=o.mul(this.getTexture(s).g):i=o}else if(s===_.IOR)i=this.getFloat(s);else{const o=this.getNodeType(t);i=this.getCache(s,o)}return i}}_.ALPHA_TEST="alphaTest";_.COLOR="color";_.OPACITY="opacity";_.SHININESS="shininess";_.SPECULAR="specular";_.SPECULAR_STRENGTH="specularStrength";_.SPECULAR_INTENSITY="specularIntensity";_.SPECULAR_COLOR="specularColor";_.REFLECTIVITY="reflectivity";_.ROUGHNESS="roughness";_.METALNESS="metalness";_.NORMAL="normal";_.CLEARCOAT="clearcoat";_.CLEARCOAT_ROUGHNESS="clearcoatRoughness";_.CLEARCOAT_NORMAL="clearcoatNormal";_.EMISSIVE="emissive";_.ROTATION="rotation";_.SHEEN="sheen";_.SHEEN_ROUGHNESS="sheenRoughness";_.ANISOTROPY="anisotropy";_.IRIDESCENCE="iridescence";_.IRIDESCENCE_IOR="iridescenceIOR";_.IRIDESCENCE_THICKNESS="iridescenceThickness";_.IOR="ior";_.TRANSMISSION="transmission";_.THICKNESS="thickness";_.ATTENUATION_DISTANCE="attenuationDistance";_.ATTENUATION_COLOR="attenuationColor";_.LINE_SCALE="scale";_.LINE_DASH_SIZE="dashSize";_.LINE_GAP_SIZE="gapSize";_.LINE_WIDTH="linewidth";_.LINE_DASH_OFFSET="dashOffset";_.POINT_WIDTH="pointWidth";_.DISPERSION="dispersion";const xf=V(_,_.ALPHA_TEST),Ti=V(_,_.COLOR),Nf=V(_,_.SHININESS),Mf=V(_,_.EMISSIVE),wc=V(_,_.OPACITY),wf=V(_,_.SPECULAR),Sa=V(_,_.SPECULAR_INTENSITY),Tf=V(_,_.SPECULAR_COLOR),vf=V(_,_.SPECULAR_STRENGTH);V(_,_.REFLECTIVITY);const Sf=V(_,_.ROUGHNESS),bf=V(_,_.METALNESS),_f=V(_,_.NORMAL),Af=V(_,_.CLEARCOAT),zf=V(_,_.CLEARCOAT_ROUGHNESS),Rf=V(_,_.CLEARCOAT_NORMAL),Vf=V(_,_.ROTATION),Cf=V(_,_.SHEEN),Ef=V(_,_.SHEEN_ROUGHNESS),If=V(_,_.ANISOTROPY),Ff=V(_,_.IRIDESCENCE),Lf=V(_,_.IRIDESCENCE_IOR),Of=V(_,_.IRIDESCENCE_THICKNESS),Pf=V(_,_.TRANSMISSION),Bf=V(_,_.THICKNESS),Df=V(_,_.IOR),kf=V(_,_.ATTENUATION_DISTANCE),Uf=V(_,_.ATTENUATION_COLOR),Ho=V(_,_.LINE_SCALE),Tc=V(_,_.LINE_DASH_SIZE),vc=V(_,_.LINE_GAP_SIZE),fo=V(_,_.LINE_WIDTH),ba=V(_,_.LINE_DASH_OFFSET),Gf=V(_,_.POINT_WIDTH),Wf=V(_,_.DISPERSION),ci=j(new W).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))});A("MaterialNode",_);const Bt=bt("position","vec3"),zt=Bt.toVar("positionLocal"),jo=gt(wi.mul(zt).xyz,"v_positionWorld"),qf=gt(zt.transformDirection(wi),"v_positionWorldDirection").normalize().toVar("positionWorldDirection"),jt=gt(ds.mul(zt).xyz,"v_positionView"),ht=gt(jt.negate(),"v_positionViewDirection").normalize().toVar("positionViewDirection");class Sc extends tt{constructor(t=null){super("vec4"),this.positionNode=t}setup(t){if(t.shaderStage==="fragment")return gt(t.context.mvp);const e=this.positionNode||zt;return ge.mul(ds).mul(e)}}const _a=T(Sc);A("ModelViewProjectionNode",Sc);class bc extends Rn{constructor(t,e=null,s=0,i=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferStride=s,this.bufferOffset=i,this.usage=pn,this.instanced=!1,this.attribute=null,t&&t.isBufferAttribute===!0&&(this.attribute=t,this.usage=t.usage,this.instanced=t.isInstancedBufferAttribute)}getNodeType(t){return this.bufferType===null&&(this.bufferType=t.getTypeFromAttribute(this.attribute)),this.bufferType}setup(t){if(this.attribute!==null)return;const e=this.getNodeType(t),s=this.value,i=t.getTypeLength(e),o=this.bufferStride||i,r=this.bufferOffset,a=s.isInterleavedBuffer===!0?s:new Sh(s,o),h=new or(a,i,r);a.setUsage(this.usage),this.attribute=h,this.attribute.isInstancedBufferAttribute=this.instanced}generate(t){const e=this.getNodeType(t),s=t.getBufferAttributeFromNode(this,e),i=t.getPropertyName(s);let o=null;return t.shaderStage==="vertex"||t.shaderStage==="compute"?(this.name=i,o=i):o=gt(this).build(t,e),o}getInputType(){return"bufferAttribute"}setUsage(t){return this.usage=t,this}setInstanced(t){return this.instanced=t,this}}const Bn=(n,t,e,s)=>I(new bc(n,t,e,s)),Hf=(n,t,e,s)=>Bn(n,t,e,s).setUsage(Fo),Aa=(n,t,e,s)=>Bn(n,t,e,s).setInstanced(!0),za=(n,t,e,s)=>Hf(n,t,e,s).setInstanced(!0);M("toAttribute",n=>Bn(n.value));A("BufferAttributeNode",bc);class _c extends k{constructor(t){super("void"),this.instanceMesh=t,this.instanceMatrixNode=null,this.instanceColorNode=null}setup(){let t=this.instanceMatrixNode;const e=this.instanceMesh;if(t===null){const h=e.instanceMatrix,c=new Np(h.array,16,1),l=h.usage===Fo?za:Aa,u=[l(c,"vec4",16,0),l(c,"vec4",16,4),l(c,"vec4",16,8),l(c,"vec4",16,12)];t=Ds(...u),this.instanceMatrixNode=t}const s=e.instanceColor;if(s&&this.instanceColorNode===null){const h=new np(s.array,3),c=s.usage===Fo?za:Aa;this.instanceColorNode=x(c(h,"vec3",3,0))}const i=t.mul(zt).xyz,o=de(t[0].xyz,t[1].xyz,t[2].xyz),r=me.div(x(o[0].dot(o[0]),o[1].dot(o[1]),o[2].dot(o[2]))),a=o.mul(r).xyz;zt.assign(i),me.assign(a),this.instanceColorNode!==null&&fe("vec3","vInstanceColor").assign(this.instanceColorNode)}}const jf=T(_c);A("InstanceNode",_c);const Ac=b((n,t)=>(t.geometry.hasAttribute("tangent")===!1&&t.geometry.computeTangents(),bt("tangent","vec4")))(),wr=Ac.xyz.toVar("tangentLocal"),zc=gt(ds.mul(B(wr,0)).xyz,"v_tangentView").normalize().toVar("tangentView");class Rc extends k{constructor(t){super("void"),this.batchMesh=t,this.instanceColorNode=null,this.batchingIdNode=null}setup(t){this.batchingIdNode===null&&(this.batchingIdNode=bt("batchId"));const e=this.batchMesh._matricesTexture,s=xr(hs(e),0),i=f(g(this.batchingIdNode)).mul(4).toVar(),o=g(i.mod(s)),r=g(i).div(g(s)),a=Ds(hs(e,cs(o,r)),hs(e,cs(o.add(1),r)),hs(e,cs(o.add(2),r)),hs(e,cs(o.add(3),r))),h=de(a[0].xyz,a[1].xyz,a[2].xyz);zt.assign(a.mul(zt));const c=me.div(x(h[0].dot(h[0]),h[1].dot(h[1]),h[2].dot(h[2]))),l=h.mul(c).xyz;me.assign(l),t.hasGeometryAttribute("tangent")&&wr.mulAssign(h)}}const Xf=T(Rc);A("batch",Rc);class Vc extends k{constructor(t,e=!1){super("void"),this.skinnedMesh=t,this.useReference=e,this.updateType=st.OBJECT,this.skinIndexNode=bt("skinIndex","uvec4"),this.skinWeightNode=bt("skinWeight","vec4");let s,i,o;e?(s=pe("bindMatrix","mat4"),i=pe("bindMatrixInverse","mat4"),o=mf("skeleton.boneMatrices","mat4",t.skeleton.bones.length)):(s=j(t.bindMatrix,"mat4"),i=j(t.bindMatrixInverse,"mat4"),o=Mr(t.skeleton.boneMatrices,"mat4",t.skeleton.bones.length)),this.bindMatrixNode=s,this.bindMatrixInverseNode=i,this.boneMatricesNode=o}setup(t){const{skinIndexNode:e,skinWeightNode:s,bindMatrixNode:i,bindMatrixInverseNode:o,boneMatricesNode:r}=this,a=r.element(e.x),h=r.element(e.y),c=r.element(e.z),l=r.element(e.w),u=i.mul(zt),d=Zt(a.mul(s.x).mul(u),h.mul(s.y).mul(u),c.mul(s.z).mul(u),l.mul(s.w).mul(u)),p=o.mul(d).xyz;let m=Zt(s.x.mul(a),s.y.mul(h),s.z.mul(c),s.w.mul(l));m=o.mul(m).mul(i);const y=m.transformDirection(me).xyz;zt.assign(p),me.assign(y),t.hasGeometryAttribute("tangent")&&wr.assign(y)}generate(t,e){if(e!=="void")return zt.build(t,e)}update(t){(this.useReference?t.object:this.skinnedMesh).skeleton.update()}}const $f=n=>I(new Vc(n,!0));A("SkinningNode",Vc);class Cc extends k{constructor(t=[]){super(),this.params=t}getVarName(t){return String.fromCharCode(105+t)}getProperties(t){const e=t.getNodeProperties(this);if(e.stackNode!==void 0)return e;const s={};for(let i=0,o=this.params.length-1;i<o;i++){const r=this.params[i],a=r.isNode!==!0&&r.name||this.getVarName(i),h=r.isNode!==!0&&r.type||"int";s[a]=On(a,h)}return e.returnsNode=this.params[this.params.length-1](s,t.addStack(),t),e.stackNode=t.removeStack(),e}getNodeType(t){const{returnsNode:e}=this.getProperties(t);return e?e.getNodeType(t):"void"}setup(t){this.getProperties(t)}generate(t){const e=this.getProperties(t),s={tempWrite:!1},i=this.params,o=e.stackNode;for(let h=0,c=i.length-1;h<c;h++){const l=i[h];let u=null,d=null,p=null,m=null,y=null,w=null;l.isNode?(m="int",p=this.getVarName(h),u="0",d=l.build(t,m),y="<"):(m=l.type||"int",p=l.name||this.getVarName(h),u=l.start,d=l.end,y=l.condition,w=l.update,typeof u=="number"?u=u.toString():u&&u.isNode&&(u=u.build(t,m)),typeof d=="number"?d=d.toString():d&&d.isNode&&(d=d.build(t,m)),u!==void 0&&d===void 0?(u=u+" - 1",d="0",y=">="):d!==void 0&&u===void 0&&(u="0",y="<"),y===void 0&&(Number(u)>Number(d)?y=">=":y="<"));const S={start:u,end:d},R=S.start,z=S.end;let C="",O="",P="";w||(m==="int"||m==="uint"?y.includes("<")?w="++":w="--":y.includes("<")?w="+= 1.":w="-= 1."),C+=t.getVar(m,p)+" = "+R,O+=p+" "+y+" "+z,P+=p+" "+w;const F=`for ( ${C}; ${O}; ${P} )`;t.addFlowCode((h===0?`
`:"")+t.tab+F+` {

`).addFlowTab()}const r=Oe(o,s).build(t,"void"),a=e.returnsNode?e.returnsNode.build(t):"";t.removeFlowTab().addFlowCode(`
`+t.tab+r);for(let h=0,c=this.params.length-1;h<c;h++)t.addFlowCode((h===0?"":t.tab)+`}

`).removeFlowTab();return t.addFlowTab(),a}}const Q=(...n)=>I(new Cc(Bs(n,"int"))).append(),Ec=()=>On("break").append();M("loop",(n,...t)=>Wh(n,Q(...t)));A("LoopNode",Cc);const go=new WeakMap,Ht=new xt,Ra=b(({bufferMap:n,influence:t,stride:e,width:s,depth:i,offset:o})=>{const r=g(om).mul(e).add(o),a=r.div(s),h=r.sub(a.mul(s));return hs(n,cs(h,a)).depth(i).mul(t)});function Yf(n){const t=n.morphAttributes.position!==void 0,e=n.morphAttributes.normal!==void 0,s=n.morphAttributes.color!==void 0,i=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,o=i!==void 0?i.length:0;let r=go.get(n);if(r===void 0||r.count!==o){let S=function(){y.dispose(),go.delete(n),n.removeEventListener("dispose",S)};r!==void 0&&r.texture.dispose();const a=n.morphAttributes.position||[],h=n.morphAttributes.normal||[],c=n.morphAttributes.color||[];let l=0;t===!0&&(l=1),e===!0&&(l=2),s===!0&&(l=3);let u=n.attributes.position.count*l,d=1;const p=4096;u>p&&(d=Math.ceil(u/p),u=p);const m=new Float32Array(u*d*4*o),y=new Pd(m,u,d,o);y.type=ph,y.needsUpdate=!0;const w=l*4;for(let R=0;R<o;R++){const z=a[R],C=h[R],O=c[R],P=u*d*4*R;for(let F=0;F<z.count;F++){const L=F*w;t===!0&&(Ht.fromBufferAttribute(z,F),m[P+L+0]=Ht.x,m[P+L+1]=Ht.y,m[P+L+2]=Ht.z,m[P+L+3]=0),e===!0&&(Ht.fromBufferAttribute(C,F),m[P+L+4]=Ht.x,m[P+L+5]=Ht.y,m[P+L+6]=Ht.z,m[P+L+7]=0),s===!0&&(Ht.fromBufferAttribute(O,F),m[P+L+8]=Ht.x,m[P+L+9]=Ht.y,m[P+L+10]=Ht.z,m[P+L+11]=O.itemSize===4?Ht.w:1)}}r={count:o,texture:y,stride:l,size:new W(u,d)},go.set(n,r),n.addEventListener("dispose",S)}return r}class Ic extends k{constructor(t){super("void"),this.mesh=t,this.morphBaseInfluence=j(1),this.updateType=st.OBJECT}setup(t){const{geometry:e}=t,s=e.morphAttributes.position!==void 0,i=e.morphAttributes.normal!==void 0,o=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,r=o!==void 0?o.length:0,{texture:a,stride:h,size:c}=Yf(e);s===!0&&zt.mulAssign(this.morphBaseInfluence),i===!0&&me.mulAssign(this.morphBaseInfluence);const l=g(c.width);Q(r,({i:u})=>{const d=f(0).toVar();this.mesh.isInstancedMesh===!0&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?d.assign(hs(this.mesh.morphTexture,cs(g(u).add(1),g(Hh))).r):d.assign(pe("morphTargetInfluences","float").element(u).toVar()),s===!0&&zt.addAssign(Ra({bufferMap:a,influence:d,stride:h,width:l,depth:u,offset:g(0)})),i===!0&&me.addAssign(Ra({bufferMap:a,influence:d,stride:h,width:l,depth:u,offset:g(1)}))})}update(){const t=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?t.value=1:t.value=1-this.mesh.morphTargetInfluences.reduce((e,s)=>e+s,0)}}const Zf=T(Ic);A("MorphNode",Ic);const Jf=ht.negate().reflect(ut),Qf=Jf.transformDirection(Ks).toVar("reflectVector");class Fc extends ys{constructor(t,e=null,s=null){super(t,e,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){return Qf}setUpdateMatrix(){}setupUV(t,e){const s=this.value;return t.renderer.coordinateSystem===xi||!s.isRenderTargetTexture?x(e.x.negate(),e.yz):e}generateUV(t,e){return e.build(t,"vec3")}}const Lc=T(Fc);M("cubeTexture",Lc);A("CubeTextureNode",Fc);class Vi extends k{constructor(){super("vec3")}generate(){console.warn("Abstract function.")}}A("LightingNode",Vi);let li=null;class xs extends Vi{constructor(t=null){super(),this.updateType=st.FRAME,this.light=t,this.rtt=null,this.shadowNode=null,this.shadowMaskNode=null,this.color=new it,this._defaultColorNode=j(this.color),this.colorNode=this._defaultColorNode,this.isAnalyticLightNode=!0}getCacheKey(){return super.getCacheKey()+"-"+(this.light.id+"-"+(this.light.castShadow?"1":"0"))}getHash(){return this.light.uuid}setupShadow(t){const{object:e}=t;if(e.receiveShadow===!1)return;let s=this.shadowNode;if(s===null){li===null&&(li=t.createNodeMaterial(),li.fragmentNode=B(0,0,0,1),li.isShadowNodeMaterial=!0);const i=this.light.shadow,o=t.createRenderTarget(i.mapSize.width,i.mapSize.height),r=new zn;r.minFilter=$e,r.magFilter=$e,r.image.width=i.mapSize.width,r.image.height=i.mapSize.height,r.compareFunction=md,o.depthTexture=r,i.camera.updateProjectionMatrix();const a=pe("bias","float",i),h=pe("normalBias","float",i),c=e.material.shadowPositionNode||jo;let l=j(i.matrix).mul(c.add(yf.mul(h)));l=l.xyz.div(l.w);const u=l.x.greaterThanEqual(0).and(l.x.lessThanEqual(1)).and(l.y.greaterThanEqual(0)).and(l.y.lessThanEqual(1)).and(l.z.lessThanEqual(1));let d=l.z.add(a);t.renderer.coordinateSystem===xi&&(d=d.mul(2).sub(1)),l=x(l.x,l.y.oneMinus(),d),s=((w,S,R)=>$t(w,S).compare(R))(r,l.xy,l.z);const m=$t(o.texture,l),y=u.mix(1,s.mix(m.a.mix(1,m),1));this.rtt=o,this.colorNode=this.colorNode.mul(y),this.shadowNode=s,this.shadowMaskNode=y,this.updateBeforeType=st.RENDER}}setup(t){this.light.castShadow?this.setupShadow(t):this.shadowNode!==null&&this.disposeShadow()}updateShadow(t){const{rtt:e,light:s}=this,{renderer:i,scene:o,camera:r}=t,a=o.overrideMaterial;o.overrideMaterial=li,e.setSize(s.shadow.mapSize.width,s.shadow.mapSize.height),s.shadow.updateMatrices(s),s.shadow.camera.layers.mask=r.layers.mask;const h=i.toneMapping,c=i.getRenderTarget(),l=i.getRenderObjectFunction();i.setRenderObjectFunction((u,...d)=>{u.castShadow===!0&&i.renderObject(u,...d)}),i.setRenderTarget(e),i.toneMapping=yi,i.render(o,s.shadow.camera),i.setRenderTarget(c),i.setRenderObjectFunction(l),i.toneMapping=h,o.overrideMaterial=a}disposeShadow(){this.rtt.dispose(),this.shadowNode=null,this.shadowMaskNode=null,this.rtt=null,this.colorNode=this._defaultColorNode}updateBefore(t){const{light:e}=this;e.castShadow&&this.updateShadow(t)}update(){const{light:t}=this;this.color.copy(t.color).multiplyScalar(t.intensity)}}A("AnalyticLightNode",xs);const Tn=new WeakMap,Kf=n=>n.sort((t,e)=>t.id-e.id);class tg extends k{constructor(t=[]){super("vec3"),this.totalDiffuseNode=x().temp("totalDiffuse"),this.totalSpecularNode=x().temp("totalSpecular"),this.outgoingLightNode=x().temp("outgoingLight"),this.lightNodes=t,this._hash=null}get hasLight(){return this.lightNodes.length>0}getHash(){if(this._hash===null){const t=[];for(const e of this.lightNodes)t.push(e.getHash());this._hash="lights-"+t.join(",")}return this._hash}analyze(t){const e=t.getDataFromNode(this);for(const s of e.nodes)s.build(t)}setup(t){const e=t.context,s=e.lightingModel;let i=this.outgoingLightNode;if(s){const{lightNodes:o,totalDiffuseNode:r,totalSpecularNode:a}=this;e.outgoingLight=i;const h=t.addStack(),c=t.getDataFromNode(this);c.nodes=h.nodes,s.start(e,h,t);for(const S of o)S.build(t);s.indirectDiffuse(e,h,t),s.indirectSpecular(e,h,t),s.ambientOcclusion(e,h,t);const{backdrop:l,backdropAlpha:u}=e,{directDiffuse:d,directSpecular:p,indirectDiffuse:m,indirectSpecular:y}=e.reflectedLight;let w=d.add(m);l!==null&&(u!==null?w=x(u.mix(w,l)):w=x(l),e.material.transparent=!0),r.assign(w),a.assign(p.add(y)),i.assign(r.add(a)),s.finish(e,h,t),i=i.bypass(t.removeStack())}return i}_getLightNodeById(t){for(const e of this.lightNodes)if(e.isAnalyticLightNode&&e.light.id===t)return e;return null}fromLights(t=[]){const e=[];t=Kf(t);for(const s of t){let i=this._getLightNodeById(s.id);if(i===null){const o=s.constructor,r=Tn.has(o)?Tn.get(o):xs;i=I(new r(s))}e.push(i)}return this.lightNodes=e,this._hash=null,this}}const eg=T(tg);function ti(n,t){if(Tn.has(n)){console.warn(`Redefinition of light node ${t.type}`);return}if(typeof n!="function")throw new Error(`Light ${n.name} is not a class`);if(typeof t!="function"||!t.type)throw new Error(`Light node ${t.type} is not a class`);Tn.set(n,t)}class Oc extends Vi{constructor(t=null){super(),this.aoNode=t}setup(t){const s=this.aoNode.x.sub(1).mul(1).add(1);t.context.ambientOcclusion.mulAssign(s)}}A("AONode",Oc);class Pc extends pr{constructor(t,e=null,s=null,i=null){super(t),this.lightingModel=e,this.backdropNode=s,this.backdropAlphaNode=i,this._context=null}getContext(){const{backdropNode:t,backdropAlphaNode:e}=this,s=x().temp("directDiffuse"),i=x().temp("directSpecular"),o=x().temp("indirectDiffuse"),r=x().temp("indirectSpecular"),a={directDiffuse:s,directSpecular:i,indirectDiffuse:o,indirectSpecular:r};return{radiance:x().temp("radiance"),irradiance:x().temp("irradiance"),iblIrradiance:x().temp("iblIrradiance"),ambientOcclusion:f(1).temp("ambientOcclusion"),reflectedLight:a,backdrop:t,backdropAlpha:e}}setup(t){return this.context=this._context||(this._context=this.getContext()),this.context.lightingModel=this.lightingModel||t.context.lightingModel,super.setup(t)}}const Bc=T(Pc);M("lightingContext",Bc);A("LightingContextNode",Pc);const sg=n=>n.mul(Ac.w).xyz,ig=gt(sg(Je.cross(zc)),"v_bitangentView").normalize().toVar("bitangentView"),Os=de(zc,ig,Je);ht.mul(Os);const ng=(()=>{let n=ks.cross(ht);return n=n.cross(ks).normalize(),n=Mt(n,ut,as.mul(je.oneMinus()).oneMinus().pow2().pow2()).normalize(),n})();class Tr extends k{constructor(t,e,s=null){super(),this.condNode=t,this.ifNode=e,this.elseNode=s}getNodeType(t){const e=this.ifNode.getNodeType(t);if(this.elseNode!==null){const s=this.elseNode.getNodeType(t);if(t.getTypeLength(s)>t.getTypeLength(e))return s}return e}generate(t,e){const s=this.getNodeType(t),i={tempWrite:!1},o=t.getDataFromNode(this);if(o.nodeProperty!==void 0)return o.nodeProperty;const{ifNode:r,elseNode:a}=this,h=e!=="void",c=h?at(s).build(t):"";o.nodeProperty=c;const l=Oe(this.condNode).build(t,"bool");t.addFlowCode(`
${t.tab}if ( ${l} ) {

`).addFlowTab();let u=Oe(r,i).build(t,s);if(u&&(h?u=c+" = "+u+";":u="return "+u+";"),t.removeFlowTab().addFlowCode(t.tab+"	"+u+`

`+t.tab+"}"),a!==null){t.addFlowCode(` else {

`).addFlowTab();let d=Oe(a,i).build(t,s);d&&(h?d=c+" = "+d+";":d="return "+d+";"),t.removeFlowTab().addFlowCode(t.tab+"	"+d+`

`+t.tab+`}

`)}else t.addFlowCode(`

`);return t.format(c,s,e)}}const Xt=T(Tr);M("cond",Xt);A("CondNode",Tr);const Va=f(1),Xo=f(-2),an=f(.8),yo=f(-1),hn=f(.4),xo=f(2),cn=f(.305),No=f(3),Ca=f(.21),og=f(4),Ea=f(4),rg=f(16),ag=b(([n])=>{const t=x(mt(n)).toVar(),e=f(-1).toVar();return G(t.x.greaterThan(t.z),()=>{G(t.x.greaterThan(t.y),()=>{e.assign(Xt(n.x.greaterThan(0),0,3))}).else(()=>{e.assign(Xt(n.y.greaterThan(0),1,4))})}).else(()=>{G(t.z.greaterThan(t.y),()=>{e.assign(Xt(n.z.greaterThan(0),2,5))}).else(()=>{e.assign(Xt(n.y.greaterThan(0),1,4))})}),e}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),hg=b(([n,t])=>{const e=D().toVar();return G(t.equal(0),()=>{e.assign(D(n.z,n.y).div(mt(n.x)))}).elseif(t.equal(1),()=>{e.assign(D(n.x.negate(),n.z.negate()).div(mt(n.y)))}).elseif(t.equal(2),()=>{e.assign(D(n.x.negate(),n.y).div(mt(n.z)))}).elseif(t.equal(3),()=>{e.assign(D(n.z.negate(),n.y).div(mt(n.x)))}).elseif(t.equal(4),()=>{e.assign(D(n.x.negate(),n.z).div(mt(n.y)))}).else(()=>{e.assign(D(n.x,n.y).div(mt(n.z)))}),H(.5,e.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),cg=b(([n])=>{const t=f(0).toVar();return G(n.greaterThanEqual(an),()=>{t.assign(Va.sub(n).mul(yo.sub(Xo)).div(Va.sub(an)).add(Xo))}).elseif(n.greaterThanEqual(hn),()=>{t.assign(an.sub(n).mul(xo.sub(yo)).div(an.sub(hn)).add(yo))}).elseif(n.greaterThanEqual(cn),()=>{t.assign(hn.sub(n).mul(No.sub(xo)).div(hn.sub(cn)).add(xo))}).elseif(n.greaterThanEqual(Ca),()=>{t.assign(cn.sub(n).mul(og.sub(No)).div(cn.sub(Ca)).add(No))}).else(()=>{t.assign(f(-2).mul(Fn(H(1.16,n))))}),t}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]});b(([n,t])=>{const e=n.toVar();e.assign(H(2,e).sub(1));const s=x(e,1).toVar();return G(t.equal(0),()=>{s.assign(s.zyx)}).elseif(t.equal(1),()=>{s.assign(s.xzy),s.xz.mulAssign(-1)}).elseif(t.equal(2),()=>{s.x.mulAssign(-1)}).elseif(t.equal(3),()=>{s.assign(s.zyx),s.xz.mulAssign(-1)}).elseif(t.equal(4),()=>{s.assign(s.xzy),s.xy.mulAssign(-1)}).elseif(t.equal(5),()=>{s.z.mulAssign(-1)}),s}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]});const lg=b(([n,t,e,s,i,o])=>{const r=f(e),a=x(t),h=js(cg(r),Xo,o),c=Ln(h),l=Zs(h),u=x($o(n,a,l,s,i,o)).toVar();return G(c.notEqual(0),()=>{const d=x($o(n,a,l.add(1),s,i,o)).toVar();u.assign(Mt(u,d,c))}),u}),$o=b(([n,t,e,s,i,o])=>{const r=f(e).toVar(),a=x(t),h=f(ag(a)).toVar(),c=f(_t(Ea.sub(r),0)).toVar();r.assign(_t(r,Ea));const l=f(Go(r)).toVar(),u=D(hg(a,h).mul(l.sub(2)).add(1)).toVar();return G(h.greaterThan(2),()=>{u.y.addAssign(l),h.subAssign(3)}),u.x.addAssign(h.mul(l)),u.x.addAssign(c.mul(H(3,rg))),u.y.addAssign(H(4,Go(o).sub(l))),u.x.mulAssign(s),u.y.mulAssign(i),n.uv(u).grad(D(),D())}),Mo=b(({envMap:n,mipInt:t,outputDirection:e,theta:s,axis:i,CUBEUV_TEXEL_WIDTH:o,CUBEUV_TEXEL_HEIGHT:r,CUBEUV_MAX_MIP:a})=>{const h=qe(s),c=e.mul(h).add(i.cross(e).mul(Ee(s))).add(i.mul(i.dot(e).mul(h.oneMinus())));return $o(n,c,t,o,r,a)});b(({n,latitudinal:t,poleAxis:e,outputDirection:s,weights:i,samples:o,dTheta:r,mipInt:a,envMap:h,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:u})=>{const d=x(Xt(t,e,hc(e,s))).toVar();G(ic(d.equals(x(0))),()=>{d.assign(x(s.z,0,s.x.negate()))}),d.assign(Mi(d));const p=x().toVar();return p.addAssign(i.element(g(0)).mul(Mo({theta:0,axis:d,outputDirection:s,mipInt:a,envMap:h,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:u}))),Q({start:g(1),end:n},({i:m})=>{G(m.greaterThanEqual(o),()=>{Ec()});const y=f(r.mul(f(m))).toVar();p.addAssign(i.element(m).mul(Mo({theta:y.mul(-1),axis:d,outputDirection:s,mipInt:a,envMap:h,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:u}))),p.addAssign(i.element(m).mul(Mo({theta:y,axis:d,outputDirection:s,mipInt:a,envMap:h,CUBEUV_TEXEL_WIDTH:c,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:u})))}),B(p,1)});let vn=null;const Ia=new WeakMap;function ug(n){const t=Math.log2(n)-2,e=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:e,maxMip:t}}function dg(n){let t=Ia.get(n);if((t!==void 0?t.pmremVersion:-1)!==n.pmremVersion){if(n.isCubeTexture){if(n.source.data.some(s=>s===void 0))throw new Error("PMREMNode: Undefined texture in CubeTexture. Use onLoad callback or async loader");t=vn.fromCubemap(n,t)}else{if(n.image===void 0)throw new Error("PMREMNode: Undefined image in Texture. Use onLoad callback or async loader");t=vn.fromEquirectangular(n,t)}t.pmremVersion=n.pmremVersion,Ia.set(n,t)}return t.texture}class Dc extends tt{constructor(t,e=null,s=null){super("vec3"),this._value=t,this._pmrem=null,this.uvNode=e,this.levelNode=s,this._generator=null,this._texture=$t(null),this._width=j(0),this._height=j(0),this._maxMip=j(0),this.updateBeforeType=st.RENDER}set value(t){this._value=t,this._pmrem=null}get value(){return this._value}updateFromTexture(t){const e=ug(t.image.height);this._texture.value=t,this._width.value=e.texelWidth,this._height.value=e.texelHeight,this._maxMip.value=e.maxMip}updateBefore(){let t=this._pmrem;const e=t?t.pmremVersion:-1,s=this._value;e!==s.pmremVersion&&(s.isPMREMTexture===!0?t=s:t=dg(s),this._pmrem=t,this.updateFromTexture(t))}setup(t){vn===null&&(vn=t.createPMREMGenerator()),this.updateBefore(t);let e=this.uvNode;e===null&&t.context.getUV&&(e=t.context.getUV(this));const s=this.value;t.renderer.coordinateSystem===Ie&&s.isPMREMTexture!==!0&&s.isRenderTargetTexture===!0&&(e=x(e.x.negate(),e.yz));let i=this.levelNode;return i===null&&t.context.getTextureLevel&&(i=t.context.getTextureLevel(this)),lg(this._texture,e,i,this._width,this._height,this._maxMip)}}const pg=T(Dc);A("PMREMNode",Dc);const Fa=new WeakMap;class kc extends Vi{constructor(t=null){super(),this.envNode=t}setup(t){let e=this.envNode;if(e.isTextureNode){let d=Fa.get(e.value);d===void 0&&(d=pg(e.value),Fa.set(e.value,d)),e=d}const{material:s}=t,o=s.envMap?pe("envMapIntensity","float",t.material):pe("environmentIntensity","float",t.scene),a=s.useAnisotropy===!0||s.anisotropy>0?ng:ut,h=Oe(e,La(je,a)).mul(o),c=Oe(e,mg(Mc)).mul(Math.PI).mul(o),l=fn(h);t.context.radiance.addAssign(l),t.context.iblIrradiance.addAssign(c);const u=t.context.lightingModel.clearcoatRadiance;if(u){const d=Oe(e,La(xn,Ls)).mul(o),p=fn(d);u.addAssign(p)}}}const La=(n,t)=>{let e=null;return{getUV:()=>(e===null&&(e=ht.negate().reflect(t),e=n.mul(n).mix(e,t).normalize(),e=e.transformDirection(Ks)),e),getTextureLevel:()=>n}},mg=n=>({getUV:()=>n,getTextureLevel:()=>f(1)});A("EnvironmentNode",kc);class Uc extends Vi{constructor(t){super(),this.node=t}setup(t){t.context.irradiance.addAssign(this.node)}}A("IrradianceNode",Uc);let wo,To;class X extends k{constructor(t){super(),this.scope=t,this.isViewportNode=!0}getNodeType(){return this.scope===X.VIEWPORT?"vec4":this.scope===X.COORDINATE?"vec3":"vec2"}getUpdateType(){let t=st.NONE;return(this.scope===X.RESOLUTION||this.scope===X.VIEWPORT)&&(t=st.RENDER),this.updateType=t,t}update({renderer:t}){this.scope===X.VIEWPORT?t.getViewport(To):t.getDrawingBufferSize(wo)}setup(){const t=this.scope;let e=null;if(t===X.RESOLUTION)e=j(wo||(wo=new W));else if(t===X.VIEWPORT)e=j(To||(To=new xt));else{e=fg.div(Yo);let s=e.x,i=e.y;/bottom/i.test(t)&&(i=i.oneMinus()),/right/i.test(t)&&(s=s.oneMinus()),e=D(s,i)}return e}generate(t){if(this.scope===X.COORDINATE){let e=t.getFragCoord();if(t.isFlipY()){const s=t.getNodeProperties(Yo).outputNode.build(t);e=`${t.getType("vec3")}( ${e}.x, ${s}.y - ${e}.y, ${e}.z )`}return e}return super.generate(t)}}X.COORDINATE="coordinate";X.RESOLUTION="resolution";X.VIEWPORT="viewport";X.TOP_LEFT="topLeft";X.BOTTOM_LEFT="bottomLeft";X.TOP_RIGHT="topRight";X.BOTTOM_RIGHT="bottomRight";const fg=V(X,X.COORDINATE),Yo=V(X,X.RESOLUTION),Ws=V(X,X.VIEWPORT),vi=V(X,X.TOP_LEFT);V(X,X.BOTTOM_LEFT);V(X,X.TOP_RIGHT);V(X,X.BOTTOM_RIGHT);A("ViewportNode",X);const ui=new W;class Ci extends ys{constructor(t=vi,e=null,s=null){s===null&&(s=new Ah,s.minFilter=dh),super(s,t,e),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=st.FRAME}updateBefore(t){const e=t.renderer;e.getDrawingBufferSize(ui);const s=this.value;(s.image.width!==ui.width||s.image.height!==ui.height)&&(s.image.width=ui.width,s.image.height=ui.height,s.needsUpdate=!0);const i=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,e.copyFramebufferToTexture(s),s.generateMipmaps=i}clone(){const t=new this.constructor(this.uvNode,this.levelNode,this.value);return t.generateMipmaps=this.generateMipmaps,t}}const gg=T(Ci),Gc=T(Ci,null,null,{generateMipmaps:!0});M("viewportTexture",gg);M("viewportMipTexture",Gc);A("ViewportTextureNode",Ci);let vo=null;class Wc extends Ci{constructor(t=vi,e=null){vo===null&&(vo=new zn),super(t,e,vo)}}const qc=T(Wc);M("viewportDepthTexture",qc);A("ViewportDepthTextureNode",Wc);class At extends k{constructor(t,e=null){super("float"),this.scope=t,this.valueNode=e,this.isViewportDepthNode=!0}generate(t){const{scope:e}=this;return e===At.DEPTH_PIXEL?t.getFragDepth():super.generate(t)}setup(){const{scope:t}=this;let e=null;if(t===At.DEPTH)e=Zo(jt.z,po,mo);else if(t===At.DEPTH_TEXTURE){const s=this.valueNode||qc(),i=Hc(s,po,mo);e=Zo(i,po,mo)}else t===At.DEPTH_PIXEL&&this.valueNode!==null&&(e=jc().assign(this.valueNode));return e}}const Zo=(n,t,e)=>n.add(t).div(t.sub(e)),Hc=(n,t,e)=>t.mul(e).div(e.sub(t).mul(n).sub(e));At.DEPTH="depth";At.DEPTH_TEXTURE="depthTexture";At.DEPTH_PIXEL="depthPixel";const jc=T(At,At.DEPTH_PIXEL);V(At,At.DEPTH);T(At,At.DEPTH_TEXTURE);const Xc=V(At,At.DEPTH_PIXEL);Xc.assign=n=>jc(n);A("ViewportDepthNode",At);class Qe extends k{constructor(t=Qe.DEFAULT){super(),this.scope=t}setup(t){super.setup(t);const e=t.clippingContext,{localClipIntersection:s,localClippingCount:i,globalClippingCount:o}=e,r=o+i,a=s?r-i:r;return this.scope===Qe.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(e.planes,r,a):this.setupDefault(e.planes,r,a)}setupAlphaToCoverage(t,e,s){return b(()=>{const i=Wo(t),o=at("float","distanceToPlane"),r=at("float","distanceToGradient"),a=at("float","clipOpacity");a.assign(1);let h;if(Q(s,({i:c})=>{h=i.element(c),o.assign(jt.dot(h.xyz).negate().add(h.w)),r.assign(o.fwidth().div(2)),a.mulAssign(we(r.negate(),r,o)),a.equal(0).discard()}),s<e){const c=at("float","unionclipOpacity");c.assign(1),Q({start:s,end:e},({i:l})=>{h=i.element(l),o.assign(jt.dot(h.xyz).negate().add(h.w)),r.assign(o.fwidth().div(2)),c.mulAssign(we(r.negate(),r,o).oneMinus())}),a.mulAssign(c.oneMinus())}et.a.mulAssign(a),et.a.equal(0).discard()})()}setupDefault(t,e,s){return b(()=>{const i=Wo(t);let o;if(Q(s,({i:r})=>{o=i.element(r),jt.dot(o.xyz).greaterThan(o.w).discard()}),s<e){const r=at("bool","clipped");r.assign(!0),Q({start:s,end:e},({i:a})=>{o=i.element(a),r.assign(jt.dot(o.xyz).greaterThan(o.w).and(r))}),r.discard()}})()}}Qe.ALPHA_TO_COVERAGE="alphaToCoverage";Qe.DEFAULT="default";const yg=()=>I(new Qe),xg=()=>I(new Qe(Qe.ALPHA_TO_COVERAGE));class $c extends k{constructor(){super("bool"),this.isFrontFacingNode=!0}generate(t){const{renderer:e,material:s}=t;return e.coordinateSystem===Ie&&s.side===ch?"false":t.getFrontFacing()}}const Ng=V($c),Sn=f(Ng).mul(2).sub(1);A("FrontFacingNode",$c);const Jo=new Map;class Lt extends Yt{constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!0,this.normals=!0,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.depthNode=null,this.shadowNode=null,this.shadowPositionNode=null,this.outputNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+Ch(this)}build(t){this.setup(t)}setup(t){t.addStack(),t.stack.outputNode=this.vertexNode||this.setupPosition(t),t.addFlow("vertex",t.removeStack()),t.addStack();let e;const s=this.setupClipping(t);if(this.depthWrite===!0&&this.setupDepth(t),this.fragmentNode===null){this.normals===!0&&this.setupNormal(t),this.setupDiffuseColor(t),this.setupVariants(t);const i=this.setupLighting(t);s!==null&&t.stack.add(s);const o=B(i,et.a).max(0);e=this.setupOutput(t,o),rm.assign(e),this.outputNode!==null&&(e=this.outputNode)}else{let i=this.fragmentNode;i.isOutputStructNode!==!0&&(i=B(i)),e=this.setupOutput(t,i)}t.stack.outputNode=e,t.addFlow("fragment",t.removeStack())}setupClipping(t){if(t.clippingContext===null)return null;const{globalClippingCount:e,localClippingCount:s}=t.clippingContext;let i=null;return(e||s)&&(this.alphaToCoverage?i=xg():t.stack.add(yg())),i}setupDepth(t){const{renderer:e}=t;let s=this.depthNode;s===null&&e.logarithmicDepthBuffer===!0&&(s=_a().w.add(1).log2().mul(ff).mul(.5)),s!==null&&Xc.assign(s).append()}setupPosition(t){const{object:e}=t,s=e.geometry;if(t.addStack(),(s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&Zf(e).append(),e.isSkinnedMesh===!0&&$f(e).append(),this.displacementMap){const o=Fe("displacementMap","texture"),r=Fe("displacementScale","float"),a=Fe("displacementBias","float");zt.addAssign(me.normalize().mul(o.x.mul(r).add(a)))}e.isBatchedMesh&&Xf(e).append(),e.instanceMatrix&&e.instanceMatrix.isInstancedBufferAttribute===!0&&t.isAvailable("instance")===!0&&jf(e).append(),this.positionNode!==null&&zt.assign(this.positionNode);const i=_a();return t.context.vertex=t.removeStack(),t.context.mvp=i,i}setupDiffuseColor({object:t,geometry:e}){let s=this.colorNode?B(this.colorNode):Ti;this.vertexColors===!0&&e.hasAttribute("color")&&(s=B(s.xyz.mul(bt("color","vec3")),s.a)),t.instanceColor&&(s=fe("vec3","vInstanceColor").mul(s)),et.assign(s);const i=this.opacityNode?f(this.opacityNode):wc;if(et.a.assign(et.a.mul(i)),this.alphaTestNode!==null||this.alphaTest>0){const o=this.alphaTestNode!==null?f(this.alphaTestNode):xf;et.a.lessThanEqual(o).discard()}}setupVariants(){}setupNormal(){if(this.flatShading===!0){const t=jt.dFdx().cross(jt.dFdy()).normalize();ut.assign(t.mul(Sn))}else{const t=this.normalNode?x(this.normalNode):_f;ut.assign(t.mul(Sn))}}getEnvNode(t){let e=null;return this.envNode?e=this.envNode:this.envMap?e=this.envMap.isCubeTexture?Lc(this.envMap):$t(this.envMap):t.environmentNode&&(e=t.environmentNode),e}setupLights(t){const e=this.getEnvNode(t),s=[];if(e&&s.push(new kc(e)),t.material.lightMap&&s.push(new Uc(Fe("lightMap","texture"))),this.aoNode!==null||t.material.aoMap){const o=this.aoNode!==null?this.aoNode:$t(t.material.aoMap);s.push(new Oc(o))}let i=this.lightsNode||t.lightsNode;return s.length>0&&(i=eg([...i.lightNodes,...s])),i}setupLightingModel(){}setupLighting(t){const{material:e}=t,{backdropNode:s,backdropAlphaNode:i,emissiveNode:o}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(t):null;let h=et.rgb;if(a&&a.hasLight!==!1){const c=this.setupLightingModel(t);h=Bc(a,c,s,i)}else s!==null&&(h=x(i!==null?Mt(h,s,i):s));return(o&&o.isNode===!0||e.emissive&&e.emissive.isColor===!0)&&(h=h.add(x(o||Mf))),h}setupOutput(t,e){const s=t.fogNode;return s&&(e=B(s.mix(e.rgb,s.colorNode),e.a)),e}setDefaultValues(t){for(const s in t){const i=t[s];this[s]===void 0&&(this[s]=i,i&&i.clone&&(this[s]=i.clone()))}const e=Object.getOwnPropertyDescriptors(t.constructor.prototype);for(const s in e)Object.getOwnPropertyDescriptor(this.constructor.prototype,s)===void 0&&e[s].get!==void 0&&Object.defineProperty(this.constructor.prototype,s,e[s])}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{},nodes:{}});const s=Yt.prototype.toJSON.call(this,t),i=mn(this);s.inputNodes={};for(const{property:r,childNode:a}of i)s.inputNodes[r]=a.toJSON(t).uuid;function o(r){const a=[];for(const h in r){const c=r[h];delete c.metadata,a.push(c)}return a}if(e){const r=o(t.textures),a=o(t.images),h=o(t.nodes);r.length>0&&(s.textures=r),a.length>0&&(s.images=a),h.length>0&&(s.nodes=h)}return s}copy(t){return this.lightsNode=t.lightsNode,this.envNode=t.envNode,this.colorNode=t.colorNode,this.normalNode=t.normalNode,this.opacityNode=t.opacityNode,this.backdropNode=t.backdropNode,this.backdropAlphaNode=t.backdropAlphaNode,this.alphaTestNode=t.alphaTestNode,this.positionNode=t.positionNode,this.depthNode=t.depthNode,this.shadowNode=t.shadowNode,this.shadowPositionNode=t.shadowPositionNode,this.outputNode=t.outputNode,this.fragmentNode=t.fragmentNode,this.vertexNode=t.vertexNode,super.copy(t)}static fromMaterial(t){if(t.isNodeMaterial===!0)return t;const e=t.type.replace("Material","NodeMaterial"),s=Mg(e);if(s===void 0)throw new Error(`NodeMaterial: Material "${t.type}" is not compatible.`);for(const i in t)s[i]=t[i];return s}}function St(n,t){if(typeof t!="function"||!n)throw new Error(`Node material ${n} is not a class`);if(Jo.has(n)){console.warn(`Redefinition of node material ${n}`);return}Jo.set(n,t),t.type=n}function Mg(n){const t=Jo.get(n);if(t!==void 0)return new t}St("NodeMaterial",Lt);class Yc extends k{constructor(t=null){super(),this.nodes=[],this.outputNode=null,this.parent=t,this._currentCond=null,this.isStackNode=!0}getNodeType(t){return this.outputNode?this.outputNode.getNodeType(t):"void"}add(t){return this.nodes.push(t),this}if(t,e){const s=new gi(e);return this._currentCond=Xt(t,s),this.add(this._currentCond)}elseif(t,e){const s=new gi(e),i=Xt(t,s);return this._currentCond.elseNode=i,this._currentCond=i,this}else(t){return this._currentCond.elseNode=new gi(t),this}build(t,...e){const s=Fp();Ma(this);for(const i of this.nodes)i.build(t,"void");return Ma(s),this.outputNode?this.outputNode.build(t,...e):super.build(t,...e)}}T(Yc);A("StackNode",Yc);class Zc extends tt{constructor(t=qf){super("vec2"),this.dirNode=t}setup(){const t=this.dirNode,e=t.z.atan2(t.x).mul(1/(Math.PI*2)).add(.5),s=t.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return D(e,s)}}T(Zc);A("EquirectUVNode",Zc);class Jc extends k{constructor(t){super(),this.types=t,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}A("StructTypeNode",Jc);class Qc extends k{constructor(...t){super(),this.members=t,this.isOutputStructNode=!0}setup(t){super.setup(t);const e=this.members,s=[];for(let i=0;i<e.length;i++)s.push(e[i].getNodeType(t));this.nodeType=t.getStructTypeFromNode(new Jc(s)).name}generate(t,e){const s=t.getOutputStructName(),i=this.members,o=s!==""?s+".":"";for(let r=0;r<i.length;r++){const a=i[r].build(t,e);t.addLineFlowCode(`${o}m${r} = ${a}`)}return s}}T(Qc);A("OutputStructNode",Qc);class Kc extends k{constructor(t){super(),this.seedNode=t}setup(){const t=this.seedNode.toUint().mul(747796405).add(2891336453),e=t.shiftRight(t.shiftRight(28).add(4)).bitXor(t).mul(277803737);return e.shiftRight(22).bitXor(e).toFloat().mul(1/2**32)}}const wg=T(Kc);M("hash",wg);A("HashNode",Kc);const Qo=(n,t)=>Ne(H(4,n.mul(dt(1,n))),t),Tg=(n,t)=>n.lessThan(.5)?Qo(n.mul(2),t).div(2):dt(1,Qo(H(dt(1,n),2),t).div(2)),vg=(n,t,e)=>Ne(Ze(Ne(n,t),Zt(Ne(n,t),Ne(dt(1,n),e))),1/t),Sg=(n,t)=>Ee(wa.mul(t.mul(n).sub(1))).div(wa.mul(t.mul(n).sub(1)));M("parabola",Qo);M("gain",Tg);M("pcurve",vg);M("sinc",Sg);const ye=b(([n])=>n.fract().sub(.5).abs()),tl=b(([n])=>x(ye(n.z.add(ye(n.y.mul(1)))),ye(n.z.add(ye(n.x.mul(1)))),ye(n.y.add(ye(n.x.mul(1)))))),bg=b(([n,t,e])=>{const s=x(n).toVar(),i=f(1.4).toVar(),o=f(0).toVar(),r=x(s).toVar();return Q({start:f(0),end:f(3),type:"float",condition:"<="},()=>{const a=x(tl(r.mul(2))).toVar();s.addAssign(a.add(e.mul(f(.1).mul(t)))),r.mulAssign(1.8),i.mulAssign(1.5),s.mulAssign(1.2);const h=f(ye(s.z.add(ye(s.x.add(ye(s.y)))))).toVar();o.addAssign(h.div(i)),r.addAssign(.14)}),o});ye.setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]});tl.setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]});bg.setLayout({name:"triNoise3D",type:"float",inputs:[{name:"p",type:"vec3"},{name:"spd",type:"float"},{name:"time",type:"float"}]});let So;class el extends Tr{constructor(t){So=So||On("discard"),super(t,So)}}const _g=T(el),Ag=n=>_g(n).append();M("discard",Ag);A("DiscardNode",el);class sl extends k{constructor(t=[],...e){super(),this.functionNodes=t,this.parametersNodes=e,this._candidateFnCall=null}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(t){const e=this.parametersNodes;let s=this._candidateFnCall;if(s===null){let i=null,o=-1;for(const r of this.functionNodes){const h=r.shaderNode.layout;if(h===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const c=h.inputs;if(e.length===c.length){let l=0;for(let u=0;u<e.length;u++){const d=e[u],p=c[u];d.getNodeType(t)===p.type?l++:l=0}l>o&&(i=r,o=l)}}this._candidateFnCall=s=i(...e)}return s}}const zg=T(sl),te=n=>(...t)=>zg(n,...t);A("FunctionOverloadingNode",sl);class il extends tt{constructor(){super("vec2")}setup(){const t=x(ht.z,0,ht.x.negate()).normalize(),e=ht.cross(t);return D(t.dot(ut),e.dot(ut)).mul(.495).add(.5)}}const Rg=V(il);A("MatcapUVNode",il);class kt extends fs{constructor(t=kt.LOCAL,e=1,s=0){super(s),this.scope=t,this.scale=e,this.updateType=st.FRAME}update(t){const e=this.scope,s=this.scale;e===kt.LOCAL?this.value+=t.deltaTime*s:e===kt.DELTA?this.value=t.deltaTime*s:e===kt.FRAME?this.value=t.frameId:this.value=t.time*s}serialize(t){super.serialize(t),t.scope=this.scope,t.scale=this.scale}deserialize(t){super.deserialize(t),this.scope=t.scope,this.scale=t.scale}}kt.LOCAL="local";kt.GLOBAL="global";kt.DELTA="delta";kt.FRAME="frame";const Vg=(n,t=0)=>I(new kt(kt.LOCAL,n,t));V(kt,kt.FRAME).toUint();A("TimerNode",kt);class Nt extends k{constructor(t=Nt.SINE,e=Vg()){super(),this.method=t,this.timeNode=e}getNodeType(t){return this.timeNode.getNodeType(t)}setup(){const t=this.method,e=I(this.timeNode);let s=null;return t===Nt.SINE?s=e.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5):t===Nt.SQUARE?s=e.fract().round():t===Nt.TRIANGLE?s=e.add(.5).fract().mul(2).sub(1).abs():t===Nt.SAWTOOTH&&(s=e.fract()),s}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}Nt.SINE="sine";Nt.SQUARE="square";Nt.TRIANGLE="triangle";Nt.SAWTOOTH="sawtooth";T(Nt,Nt.SINE);T(Nt,Nt.SQUARE);T(Nt,Nt.TRIANGLE);T(Nt,Nt.SAWTOOTH);A("OscNode",Nt);class Te extends tt{constructor(t,e){super(),this.scope=t,this.node=e}getNodeType(t){return this.node.getNodeType(t)}setup(){const{scope:t,node:e}=this;let s=null;return t===Te.DIRECTION_TO_COLOR?s=e.mul(.5).add(.5):t===Te.COLOR_TO_DIRECTION&&(s=e.mul(2).sub(1)),s}}Te.DIRECTION_TO_COLOR="directionToColor";Te.COLOR_TO_DIRECTION="colorToDirection";const nl=T(Te,Te.DIRECTION_TO_COLOR),Cg=T(Te,Te.COLOR_TO_DIRECTION);M("directionToColor",nl);M("colorToDirection",Cg);A("PackingNode",Te);class vr extends k{constructor(t,e,s,i=f(0),o=f(1)){super(),this.node=t,this.inLowNode=e,this.inHighNode=s,this.outLowNode=i,this.outHighNode=o,this.doClamp=!0}setup(){const{node:t,inLowNode:e,inHighNode:s,outLowNode:i,outHighNode:o,doClamp:r}=this;let a=t.sub(e).div(s.sub(e));return r===!0&&(a=a.clamp()),a.mul(o.sub(i)).add(i)}}const Eg=T(vr,null,null,{doClamp:!1}),Ig=T(vr);M("remap",Eg);M("remapClamp",Ig);A("RemapNode",vr);class ol extends tt{constructor(t,e,s=D(.5)){super("vec2"),this.uvNode=t,this.rotationNode=e,this.centerNode=s}setup(){const{uvNode:t,rotationNode:e,centerNode:s}=this;return t.sub(s).rotate(e).add(s)}}const Fg=T(ol);M("rotateUV",Fg);A("RotateUVNode",ol);class rl extends tt{constructor(t,e){super(),this.positionNode=t,this.rotationNode=e}getNodeType(t){return this.positionNode.getNodeType(t)}setup(t){const{rotationNode:e,positionNode:s}=this;if(this.getNodeType(t)==="vec2"){const o=e.cos(),r=e.sin();return ur(o,r,r.negate(),o).mul(s)}else{const o=e,r=Ds(B(1,0,0,0),B(0,qe(o.x),Ee(o.x).negate(),0),B(0,Ee(o.x),qe(o.x),0),B(0,0,0,1)),a=Ds(B(qe(o.y),0,Ee(o.y),0),B(0,1,0,0),B(Ee(o.y).negate(),0,qe(o.y),0),B(0,0,0,1)),h=Ds(B(qe(o.z),Ee(o.z).negate(),0,0),B(Ee(o.z),qe(o.z),0,0),B(0,0,1,0),B(0,0,0,1));return r.mul(a).mul(h).mul(B(s,1)).xyz}}}const Lg=T(rl);M("rotate",Lg);A("RotateNode",rl);class al extends k{constructor(t,e=be(),s=f(0)){super("vec2"),this.countNode=t,this.uvNode=e,this.frameNode=s}setup(){const{frameNode:t,uvNode:e,countNode:s}=this,{width:i,height:o}=s,r=t.mod(i.mul(o)).floor(),a=r.mod(i),h=o.sub(r.add(1).div(i).ceil()),c=s.reciprocal(),l=D(a,h);return e.add(l).mul(c)}}T(al);A("SpriteSheetUVNode",al);class hl extends Ys{constructor(t,e){super(t,e),this.isStorageArrayElementNode=!0}set storageBufferNode(t){this.node=t}get storageBufferNode(){return this.node}setup(t){return t.isAvailable("storageBuffer")===!1&&!this.node.instanceIndex&&this.node.bufferObject===!0&&t.setupPBO(this.node),super.setup(t)}generate(t,e){let s;const i=t.context.assign;if(t.isAvailable("storageBuffer")===!1){const{node:o}=this;!o.instanceIndex&&this.node.bufferObject===!0&&i!==!0?s=t.generatePBO(this):s=o.build(t)}else s=super.generate(t);if(i!==!0){const o=this.getNodeType(t);s=t.format(s,o,e)}return s}}const cl=T(hl);M("storageElement",cl);A("StorageArrayElementNode",hl);class ll extends k{constructor(t,e=null,s=null,i=f(1),o=zt,r=me){super("vec4"),this.textureXNode=t,this.textureYNode=e,this.textureZNode=s,this.scaleNode=i,this.positionNode=o,this.normalNode=r}setup(){const{textureXNode:t,textureYNode:e,textureZNode:s,scaleNode:i,positionNode:o,normalNode:r}=this;let a=r.abs().normalize();a=a.div(a.dot(x(1)));const h=o.yz.mul(i),c=o.zx.mul(i),l=o.xy.mul(i),u=t.value,d=e!==null?e.value:u,p=s!==null?s.value:u,m=$t(u,h).mul(a.x),y=$t(d,c).mul(a.y),w=$t(p,l).mul(a.z);return Zt(m,y,w)}}const Og=T(ll),Pg=(...n)=>Og(...n);M("triplanarTexture",Pg);A("TriplanarTexturesNode",ll);new rs;new v;new v;new v;new ft;new v(0,0,-1);new xt;new v;new v;new xt;new W;new ls;D(vi.x.oneMinus(),vi.y);class Bg extends dr{constructor(t=0){super(null,"vec4"),this.isVertexColorNode=!0,this.index=t}getAttributeName(){const t=this.index;return"color"+(t>0?t:"")}generate(t){const e=this.getAttributeName(t),s=t.hasGeometryAttribute(e);let i;return s===!0?i=super.generate(t):i=t.generateConst(this.nodeType,new xt(1,1,1,1)),i}serialize(t){super.serialize(t),t.index=this.index}deserialize(t){super.deserialize(t),this.index=t.index}}A("VertexColorNode",Bg);class ul extends Qs{constructor(t,e,s=null){super(t,e,s),this.renderer=s}updateReference(t){return this.reference=this.renderer!==null?this.renderer:t.renderer,this.reference}}const Dg=(n,t,e)=>I(new ul(n,t,e));A("RendererReferenceNode",ul);const Dn=1/6,dl=n=>H(Dn,H(n,H(n,n.negate().add(3)).sub(3)).add(1)),Ko=n=>H(Dn,H(n,H(n,H(3,n).sub(6))).add(4)),pl=n=>H(Dn,H(n,H(n,H(-3,n).add(3)).add(3)).add(1)),tr=n=>H(Dn,Ne(n,3)),Oa=n=>dl(n).add(Ko(n)),Pa=n=>pl(n).add(tr(n)),Ba=n=>Zt(-1,Ko(n).div(dl(n).add(Ko(n)))),Da=n=>Zt(1,tr(n).div(pl(n).add(tr(n)))),ka=(n,t,e)=>{const s=n.uvNode,i=H(s,t.zw).add(.5),o=Zs(i),r=Ln(i),a=Oa(r.x),h=Pa(r.x),c=Ba(r.x),l=Da(r.x),u=Ba(r.y),d=Da(r.y),p=D(o.x.add(c),o.y.add(u)).sub(.5).mul(t.xy),m=D(o.x.add(l),o.y.add(u)).sub(.5).mul(t.xy),y=D(o.x.add(c),o.y.add(d)).sub(.5).mul(t.xy),w=D(o.x.add(l),o.y.add(d)).sub(.5).mul(t.xy),S=Oa(r.y).mul(Zt(a.mul(n.uv(p).level(e)),h.mul(n.uv(m).level(e)))),R=Pa(r.y).mul(Zt(a.mul(n.uv(y).level(e)),h.mul(n.uv(w).level(e))));return S.add(R)},kg=(n,t)=>{const e=D(n.size(g(t))),s=D(n.size(g(t.add(1)))),i=Ze(1,e),o=Ze(1,s),r=ka(n,B(i,e),Zs(t)),a=ka(n,B(o,s),rc(t));return Ln(t).mix(r,a)};class ml extends tt{constructor(t,e=f(3)){super("vec4"),this.textureNode=t,this.blurNode=e}setup(){return kg(this.textureNode,this.blurNode)}}const Ug=T(ml);M("bicubic",Ug);A("TextureBicubicNode",ml);class fl extends k{constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}V(fl);A("PointUVNode",fl);class le extends k{constructor(t=le.BACKGROUND_BLURRINESS,e=null){super(),this.scope=t,this.scene=e}setup(t){const e=this.scope,s=this.scene!==null?this.scene:t.scene;let i;return e===le.BACKGROUND_BLURRINESS?i=pe("backgroundBlurriness","float",s):e===le.BACKGROUND_INTENSITY?i=pe("backgroundIntensity","float",s):console.error("THREE.SceneNode: Unknown scope:",e),i}}le.BACKGROUND_BLURRINESS="backgroundBlurriness";le.BACKGROUND_INTENSITY="backgroundIntensity";V(le,le.BACKGROUND_BLURRINESS);V(le,le.BACKGROUND_INTENSITY);A("SceneNode",le);class Gg extends Pn{constructor(t,e,s=0){super(t,e,s),this.isStorageBufferNode=!0,this.bufferObject=!1,this._attribute=null,this._varying=null,t.isStorageBufferAttribute!==!0&&t.isStorageInstancedBufferAttribute!==!0&&(t.isInstancedBufferAttribute?t.isStorageInstancedBufferAttribute=!0:t.isStorageBufferAttribute=!0)}getInputType(){return"storageBuffer"}element(t){return cl(this,t)}setBufferObject(t){return this.bufferObject=t,this}generate(t){if(t.isAvailable("storageBuffer"))return super.generate(t);const e=this.getNodeType(t);this._attribute===null&&(this._attribute=Bn(this.value),this._varying=gt(this._attribute));const s=this._varying.build(t,e);return t.registerTransform(s,this._attribute),s}}A("StorageBufferNode",Gg);const Wg={WriteOnly:"write-only"};class gl extends ys{constructor(t,e,s=null){super(t,e),this.storeNode=s,this.isStorageTextureNode=!0,this.access=Wg.WriteOnly}getInputType(){return"storageTexture"}setup(t){super.setup(t);const e=t.getNodeProperties(this);e.storeNode=this.storeNode}setAccess(t){return this.access=t,this}generate(t,e){let s;return this.storeNode!==null?s=this.generateStore(t):s=super.generate(t,e),s}generateStore(t){const e=t.getNodeProperties(this),{uvNode:s,storeNode:i}=e,o=super.generate(t,"property"),r=s.build(t,"uvec2"),a=i.build(t,"vec4"),h=t.generateTextureStore(t,o,r,a);t.addLineFlowCode(h)}}T(gl);A("StorageTextureNode",gl);const qg=b(({texture:n,uv:t})=>{const s=x().temp();return G(t.x.lessThan(1e-4),()=>{s.assign(x(1,0,0))}).elseif(t.y.lessThan(1e-4),()=>{s.assign(x(0,1,0))}).elseif(t.z.lessThan(1e-4),()=>{s.assign(x(0,0,1))}).elseif(t.x.greaterThan(1-1e-4),()=>{s.assign(x(-1,0,0))}).elseif(t.y.greaterThan(1-1e-4),()=>{s.assign(x(0,-1,0))}).elseif(t.z.greaterThan(1-1e-4),()=>{s.assign(x(0,0,-1))}).else(()=>{const o=n.uv(t.add(x(-.01,0,0))).r.sub(n.uv(t.add(x(.01,0,0))).r),r=n.uv(t.add(x(0,-.01,0))).r.sub(n.uv(t.add(x(0,.01,0))).r),a=n.uv(t.add(x(0,0,-.01))).r.sub(n.uv(t.add(x(0,0,.01))).r);s.assign(x(o,r,a))}),s.normalize()});class yl extends ys{constructor(t,e=null,s=null){super(t,e,s),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return x(.5,.5,.5)}setUpdateMatrix(){}setupUV(t,e){return e}generateUV(t,e){return e.build(t,"vec3")}normal(t){return qg({texture:this,uv:t})}}const Hg=T(yl);A("Texture3DNode",yl);class jg extends Qs{constructor(t,e,s=null){super(t,e,s),this.userData=s}update(t){this.reference=this.userData!==null?this.userData:t.object.userData,super.update(t)}}A("UserDataNode",jg);const Xg=b(({base:n,blend:t})=>{const e=s=>t[s].lessThan(sc).cond(t[s],n[s].oneMinus().div(t[s]).oneMinus().max(0));return x(e("x"),e("y"),e("z"))}).setLayout({name:"burnColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),$g=b(({base:n,blend:t})=>{const e=s=>t[s].equal(1).cond(t[s],n[s].div(t[s].oneMinus()).max(0));return x(e("x"),e("y"),e("z"))}).setLayout({name:"dodgeColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Yg=b(({base:n,blend:t})=>{const e=s=>n[s].oneMinus().mul(t[s].oneMinus()).oneMinus();return x(e("x"),e("y"),e("z"))}).setLayout({name:"screenColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Zg=b(({base:n,blend:t})=>{const e=s=>n[s].lessThan(.5).cond(n[s].mul(t[s],2),n[s].oneMinus().mul(t[s].oneMinus()).oneMinus());return x(e("x"),e("y"),e("z"))}).setLayout({name:"overlayColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]});class vt extends tt{constructor(t,e,s){super(),this.blendMode=t,this.baseNode=e,this.blendNode=s}setup(){const{blendMode:t,baseNode:e,blendNode:s}=this,i={base:e,blend:s};let o=null;return t===vt.BURN?o=Xg(i):t===vt.DODGE?o=$g(i):t===vt.SCREEN?o=Yg(i):t===vt.OVERLAY&&(o=Zg(i)),o}}vt.BURN="burn";vt.DODGE="dodge";vt.SCREEN="screen";vt.OVERLAY="overlay";const Jg=T(vt,vt.BURN),Qg=T(vt,vt.DODGE),Kg=T(vt,vt.OVERLAY),ty=T(vt,vt.SCREEN);M("burn",Jg);M("dodge",Qg);M("overlay",Kg);M("screen",ty);A("BlendModeNode",vt);const ey=b(({textureNode:n,bumpScale:t})=>{const e=i=>n.cache().context({getUV:o=>i(o.uvNode||be()),forceUVContext:!0}),s=f(e(i=>i));return D(f(e(i=>i.add(i.dFdx()))).sub(s),f(e(i=>i.add(i.dFdy()))).sub(s)).mul(t)}),sy=b(n=>{const{surf_pos:t,surf_norm:e,dHdxy:s}=n,i=t.dFdx().normalize(),o=t.dFdy().normalize(),r=e,a=o.cross(r),h=r.cross(i),c=i.dot(a).mul(Sn),l=c.sign().mul(s.x.mul(a).add(s.y.mul(h)));return c.abs().mul(e).sub(l).normalize()});class xl extends tt{constructor(t,e=null){super("vec3"),this.textureNode=t,this.scaleNode=e}setup(){const t=this.scaleNode!==null?this.scaleNode:1,e=ey({textureNode:this.textureNode,bumpScale:t});return sy({surf_pos:jt,surf_norm:Je,dHdxy:e})}}const iy=T(xl);M("bumpMap",iy);A("BumpMapNode",xl);const ny=b(({color:n,adjustment:t})=>t.mix(Nl(n.rgb),n.rgb)),oy=b(({color:n,adjustment:t})=>{const e=Zt(n.r,n.g,n.b).div(3),s=n.r.max(n.g.max(n.b)),i=s.sub(e).mul(t).mul(-3);return Mt(n.rgb,s,i)}),ry=b(({color:n,adjustment:t})=>{const e=x(.57735,.57735,.57735),s=t.cos();return x(n.rgb.mul(s).add(e.cross(n.rgb).mul(t.sin()).add(e.mul(Js(e,n.rgb).mul(s.oneMinus())))))});class Ut extends tt{constructor(t,e,s=f(1)){super("vec3"),this.method=t,this.colorNode=e,this.adjustmentNode=s}setup(){const{method:t,colorNode:e,adjustmentNode:s}=this,i={color:e,adjustment:s};let o=null;return t===Ut.SATURATION?o=ny(i):t===Ut.VIBRANCE?o=oy(i):t===Ut.HUE?o=ry(i):console.error(`${this.type}: Method "${this.method}" not supported!`),o}}Ut.SATURATION="saturation";Ut.VIBRANCE="vibrance";Ut.HUE="hue";const ay=T(Ut,Ut.SATURATION),hy=T(Ut,Ut.VIBRANCE),cy=T(Ut,Ut.HUE),ly=x(.2125,.7154,.0721),Nl=(n,t=ly)=>Js(n,t),Ml=(n,t)=>Mt(x(0),n,Nl(n).sub(t).max(0));M("saturation",ay);M("vibrance",hy);M("hue",cy);M("threshold",Ml);A("ColorAdjustmentNode",Ut);const uy=b(n=>{const{eye_pos:t,surf_norm:e,mapN:s,uv:i}=n,o=t.dFdx(),r=t.dFdy(),a=i.dFdx(),h=i.dFdy(),c=e,l=r.cross(c),u=c.cross(o),d=l.mul(a.x).add(u.mul(h.x)),p=l.mul(a.y).add(u.mul(h.y)),m=d.dot(d).max(p.dot(p)),y=Sn.mul(m.inverseSqrt());return Zt(d.mul(s.x,y),p.mul(s.y,y),c.mul(s.z)).normalize()});class wl extends tt{constructor(t,e=null){super("vec3"),this.node=t,this.scaleNode=e,this.normalMapType=Ye}setup(t){const{normalMapType:e,scaleNode:s}=this;let i=this.node.mul(2).sub(1);s!==null&&(i=x(i.xy.mul(s),i.z));let o=null;return e===dd?o=Nc.mul(i).normalize():e===Ye&&(t.hasGeometryAttribute("tangent")===!0?o=Os.mul(i).normalize():o=uy({eye_pos:jt,surf_norm:Je,mapN:i,uv:be()})),o}}const dy=T(wl);M("normalMap",dy);A("NormalMapNode",wl);class Tl extends tt{constructor(t,e){super(),this.sourceNode=t,this.stepsNode=e}setup(){const{sourceNode:t,stepsNode:e}=this;return t.mul(e).floor().div(e)}}const py=T(Tl);M("posterize",py);A("PosterizeNode",Tl);const my=b(({color:n,exposure:t})=>n.mul(t).clamp()),fy=b(({color:n,exposure:t})=>(n=n.mul(t),n.div(n.add(1)).clamp())),gy=b(({color:n,exposure:t})=>{n=n.mul(t),n=n.sub(.004).max(0);const e=n.mul(n.mul(6.2).add(.5)),s=n.mul(n.mul(6.2).add(1.7)).add(.06);return e.div(s).pow(2.2)}),yy=b(({color:n})=>{const t=n.mul(n.add(.0245786)).sub(90537e-9),e=n.mul(n.add(.432951).mul(.983729)).add(.238081);return t.div(e)}),xy=b(({color:n,exposure:t})=>{const e=de(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),s=de(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(t).div(.6),n=e.mul(n),n=yy({color:n}),n=s.mul(n),n.clamp()}),Ny=de(x(1.6605,-.1246,-.0182),x(-.5876,1.1329,-.1006),x(-.0728,-.0083,1.1187)),My=de(x(.6274,.0691,.0164),x(.3293,.9195,.088),x(.0433,.0113,.8956)),wy=b(([n])=>{const t=x(n).toVar(),e=x(t.mul(t)).toVar(),s=x(e.mul(e)).toVar();return f(15.5).mul(s.mul(e)).sub(H(40.14,s.mul(t))).add(H(31.96,s).sub(H(6.868,e.mul(t))).add(H(.4298,e).add(H(.1191,t).sub(.00232))))}),Ty=b(({color:n,exposure:t})=>{const e=x(n).toVar(),s=de(x(.856627153315983,.137318972929847,.11189821299995),x(.0951212405381588,.761241990602591,.0767994186031903),x(.0482516061458583,.101439036467562,.811302368396859)),i=de(x(1.1271005818144368,-.1413297634984383,-.14132976349843826),x(-.11060664309660323,1.157823702216272,-.11060664309660294),x(-.016493938717834573,-.016493938717834257,1.2519364065950405)),o=f(-12.47393),r=f(4.026069);return e.mulAssign(t),e.assign(My.mul(e)),e.assign(s.mul(e)),e.assign(_t(e,1e-10)),e.assign(Fn(e)),e.assign(e.sub(o).div(r.sub(o))),e.assign(js(e,0,1)),e.assign(wy(e)),e.assign(i.mul(e)),e.assign(Ne(_t(x(0),e),x(2.2))),e.assign(Ny.mul(e)),e.assign(js(e,0,1)),e}),vy={[sd]:my,[id]:fy,[nd]:gy,[od]:xy,[rd]:Ty};class vl extends tt{constructor(t=yi,e=by,s=null){super("vec3"),this.toneMapping=t,this.exposureNode=e,this.colorNode=s}getCacheKey(){let t=super.getCacheKey();return t="{toneMapping:"+this.toneMapping+",nodes:"+t+"}",t}setup(t){const e=this.colorNode||t.context.color,s=this.toneMapping;if(s===yi)return e;const i={exposure:this.exposureNode,color:e},o=vy[s];let r=null;return o?r=o(i):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",s),r=e),r}}const Sy=(n,t,e)=>I(new vl(n,I(t),I(e))),by=Dg("toneMappingExposure","float");M("toneMapping",(n,t,e)=>Sy(t,e,n));A("ToneMappingNode",vl);let bo=null;class Sl extends Ci{constructor(t=vi,e=null){bo===null&&(bo=new Ah),super(t,e,bo)}updateReference(){return this}}const _y=T(Sl);M("viewportSharedTexture",_y);A("ViewportSharedTextureNode",Sl);const Ay=new W;class er extends ys{constructor(t,e){super(e),this.passNode=t,this.setUpdateMatrix(!1)}setup(t){return this.passNode.build(t),super.setup(t)}clone(){return new this.constructor(this.passNode,this.value)}}class Ei extends tt{constructor(t,e,s){super("vec4"),this.scope=t,this.scene=e,this.camera=s,this._pixelRatio=1,this._width=1,this._height=1;const i=new zn;i.isRenderTargetTexture=!0,i.name="PostProcessingDepth";const o=new ls(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:cd});o.texture.name="PostProcessing",o.depthTexture=i,this.renderTarget=o,this.updateBeforeType=st.FRAME,this._textureNode=I(new er(this,o.texture)),this._depthTextureNode=I(new er(this,i)),this._depthNode=null,this._viewZNode=null,this._cameraNear=j(0),this._cameraFar=j(0),this.isPassNode=!0}isGlobal(){return!0}getTextureNode(){return this._textureNode}getTextureDepthNode(){return this._depthTextureNode}getViewZNode(){if(this._viewZNode===null){const t=this._cameraNear,e=this._cameraFar;this._viewZNode=Hc(this._depthTextureNode,t,e)}return this._viewZNode}getDepthNode(){if(this._depthNode===null){const t=this._cameraNear,e=this._cameraFar;this._depthNode=Zo(this.getViewZNode(),t,e)}return this._depthNode}setup(){return this.scope===Ei.COLOR?this.getTextureNode():this.getDepthNode()}updateBefore(t){const{renderer:e}=t,{scene:s,camera:i}=this;this._pixelRatio=e.getPixelRatio();const o=e.getSize(Ay);this.setSize(o.width,o.height);const r=e.toneMapping,a=e.toneMappingNode,h=e.getRenderTarget();this._cameraNear.value=i.near,this._cameraFar.value=i.far,e.toneMapping=yi,e.toneMappingNode=null,e.setRenderTarget(this.renderTarget),e.render(s,i),e.toneMapping=r,e.toneMappingNode=a,e.setRenderTarget(h)}setSize(t,e){this._width=t,this._height=e;const s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget.setSize(s,i)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Ei.COLOR="color";Ei.DEPTH="depth";const Sr=(n,t)=>I(new er(n,t));A("PassNode",Ei);const _o=new vh(-1,1,1,-1,0,1);class zy extends An{constructor(t=!1){super();const e=t===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Lo([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Lo(e,2))}}const Ry=new zy;class kn extends Jd{constructor(t=null){super(Ry,t),this.camera=_o}renderAsync(t){return t.renderAsync(this,_o)}render(t){t.render(this,_o)}}const Ua=new kn,Ga=new kn;class Vy extends tt{constructor(t,e=2){super("vec4"),this.textureNode=t,this.sigma=e,this.directionNode=D(1),this._invSize=j(new W),this._passDirection=j(new W),this._horizontalRT=new ls,this._horizontalRT.texture.name="GaussianBlurNode.horizontal",this._verticalRT=new ls,this._verticalRT.texture.name="GaussianBlurNode.vertical",this._textureNode=Sr(this,this._verticalRT.texture),this.updateBeforeType=st.RENDER,this.resolution=new W(1,1)}setSize(t,e){t=Math.max(Math.round(t*this.resolution.x),1),e=Math.max(Math.round(e*this.resolution.y),1),this._invSize.value.set(1/t,1/e),this._horizontalRT.setSize(t,e),this._verticalRT.setSize(t,e)}updateBefore(t){const{renderer:e}=t,s=this.textureNode,i=s.value,o=e.getRenderTarget(),r=s.value;Ua.material=this._material,Ga.material=this._material,this.setSize(i.image.width,i.image.height);const a=i.type;this._horizontalRT.texture.type=a,this._verticalRT.texture.type=a,e.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),Ua.render(e),s.value=this._horizontalRT.texture,e.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),Ga.render(e),e.setRenderTarget(o),s.value=r}getTextureNode(){return this._textureNode}setup(t){const e=this.textureNode;if(e.isTextureNode!==!0)return console.error("GaussianBlurNode requires a TextureNode."),B();const s=e.uvNode||be(),i=h=>e.cache().context({getUV:()=>h,forceUVContext:!0}),o=b(()=>{const h=3+2*this.sigma,c=this._getCoefficients(h),l=this._invSize,u=D(this.directionNode).mul(this._passDirection),d=f(c[0]).toVar(),p=B(i(s).mul(d)).toVar();for(let m=1;m<h;m++){const y=f(m),w=f(c[m]),S=D(u.mul(l.mul(y))).toVar(),R=B(i(s.add(S))),z=B(i(s.sub(S)));p.addAssign(R.add(z).mul(w)),d.addAssign(H(2,w))}return p.div(d)}),r=this._material||(this._material=t.createNodeMaterial());r.fragmentNode=o();const a=t.getNodeProperties(this);return a.textureNode=e,this._textureNode}_getCoefficients(t){const e=[];for(let s=0;s<t;s++)e.push(.39894*Math.exp(-.5*s*s/(t*t))/t);return e}}const Cy=(n,t)=>I(new Vy(I(n),t));M("gaussianBlur",Cy);const Ao=new W,Wa=new kn;class Ey extends tt{constructor(t,e=.96){super(t),this.textureNode=t,this.textureNodeOld=$t(),this.damp=j(e),this._compRT=new ls,this._compRT.texture.name="AfterImageNode.comp",this._oldRT=new ls,this._oldRT.texture.name="AfterImageNode.old",this._textureNode=Sr(this,this._compRT.texture),this.updateBeforeType=st.RENDER}getTextureNode(){return this._textureNode}setSize(t,e){this._compRT.setSize(t,e),this._oldRT.setSize(t,e)}updateBefore(t){const{renderer:e}=t,s=this.textureNode,o=s.value.type;this._compRT.texture.type=o,this._oldRT.texture.type=o,e.getDrawingBufferSize(Ao),this.setSize(Ao.x,Ao.y);const r=e.toneMapping,a=e.toneMappingNode,h=e.getRenderTarget(),c=s.value;this.textureNodeOld.value=this._oldRT.texture,e.toneMapping=yi,e.toneMappingNode=null,e.setRenderTarget(this._compRT),Wa.render(e);const l=this._oldRT;this._oldRT=this._compRT,this._compRT=l,e.toneMapping=r,e.toneMappingNode=a,e.setRenderTarget(h),s.value=c}setup(t){const e=this.textureNode,s=this.textureNodeOld;if(e.isTextureNode!==!0)return console.error("AfterImageNode requires a TextureNode."),B();const i=e.uvNode||be();s.uvNode=i;const o=l=>e.cache().context({getUV:()=>l,forceUVContext:!0}),r=b(([l,u])=>{const d=f(u).toVar(),p=B(l).toVar();return _t(Nr(p.sub(d)),0)}),a=b(()=>{const l=B(s),u=B(o(i));return l.mulAssign(this.damp.mul(r(l,.1))),_t(u,l)}),h=this._materialComposed||(this._materialComposed=t.createNodeMaterial());h.fragmentNode=a(),Wa.material=h;const c=t.getNodeProperties(this);return c.textureNode=e,this._textureNode}}const Iy=(n,t)=>I(new Ey(I(n),t));M("afterImage",Iy);const qa=new kn;class Fy extends tt{constructor(t,e,s,i){super("vec4"),this.textureNode=t,this.tresholdNode=e,this.scaleNode=s,this.colorNode=x(.1,0,1),this.samples=i,this.resolution=new W(1,1),this._renderTarget=new ls,this._renderTarget.texture.name="anamorphic",this._invSize=j(new W),this._textureNode=Sr(this,this._renderTarget.texture),this.updateBeforeType=st.RENDER}getTextureNode(){return this._textureNode}setSize(t,e){this._invSize.value.set(1/t,1/e),t=Math.max(Math.round(t*this.resolution.x),1),e=Math.max(Math.round(e*this.resolution.y),1),this._renderTarget.setSize(t,e)}updateBefore(t){const{renderer:e}=t,s=this.textureNode,i=s.value;this._renderTarget.texture.type=i.type;const o=e.getRenderTarget(),r=s.value;qa.material=this._material,this.setSize(i.image.width,i.image.height),e.setRenderTarget(this._renderTarget),qa.render(e),e.setRenderTarget(o),s.value=r}setup(t){const e=this.textureNode;if(e.isTextureNode!==!0)return console.error("AnamorphNode requires a TextureNode."),B();const s=e.uvNode||be(),i=h=>e.cache().context({getUV:()=>h,forceUVContext:!0}),o=b(()=>{const h=this.samples,c=Math.floor(h/2),l=x(0).toVar();return Q({start:-c,end:c},({i:u})=>{const d=f(u).abs().div(c).oneMinus(),p=D(s.x.add(this._invSize.x.mul(u).mul(this.scaleNode)),s.y),m=i(p),y=Ml(m,this.tresholdNode).mul(d);l.addAssign(y)}),l.mul(this.colorNode)}),r=this._material||(this._material=t.createNodeMaterial());r.fragmentNode=o();const a=t.getNodeProperties(this);return a.textureNode=e,this._textureNode}}const Ly=(n,t=.9,e=3,s=32)=>I(new Fy(I(n),I(t),I(e),s));M("anamorphic",Ly);class bl extends tt{constructor(t=null,e={}){super(),this.functionNode=t,this.parameters=e}setParameters(t){return this.parameters=t,this}getParameters(){return this.parameters}getNodeType(t){return this.functionNode.getNodeType(t)}generate(t){const e=[],s=this.functionNode,i=s.getInputs(t),o=this.parameters;if(Array.isArray(o))for(let a=0;a<o.length;a++){const h=i[a],c=o[a];e.push(c.build(t,h.type))}else for(const a of i){const h=o[a.name];if(h!==void 0)e.push(h.build(t,a.type));else throw new Error(`FunctionCallNode: Input '${a.name}' not found in FunctionNode.`)}return`${s.build(t,"property")}( ${e.join(", ")} )`}}const Oy=(n,...t)=>(t=t.length>1||t[0]&&t[0].isNode===!0?Bs(t):En(t[0]),I(new bl(I(n),t)));M("call",Oy);A("FunctionCallNode",bl);class _l extends k{constructor(t=null){super(),this._value=t,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new ms,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(t){this._value!==t&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=t,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const t=this.value;if(t&&this._cache===null&&this.inputType==="URL"&&t.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([t.value]));else if(t&&t.value!==null&&t.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof t.value=="string"||this.inputType==="Number"&&typeof t.value=="number"||this.inputType==="Vector2"&&t.value.isVector2||this.inputType==="Vector3"&&t.value.isVector3||this.inputType==="Vector4"&&t.value.isVector4||this.inputType==="Color"&&t.value.isColor||this.inputType==="Matrix3"&&t.value.isMatrix3||this.inputType==="Matrix4"&&t.value.isMatrix4))return t.value;return this._cache||t}getNodeType(t){return this.value&&this.value.isNode?this.value.getNodeType(t):"float"}setup(){return this.value&&this.value.isNode?this.value:f()}serialize(t){super.serialize(t),this.value!==null?this.inputType==="ArrayBuffer"?t.value=Ih(this.value):t.value=this.value?this.value.toJSON(t.meta).uuid:null:t.value=null,t.inputType=this.inputType,t.outputType=this.outputType}deserialize(t){super.deserialize(t);let e=null;t.value!==null&&(t.inputType==="ArrayBuffer"?e=Fh(t.value):t.inputType==="Texture"?e=t.meta.textures[t.value]:e=t.meta.nodes[t.value]||null),this.value=e,this.inputType=t.inputType,this.outputType=t.outputType}}const dn=T(_l);M("scriptableValue",dn);A("ScriptableValueNode",_l);class Al extends Map{get(t,e=null,...s){if(this.has(t))return super.get(t);if(e!==null){const i=e(...s);return this.set(t,i),i}}}class Py{constructor(t){this.scriptableNode=t}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(t){return this.scriptableNode.getInputLayout(t)}get(t){const e=this.parameters[t];return e?e.getValue():null}}const zo=new Al;class zl extends k{constructor(t=null,e={}){super(),this.codeNode=t,this.parameters=e,this._local=new Al,this._output=dn(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(t,e){return this._local.set(t,e)}getLocal(t){return this._local.get(t)}onRefresh(){this._refresh()}getInputLayout(t){for(const e of this.getLayout())if(e.inputType&&(e.id===t||e.name===t))return e}getOutputLayout(t){for(const e of this.getLayout())if(e.outputType&&(e.id===t||e.name===t))return e}setOutput(t,e){const s=this._outputs;return s[t]===void 0?s[t]=dn(e):s[t].value=e,this}getOutput(t){return this._outputs[t]}getParameter(t){return this.parameters[t]}setParameter(t,e){const s=this.parameters;return e&&e.isScriptableNode?(this.deleteParameter(t),s[t]=e,s[t].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):e&&e.isScriptableValueNode?(this.deleteParameter(t),s[t]=e,s[t].events.addEventListener("refresh",this.onRefresh)):s[t]===void 0?(s[t]=dn(e),s[t].events.addEventListener("refresh",this.onRefresh)):s[t].value=e,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(t){let e=this.parameters[t];return e&&(e.isScriptableNode&&(e=e.getDefaultOutput()),e.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const t of Object.keys(this.parameters))this.deleteParameter(t);return this.needsUpdate=!0,this}call(t,...e){const i=this.getObject()[t];if(typeof i=="function")return i(...e)}async callAsync(t,...e){const i=this.getObject()[t];if(typeof i=="function")return i.constructor.name==="AsyncFunction"?await i(...e):i(...e)}getNodeType(t){return this.getDefaultOutputNode().getNodeType(t)}refresh(t=null){t!==null?this.getOutput(t).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const t=()=>this.refresh(),e=(c,l)=>this.setOutput(c,l),s=new Py(this),i=zo.get("THREE"),o=zo.get("TSL"),r=this.getMethod(this.codeNode),a=[s,this._local,zo,t,e,i,o];this._object=r(...a);const h=this._object.layout;if(h&&(h.cache===!1&&this._local.clear(),this._output.outputType=h.outputType||null,Array.isArray(h.elements)))for(const c of h.elements){const l=c.id||c.name;c.inputType&&(this.getParameter(l)===void 0&&this.setParameter(l,null),this.getParameter(l).inputType=c.inputType),c.outputType&&(this.getOutput(l)===void 0&&this.setOutput(l,null),this.getOutput(l).outputType=c.outputType)}return this._object}deserialize(t){super.deserialize(t);for(const e in this.parameters){let s=this.parameters[e];s.isScriptableNode&&(s=s.getDefaultOutput()),s.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const t=this.getDefaultOutput().value;return t&&t.isNode?t:f()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const t=["parameters","local","global","refresh","setOutput","THREE","TSL"],s=["layout","init","main","dispose"].join(", "),i="var "+s+`; var output = {};
`,o=`
return { ...output, `+s+" };",r=i+this.codeNode.code+o;return this._method=new Function(...t,r),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}set needsUpdate(t){t===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const By=T(zl);M("scriptable",By);A("ScriptableNode",zl);class Un extends k{constructor(t,e){super("float"),this.isFogNode=!0,this.colorNode=t,this.factorNode=e}getViewZNode(t){let e;const s=t.context.getViewZ;return s!==void 0&&(e=s(this)),(e||jt.z).negate()}setup(){return this.factorNode}}const Dy=T(Un);M("fog",Dy);A("FogNode",Un);class Rl extends Un{constructor(t,e,s){super(t),this.isFogRangeNode=!0,this.nearNode=e,this.farNode=s}setup(t){const e=this.getViewZNode(t);return we(this.nearNode,this.farNode,e)}}const ky=T(Rl);M("rangeFog",ky);A("FogRangeNode",Rl);class Vl extends Un{constructor(t,e){super(t),this.isFogExp2Node=!0,this.densityNode=e}setup(t){const e=this.getViewZNode(t),s=this.densityNode;return s.mul(s,e,e).negate().exp().oneMinus()}}const Uy=T(Vl);M("densityFog",Uy);A("FogExp2Node",Vl);let ns=null,os=null;class Cl extends k{constructor(t=f(),e=f()){super(),this.minNode=t,this.maxNode=e}getVectorLength(t){const e=t.getTypeLength(He(this.minNode.value)),s=t.getTypeLength(He(this.maxNode.value));return e>s?e:s}getNodeType(t){return t.object.isInstancedMesh===!0?t.getTypeFromLength(this.getVectorLength(t)):"float"}setup(t){const e=t.object;let s=null;if(e.isInstancedMesh===!0){const i=this.minNode.value,o=this.maxNode.value,r=t.getTypeLength(He(i)),a=t.getTypeLength(He(o));ns=ns||new xt,os=os||new xt,ns.setScalar(0),os.setScalar(0),r===1?ns.setScalar(i):i.isColor?ns.set(i.r,i.g,i.b):ns.set(i.x,i.y,i.z||0,i.w||0),a===1?os.setScalar(o):o.isColor?os.set(o.r,o.g,o.b):os.set(o.x,o.y,o.z||0,o.w||0);const h=4,c=h*e.count,l=new Float32Array(c);for(let d=0;d<c;d++){const p=d%h,m=ns.getComponent(p),y=os.getComponent(p);l[d]=gh.lerp(m,y,Math.random())}const u=this.getNodeType(t);s=Mr(l,"vec4",e.count).element(Hh).convert(u)}else s=f(0);return s}}T(Cl);A("RangeNode",Cl);class El extends k{constructor(t,e,s=[64]){super("void"),this.isComputeNode=!0,this.computeNode=t,this.count=e,this.workgroupSize=s,this.dispatchCount=0,this.version=1,this.updateBeforeType=st.OBJECT,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}updateDispatchCount(){const{count:t,workgroupSize:e}=this;let s=e[0];for(let i=1;i<e.length;i++)s*=e[i];this.dispatchCount=Math.ceil(t/s)}onInit(){}updateBefore({renderer:t}){t.compute(this)}generate(t){const{shaderStage:e}=t;if(e==="compute"){const s=this.computeNode.build(t,"void");s!==""&&t.addLineFlowCode(s)}}}const Gy=(n,t,e)=>I(new El(I(n),t,e));M("compute",Gy);A("ComputeNode",El);class ps extends k{constructor(t=ps.TARGET_DIRECTION,e=null){super(),this.scope=t,this.light=e}setup(){const{scope:t,light:e}=this;let s=null;return t===ps.TARGET_DIRECTION&&(s=Ks.transformDirection(qo(e).sub(qo(e.target)))),s}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}ps.TARGET_DIRECTION="targetDirection";const Il=T(ps,ps.TARGET_DIRECTION);A("LightNode",ps);const Fl=b(n=>{const{lightDistance:t,cutoffDistance:e,decayExponent:s}=n,i=t.pow(s).max(.01).reciprocal();return e.greaterThan(0).cond(i.mul(t.div(e).pow4().oneMinus().clamp().pow2()),i)});class Ll extends xs{constructor(t=null){super(t),this.cutoffDistanceNode=j(0),this.decayExponentNode=j(0)}update(t){const{light:e}=this;super.update(t),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}setup(t){const{colorNode:e,cutoffDistanceNode:s,decayExponentNode:i,light:o}=this,r=t.context.lightingModel,a=xc(o).sub(jt),h=a.normalize(),c=a.length(),l=Fl({lightDistance:c,cutoffDistance:s,decayExponent:i}),u=e.mul(l),d=t.context.reflectedLight;r.direct({lightDirection:h,lightColor:u,reflectedLight:d,shadowMask:this.shadowMaskNode},t.stack,t)}}A("PointLightNode",Ll);ti(fp,Ll);class Ol extends xs{constructor(t=null){super(t)}setup(t){super.setup(t);const e=t.context.lightingModel,s=this.colorNode,i=Il(this.light),o=t.context.reflectedLight;e.direct({lightDirection:i,lightColor:s,reflectedLight:o,shadowMask:this.shadowMaskNode},t.stack,t)}}A("DirectionalLightNode",Ol);ti(yp,Ol);class br extends xs{constructor(t=null){super(t),this.coneCosNode=j(0),this.penumbraCosNode=j(0),this.cutoffDistanceNode=j(0),this.decayExponentNode=j(0)}update(t){super.update(t);const{light:e}=this;this.coneCosNode.value=Math.cos(e.angle),this.penumbraCosNode.value=Math.cos(e.angle*(1-e.penumbra)),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}getSpotAttenuation(t){const{coneCosNode:e,penumbraCosNode:s}=this;return we(e,s,t)}setup(t){super.setup(t);const e=t.context.lightingModel,{colorNode:s,cutoffDistanceNode:i,decayExponentNode:o,light:r}=this,a=xc(r).sub(jt),h=a.normalize(),c=h.dot(Il(r)),l=this.getSpotAttenuation(c),u=a.length(),d=Fl({lightDistance:u,cutoffDistance:i,decayExponent:o}),p=s.mul(l).mul(d),m=t.context.reflectedLight;e.direct({lightDirection:h,lightColor:p,reflectedLight:m,shadowMask:this.shadowMaskNode},t.stack,t)}}A("SpotLightNode",br);ti(Vh,br);class Wy extends Vh{constructor(t,e,s,i,o,r){super(t,e,s,i,o,r),this.iesMap=null}copy(t,e){return super.copy(t,e),this.iesMap=t.iesMap,this}}class Pl extends br{getSpotAttenuation(t){const e=this.light.iesMap;let s=null;if(e&&e.isTexture===!0){const i=t.acos().mul(1/Math.PI);s=$t(e,D(i,0),0).r}else s=super.getSpotAttenuation(t);return s}}A("IESSpotLightNode",Pl);ti(Wy,Pl);class Bl extends xs{constructor(t=null){super(t)}setup({context:t}){t.irradiance.addAssign(this.colorNode)}}A("AmbientLightNode",Bl);ti(xp,Bl);class Dl extends xs{constructor(t=null){super(t),this.lightPositionNode=qo(t),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=j(new it)}update(t){const{light:e}=this;super.update(t),this.lightPositionNode.object3d=e,this.groundColorNode.value.copy(e.groundColor).multiplyScalar(e.intensity)}setup(t){const{colorNode:e,groundColorNode:s,lightDirectionNode:i}=this,r=Je.dot(i).mul(.5).add(.5),a=Mt(s,e,r);t.context.irradiance.addAssign(a)}}A("HemisphereLightNode",Dl);ti(dp,Dl);const qy=b(n=>{const t=n.uv.mul(2),e=t.x.floor(),s=t.y.floor();return e.add(s).mod(2).sign()});class kl extends tt{constructor(t=be()){super("float"),this.uvNode=t}setup(){return qy({uv:this.uvNode})}}const Hy=T(kl);M("checker",Hy);A("CheckerNode",kl);const jy=new _h;class Xy extends Lt{constructor(t={}){super(),this.normals=!1,this.lights=!1,this.useAlphaToCoverage=!0,this.useColor=t.vertexColors,this.pointWidth=1,this.pointColorNode=null,this.setDefaultValues(jy),this.setupShaders(),this.setValues(t)}setupShaders(){const t=this.alphaToCoverage,e=this.useColor;this.vertexNode=b(()=>{gt(D(),"vUv").assign(be());const s=bt("instancePosition"),i=at("vec4","mvPos");i.assign(ds.mul(B(s,1)));const o=Ws.z.div(Ws.w),r=ge.mul(i),a=at("vec2","offset");return a.assign(Bt.xy),a.assign(a.mul(Gf)),a.assign(a.div(Ws.z)),a.y.assign(a.y.mul(o)),a.assign(a.mul(r.w)),r.assign(r.add(B(a,0,0))),r})(),this.fragmentNode=b(()=>{const s=gt(D(),"vUv"),i=at("float","alpha");i.assign(1);const o=s.x,r=s.y,a=o.mul(o).add(r.mul(r));if(t){const c=at("float","dlen");c.assign(a.fwidth()),i.assign(we(c.oneMinus(),c.add(1),a).oneMinus())}else a.greaterThan(1).discard();let h;return this.pointColorNode?h=this.pointColorNode:e?h=bt("instanceColor").mul(Ti):h=Ti,B(h,i)})(),this.needsUpdate=!0}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(t){this.useAlphaToCoverage!==t&&(this.useAlphaToCoverage=t,this.setupShaders())}}St("InstancedPointsNodeMaterial",Xy);const $y=new bh;class Yy extends Lt{constructor(t){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues($y),this.setValues(t)}}St("LineBasicNodeMaterial",Yy);const Zy=new Rh;class Jy extends Lt{constructor(t){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(Zy),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(t)}setupVariants(){const t=this.offsetNode,e=this.dashScaleNode?f(this.dashScaleNode):Ho,s=this.dashSizeNode?f(this.dashSizeNode):Tc,i=this.dashSizeNode?f(this.dashGapNode):vc;Us.assign(s),Mn.assign(i);const o=gt(bt("lineDistance").mul(e));(t?o.add(t):o).mod(Us.add(Mn)).greaterThan(Us).discard()}}St("LineDashedNodeMaterial",Jy);const Qy=new Rh;class Ky extends Lt{constructor(t={}){super(),this.normals=!1,this.lights=!1,this.setDefaultValues(Qy),this.useAlphaToCoverage=!0,this.useColor=t.vertexColors,this.useDash=t.dashed,this.useWorldUnits=!1,this.dashOffset=0,this.lineWidth=1,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(t)}setup(t){this.setupShaders(),super.setup(t)}setupShaders(){const t=this.alphaToCoverage,e=this.useColor,s=this.dashed,i=this.worldUnits,o=b(({start:a,end:h})=>{const c=ge.element(2).element(2),d=ge.element(3).element(2).mul(-.5).div(c).sub(a.z).div(h.z.sub(a.z));return B(Mt(a.xyz,h.xyz,d),h.w)});this.vertexNode=b(()=>{fe("vec2","vUv").assign(be());const a=bt("instanceStart"),h=bt("instanceEnd"),c=at("vec4","start"),l=at("vec4","end");c.assign(ds.mul(B(a,1))),l.assign(ds.mul(B(h,1))),i&&(fe("vec3","worldStart").assign(c.xyz),fe("vec3","worldEnd").assign(l.xyz));const u=Ws.z.div(Ws.w),d=ge.element(2).element(3).equal(-1);G(d,()=>{G(c.z.lessThan(0).and(l.z.greaterThan(0)),()=>{l.assign(o({start:c,end:l}))}).elseif(l.z.lessThan(0).and(c.z.greaterThanEqual(0)),()=>{c.assign(o({start:l,end:c}))})});const p=ge.mul(c),m=ge.mul(l),y=p.xyz.div(p.w),w=m.xyz.div(m.w),S=w.xy.sub(y.xy).temp();S.x.assign(S.x.mul(u)),S.assign(S.normalize());const R=gn(B());if(i){const z=l.xyz.sub(c.xyz).normalize(),C=Mt(c.xyz,l.xyz,.5).normalize(),O=z.cross(C).normalize(),P=z.cross(O),F=fe("vec4","worldPos");F.assign(Bt.y.lessThan(.5).cond(c,l));const L=fo.mul(.5);F.addAssign(B(Bt.x.lessThan(0).cond(O.mul(L),O.mul(L).negate()),0)),s||(F.addAssign(B(Bt.y.lessThan(.5).cond(z.mul(L).negate(),z.mul(L)),0)),F.addAssign(B(P.mul(L),0)),G(Bt.y.greaterThan(1).or(Bt.y.lessThan(0)),()=>{F.subAssign(B(P.mul(2).mul(L),0))})),R.assign(ge.mul(F));const K=gn(x());K.assign(Bt.y.lessThan(.5).cond(y,w)),R.z.assign(K.z.mul(R.w))}else{const z=at("vec2","offset");z.assign(D(S.y,S.x.negate())),S.x.assign(S.x.div(u)),z.x.assign(z.x.div(u)),z.assign(Bt.x.lessThan(0).cond(z.negate(),z)),G(Bt.y.lessThan(0),()=>{z.assign(z.sub(S))}).elseif(Bt.y.greaterThan(1),()=>{z.assign(z.add(S))}),z.assign(z.mul(fo)),z.assign(z.div(Ws.w)),R.assign(Bt.y.lessThan(.5).cond(p,m)),z.assign(z.mul(R.w)),R.assign(R.add(B(z,0,0)))}return R})();const r=b(({p1:a,p2:h,p3:c,p4:l})=>{const u=a.sub(c),d=l.sub(c),p=h.sub(a),m=u.dot(d),y=d.dot(p),w=u.dot(p),S=d.dot(d),z=p.dot(p).mul(S).sub(y.mul(y)),O=m.mul(y).sub(w.mul(S)).div(z).clamp(),P=m.add(y.mul(O)).div(S).clamp();return D(O,P)});this.fragmentNode=b(()=>{const a=fe("vec2","vUv");if(s){const l=this.offsetNode?f(this.offsetNodeNode):ba,u=this.dashScaleNode?f(this.dashScaleNode):Ho,d=this.dashSizeNode?f(this.dashSizeNode):Tc,p=this.dashSizeNode?f(this.dashGapNode):vc;Us.assign(d),Mn.assign(p);const m=bt("instanceDistanceStart"),y=bt("instanceDistanceEnd"),w=Bt.y.lessThan(.5).cond(u.mul(m),Ho.mul(y)),S=gt(w.add(ba)),R=l?S.add(l):S;a.y.lessThan(-1).or(a.y.greaterThan(1)).discard(),R.mod(Us.add(Mn)).greaterThan(Us).discard()}const h=at("float","alpha");if(h.assign(1),i){const l=fe("vec3","worldStart"),u=fe("vec3","worldEnd"),d=fe("vec4","worldPos").xyz.normalize().mul(1e5),p=u.sub(l),m=r({p1:l,p2:u,p3:x(0,0,0),p4:d}),y=l.add(p.mul(m.x)),w=d.mul(m.y),z=y.sub(w).length().div(fo);if(!s)if(t){const C=z.fwidth();h.assign(we(C.negate().add(.5),C.add(.5),z).oneMinus())}else z.greaterThan(.5).discard()}else if(t){const l=a.x,u=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1)),d=l.mul(l).add(u.mul(u)),p=at("float","dlen");p.assign(d.fwidth()),G(a.y.abs().greaterThan(1),()=>{h.assign(we(p.oneMinus(),p.add(1),d).oneMinus())})}else G(a.y.abs().greaterThan(1),()=>{const l=a.x,u=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1));l.mul(l).add(u.mul(u)).greaterThan(1).discard()});let c;if(this.lineColorNode)c=this.lineColorNode;else if(e){const l=bt("instanceColorStart"),u=bt("instanceColorEnd");c=Bt.y.lessThan(.5).cond(l,u).mul(Ti)}else c=Ti;return B(c,h)})()}get worldUnits(){return this.useWorldUnits}set worldUnits(t){this.useWorldUnits!==t&&(this.useWorldUnits=t,this.needsUpdate=!0)}get dashed(){return this.useDash}set dashed(t){this.useDash!==t&&(this.useDash=t,this.needsUpdate=!0)}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(t){this.useAlphaToCoverage!==t&&(this.useAlphaToCoverage=t,this.needsUpdate=!0)}}St("Line2NodeMaterial",Ky);const t0=new cp;class e0 extends Lt{constructor(t){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(t0),this.setValues(t)}setupDiffuseColor(){const t=this.opacityNode?f(this.opacityNode):wc;et.assign(B(nl(ut),t))}}St("MeshNormalNodeMaterial",e0);const s0=new Mh;class i0 extends Lt{constructor(t){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(s0),this.setValues(t)}}St("MeshBasicNodeMaterial",i0);const Si=b(({f0:n,f90:t,dotVH:e})=>{const s=e.mul(-5.55473).sub(6.98316).mul(e).exp2();return n.mul(s.oneMinus()).add(t.mul(s))}),Xs=b(n=>n.diffuseColor.mul(1/Math.PI)),n0=()=>f(.25),o0=b(({dotNH:n})=>ko.mul(f(.5)).add(1).mul(f(1/Math.PI)).mul(n.pow(ko))),r0=b(({lightDirection:n})=>{const t=n.add(ht).normalize(),e=ut.dot(t).clamp(),s=ht.dot(t).clamp(),i=Si({f0:oe,f90:1,dotVH:s}),o=n0(),r=o0({dotNH:e});return i.mul(o).mul(r)});class Ul extends In{constructor(t=!0){super(),this.specular=t}direct({lightDirection:t,lightColor:e,reflectedLight:s}){const o=ut.dot(t).clamp().mul(e);s.directDiffuse.addAssign(o.mul(Xs({diffuseColor:et.rgb}))),this.specular===!0&&s.directSpecular.addAssign(o.mul(r0({lightDirection:t})).mul(vf))}indirectDiffuse({irradiance:t,reflectedLight:e}){e.indirectDiffuse.addAssign(t.mul(Xs({diffuseColor:et})))}}const a0=new lp;class h0 extends Lt{constructor(t){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(a0),this.setValues(t)}setupLightingModel(){return new Ul(!1)}}St("MeshLambertNodeMaterial",h0);const c0=new ap;class l0 extends Lt{constructor(t){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(c0),this.setValues(t)}setupLightingModel(){return new Ul}setupVariants(){const t=(this.shininessNode?f(this.shininessNode):Nf).max(1e-4);ko.assign(t);const e=this.specularNode||wf;oe.assign(e)}copy(t){return this.shininessNode=t.shininessNode,this.specularNode=t.specularNode,super.copy(t)}}St("MeshPhongNodeMaterial",l0);const u0=b(()=>{const n=wn.dFdx().abs().max(wn.dFdy().abs());return n.x.max(n.y).max(n.z)}),Gl=b(n=>{const{roughness:t}=n,e=u0();let s=t.max(.0525);return s=s.add(e),s=s.min(1),s}),d0=b(({alpha:n,dotNL:t,dotNV:e})=>{const s=n.pow2(),i=t.mul(s.add(s.oneMinus().mul(e.pow2())).sqrt()),o=e.mul(s.add(s.oneMinus().mul(t.pow2())).sqrt());return Ze(.5,i.add(o).max(sc))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),p0=b(({alphaT:n,alphaB:t,dotTV:e,dotBV:s,dotTL:i,dotBL:o,dotNV:r,dotNL:a})=>{const h=a.mul(x(n.mul(e),t.mul(s),r).length()),c=r.mul(x(n.mul(i),t.mul(o),a).length());return Ze(.5,h.add(c)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),m0=b(({alpha:n,dotNH:t})=>{const e=n.pow2(),s=t.pow2().mul(e.oneMinus()).oneMinus();return e.div(s.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),f0=f(1/Math.PI),g0=b(({alphaT:n,alphaB:t,dotNH:e,dotTH:s,dotBH:i})=>{const o=n.mul(t),r=x(t.mul(s),n.mul(i),o.mul(e)),a=r.dot(r),h=o.div(a);return f0.mul(o.mul(h.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),Ha=b(n=>{const{lightDirection:t,f0:e,f90:s,roughness:i,f:o,USE_IRIDESCENCE:r,USE_ANISOTROPY:a}=n,h=n.normalView||ut,c=i.pow2(),l=t.add(ht).normalize(),u=h.dot(t).clamp(),d=h.dot(ht).clamp(),p=h.dot(l).clamp(),m=ht.dot(l).clamp();let y=Si({f0:e,f90:s,dotVH:m}),w,S;if(Na(r)&&(y=fr.mix(y,o)),Na(a)){const R=ln.dot(t),z=ln.dot(ht),C=ln.dot(l),O=ks.dot(t),P=ks.dot(ht),F=ks.dot(l);w=p0({alphaT:Do,alphaB:c,dotTV:z,dotBV:P,dotTL:R,dotBL:O,dotNV:d,dotNL:u}),S=g0({alphaT:Do,alphaB:c,dotNH:p,dotTH:C,dotBH:F})}else w=d0({alpha:c,dotNL:u,dotNV:d}),S=m0({alpha:c,dotNH:p});return y.mul(w).mul(S)}),Wl=b(({roughness:n,dotNV:t})=>{const e=B(-1,-.0275,-.572,.022),s=B(1,.0425,1.04,-.04),i=n.mul(e).add(s),o=i.x.mul(i.x).min(t.mul(-9.28).exp2()).mul(i.x).add(i.y);return D(-1.04,1.04).mul(o).add(i.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),ql=b(n=>{const{dotNV:t,specularColor:e,specularF90:s,roughness:i}=n,o=Wl({dotNV:t,roughness:i});return e.mul(o.x).add(s.mul(o.y))}),y0=b(({f:n,f90:t,dotVH:e})=>{const s=e.oneMinus().saturate(),i=s.mul(s),o=s.mul(i,i).clamp(0,.9999);return n.sub(x(t).mul(o)).div(o.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),x0=b(({roughness:n,dotNH:t})=>{const e=n.pow2(),s=f(1).div(e),o=t.pow2().oneMinus().max(.0078125);return f(2).add(s).mul(o.pow(s.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),N0=b(({dotNV:n,dotNL:t})=>f(1).div(f(4).mul(t.add(n).sub(t.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),M0=b(({lightDirection:n})=>{const t=n.add(ht).normalize(),e=ut.dot(n).clamp(),s=ut.dot(ht).clamp(),i=ut.dot(t).clamp(),o=x0({roughness:mr,dotNH:i}),r=N0({dotNV:s,dotNL:e});return Fs.mul(o).mul(r)}),ja=b(([n,t,e,s,i])=>{const o=x(lc(t.negate(),Mi(n),Ze(1,s))),r=x(Gs(i[0].xyz),Gs(i[1].xyz),Gs(i[2].xyz));return Mi(o).mul(e.mul(r))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),w0=b(([n,t])=>n.mul(js(t.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),T0=Gc(),Xa=b(([n,t,e])=>{const s=T0.uv(n),i=Fn(f(Yo.x)).mul(w0(t,e));return s.bicubic(i)}),$a=b(([n,t,e])=>(G(e.notEqual(0),()=>{const s=oc(t).negate().div(e);return nc(s.negate().mul(n))}),x(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),v0=b(([n,t,e,s,i,o,r,a,h,c,l,u,d,p,m])=>{let y,w;if(m){y=B().toVar(),w=x().toVar();const O=l.sub(1).mul(m.mul(.025)),P=x(l.sub(O),l,l.add(O));Q({start:0,end:3},({i:F})=>{const L=P.element(F),K=ja(n,t,u,L,a),rt=r.add(K),lt=c.mul(h.mul(B(rt,1))),Ot=D(lt.xy.div(lt.w)).toVar();Ot.addAssign(1),Ot.divAssign(2),Ot.assign(D(Ot.x,Ot.y.oneMinus()));const yt=Xa(Ot,e,L);y.element(F).assign(yt.element(F)),y.a.addAssign(yt.a),w.element(F).assign(s.element(F).mul($a(Gs(K),d,p).element(F)))}),y.a.divAssign(3)}else{const O=ja(n,t,u,l,a),P=r.add(O),F=c.mul(h.mul(B(P,1))),L=D(F.xy.div(F.w)).toVar();L.addAssign(1),L.divAssign(2),L.assign(D(L.x,L.y.oneMinus())),y=Xa(L,e,l),w=s.mul($a(Gs(O),d,p))}const S=w.rgb.mul(y.rgb),R=n.dot(t).clamp(),z=x(ql({dotNV:R,specularColor:i,specularF90:o,roughness:e})),C=w.r.add(w.g,w.b).div(3);return B(z.oneMinus().mul(S),y.a.oneMinus().mul(C).oneMinus())}),S0=de(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),b0=n=>{const t=n.sqrt();return x(1).add(t).div(x(1).sub(t))},Ya=(n,t)=>n.sub(t).div(n.add(t)).pow2(),_0=(n,t)=>{const e=n.mul(2*Math.PI*1e-9),s=x(54856e-17,44201e-17,52481e-17),i=x(1681e3,1795300,2208400),o=x(43278e5,93046e5,66121e5),r=f(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(e.mul(2239900).add(t.x).cos()).mul(e.pow2().mul(-45282e5).exp());let a=s.mul(o.mul(2*Math.PI).sqrt()).mul(i.mul(e).add(t).cos()).mul(e.pow2().negate().mul(o).exp());return a=x(a.x.add(r),a.y,a.z).div(10685e-11),S0.mul(a)},A0=b(({outsideIOR:n,eta2:t,cosTheta1:e,thinFilmThickness:s,baseF0:i})=>{const o=Mt(n,t,we(0,.03,s)),r=n.div(o).pow2().mul(f(1).sub(e.pow2())),h=f(1).sub(r).sqrt(),c=Ya(o,n),l=Si({f0:c,f90:1,dotVH:e}),u=l.oneMinus(),d=o.lessThan(n).cond(Math.PI,0),p=f(Math.PI).sub(d),m=b0(i.clamp(0,.9999)),y=Ya(m,o.toVec3()),w=Si({f0:y,f90:1,dotVH:h}),S=x(m.x.lessThan(o).cond(Math.PI,0),m.y.lessThan(o).cond(Math.PI,0),m.z.lessThan(o).cond(Math.PI,0)),R=o.mul(s,h,2),z=x(p).add(S),C=l.mul(w).clamp(1e-5,.9999),O=C.sqrt(),P=u.pow2().mul(w).div(x(1).sub(C));let L=l.add(P),K=P.sub(u);for(let rt=1;rt<=2;++rt){K=K.mul(O);const lt=_0(f(rt).mul(R),f(rt).mul(z)).mul(2);L=L.add(K.mul(lt))}return L.max(x(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),z0=b(({normal:n,viewDir:t,roughness:e})=>{const s=n.dot(t).saturate(),i=e.pow2(),o=Xt(e.lessThan(.25),f(-339.2).mul(i).add(f(161.4).mul(e)).sub(25.9),f(-8.48).mul(i).add(f(14.3).mul(e)).sub(9.95)),r=Xt(e.lessThan(.25),f(44).mul(i).sub(f(23.7).mul(e)).add(3.26),f(1.97).mul(i).sub(f(3.27).mul(e)).add(.72));return Xt(e.lessThan(.25),0,f(.1).mul(e).sub(.025)).add(o.mul(s).add(r).exp()).mul(1/Math.PI).saturate()}),Ro=x(.04),Vo=f(1);class _r extends In{constructor(t=!1,e=!1,s=!1,i=!1,o=!1,r=!1){super(),this.clearcoat=t,this.sheen=e,this.iridescence=s,this.anisotropy=i,this.transmission=o,this.dispersion=r,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(t){if(this.clearcoat===!0&&(this.clearcoatRadiance=x().temp("clearcoatRadiance"),this.clearcoatSpecularDirect=x().temp("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=x().temp("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=x().temp("sheenSpecularDirect"),this.sheenSpecularIndirect=x().temp("sheenSpecularIndirect")),this.iridescence===!0){const e=ut.dot(ht).clamp();this.iridescenceFresnel=A0({outsideIOR:f(1),eta2:Xh,cosTheta1:e,thinFilmThickness:$h,baseF0:oe}),this.iridescenceF0=y0({f:this.iridescenceFresnel,f90:1,dotVH:e})}if(this.transmission===!0){const e=jo,s=yc.sub(jo).normalize(),i=Mc;t.backdrop=v0(i,s,je,et,oe,Nn,e,wi,Ks,ge,un,Yh,Jh,Zh,this.dispersion?Qh:null),t.backdropAlpha=Uo,et.a.mulAssign(Mt(1,t.backdrop.a,Uo))}}computeMultiscattering(t,e,s){const i=ut.dot(ht).clamp(),o=Wl({roughness:je,dotNV:i}),a=(this.iridescenceF0?fr.mix(oe,this.iridescenceF0):oe).mul(o.x).add(s.mul(o.y)),c=o.x.add(o.y).oneMinus(),l=oe.add(oe.oneMinus().mul(.047619)),u=a.mul(l).div(c.mul(l).oneMinus());t.addAssign(a),e.addAssign(u.mul(c))}direct({lightDirection:t,lightColor:e,reflectedLight:s}){const o=ut.dot(t).clamp().mul(e);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(o.mul(M0({lightDirection:t}))),this.clearcoat===!0){const a=Ls.dot(t).clamp().mul(e);this.clearcoatSpecularDirect.addAssign(a.mul(Ha({lightDirection:t,f0:Ro,f90:Vo,roughness:xn,normalView:Ls})))}s.directDiffuse.addAssign(o.mul(Xs({diffuseColor:et.rgb}))),s.directSpecular.addAssign(o.mul(Ha({lightDirection:t,f0:oe,f90:1,roughness:je,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}indirectDiffuse({irradiance:t,reflectedLight:e}){e.indirectDiffuse.addAssign(t.mul(Xs({diffuseColor:et})))}indirectSpecular({radiance:t,iblIrradiance:e,reflectedLight:s}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(e.mul(Fs,z0({normal:ut,viewDir:ht,roughness:mr}))),this.clearcoat===!0){const c=Ls.dot(ht).clamp(),l=ql({dotNV:c,specularColor:Ro,specularF90:Vo,roughness:xn});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(l))}const i=x().temp("singleScattering"),o=x().temp("multiScattering"),r=e.mul(1/Math.PI);this.computeMultiscattering(i,o,Nn);const a=i.add(o),h=et.mul(a.r.max(a.g).max(a.b).oneMinus());s.indirectSpecular.addAssign(t.mul(i)),s.indirectSpecular.addAssign(o.mul(r)),s.indirectDiffuse.addAssign(h.mul(r))}ambientOcclusion({ambientOcclusion:t,reflectedLight:e}){const i=ut.dot(ht).clamp().add(t),o=je.mul(-16).oneMinus().negate().exp2(),r=t.sub(i.pow(o).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),e.indirectDiffuse.mulAssign(t),e.indirectSpecular.mulAssign(r)}finish(t){const{outgoingLight:e}=t;if(this.clearcoat===!0){const s=Ls.dot(ht).clamp(),i=Si({dotVH:s,f0:Ro,f90:Vo}),o=e.mul(Bo.mul(i).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Bo));e.assign(o)}if(this.sheen===!0){const s=Fs.r.max(Fs.g).max(Fs.b).mul(.157).oneMinus(),i=e.mul(s).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);e.assign(i)}}}const R0=new zh;class Hl extends Lt{constructor(t){super(),this.isMeshStandardNodeMaterial=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(R0),this.setValues(t)}setupLightingModel(){return new _r}setupSpecular(){const t=Mt(x(.04),et.rgb,yn);oe.assign(t),Nn.assign(1)}setupVariants(){const t=this.metalnessNode?f(this.metalnessNode):bf;yn.assign(t);let e=this.roughnessNode?f(this.roughnessNode):Sf;e=Gl({roughness:e}),je.assign(e),this.setupSpecular(),et.assign(B(et.rgb.mul(t.oneMinus()),et.a))}copy(t){return this.emissiveNode=t.emissiveNode,this.metalnessNode=t.metalnessNode,this.roughnessNode=t.roughnessNode,super.copy(t)}}St("MeshStandardNodeMaterial",Hl);const V0=new rp;class jl extends Hl{constructor(t){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(V0),this.setValues(t)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const t=this.iorNode?f(this.iorNode):Df;un.assign(t),oe.assign(Mt(ae(cc(un.sub(1).div(un.add(1))).mul(Tf),x(1)).mul(Sa),et.rgb,yn)),Nn.assign(Mt(Sa,1,yn))}setupLightingModel(){return new _r(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(t){if(super.setupVariants(t),this.useClearcoat){const e=this.clearcoatNode?f(this.clearcoatNode):Af,s=this.clearcoatRoughnessNode?f(this.clearcoatRoughnessNode):zf;Bo.assign(e),xn.assign(Gl({roughness:s}))}if(this.useSheen){const e=this.sheenNode?x(this.sheenNode):Cf,s=this.sheenRoughnessNode?f(this.sheenRoughnessNode):Ef;Fs.assign(e),mr.assign(s)}if(this.useIridescence){const e=this.iridescenceNode?f(this.iridescenceNode):Ff,s=this.iridescenceIORNode?f(this.iridescenceIORNode):Lf,i=this.iridescenceThicknessNode?f(this.iridescenceThicknessNode):Of;fr.assign(e),Xh.assign(s),$h.assign(i)}if(this.useAnisotropy){const e=(this.anisotropyNode?D(this.anisotropyNode):If).toVar();as.assign(e.length()),G(as.equal(0),()=>{e.assign(D(1,0))}).else(()=>{e.divAssign(as),as.assign(as.saturate())}),Do.assign(as.pow2().mix(je.pow2(),1)),ln.assign(Os[0].mul(e.x).add(Os[1].mul(e.y))),ks.assign(Os[1].mul(e.x).sub(Os[0].mul(e.y)))}if(this.useTransmission){const e=this.transmissionNode?f(this.transmissionNode):Pf,s=this.thicknessNode?f(this.thicknessNode):Bf,i=this.attenuationDistanceNode?f(this.attenuationDistanceNode):kf,o=this.attenuationColorNode?x(this.attenuationColorNode):Uf;if(Uo.assign(e),Yh.assign(s),Zh.assign(i),Jh.assign(o),this.useDispersion){const r=this.dispersionNode?f(this.dispersionNode):Wf;Qh.assign(r)}}}setupNormal(t){super.setupNormal(t);const e=this.clearcoatNormalNode?x(this.clearcoatNormalNode):Rf;Ls.assign(e)}copy(t){return this.clearcoatNode=t.clearcoatNode,this.clearcoatRoughnessNode=t.clearcoatRoughnessNode,this.clearcoatNormalNode=t.clearcoatNormalNode,this.sheenNode=t.sheenNode,this.sheenRoughnessNode=t.sheenRoughnessNode,this.iridescenceNode=t.iridescenceNode,this.iridescenceIORNode=t.iridescenceIORNode,this.iridescenceThicknessNode=t.iridescenceThicknessNode,this.specularIntensityNode=t.specularIntensityNode,this.specularColorNode=t.specularColorNode,this.transmissionNode=t.transmissionNode,this.thicknessNode=t.thicknessNode,this.attenuationDistanceNode=t.attenuationDistanceNode,this.attenuationColorNode=t.attenuationColorNode,this.dispersionNode=t.dispersionNode,this.anisotropyNode=t.anisotropyNode,super.copy(t)}}St("MeshPhysicalNodeMaterial",jl);class C0 extends _r{constructor(t,e,s,i){super(t,e,s),this.useSSS=i}direct({lightDirection:t,lightColor:e,reflectedLight:s},i,o){if(this.useSSS===!0){const r=o.material,{thicknessColorNode:a,thicknessDistortionNode:h,thicknessAmbientNode:c,thicknessAttenuationNode:l,thicknessPowerNode:u,thicknessScaleNode:d}=r,p=t.add(ut.mul(h)).normalize(),m=f(ht.dot(p.negate()).saturate().pow(u).mul(d)),y=x(m.add(c).mul(a));s.directDiffuse.addAssign(y.mul(l.mul(e)))}super.direct({lightDirection:t,lightColor:e,reflectedLight:s},i,o)}}class E0 extends jl{constructor(t){super(t),this.thicknessColorNode=null,this.thicknessDistortionNode=f(.1),this.thicknessAmbientNode=f(0),this.thicknessAttenuationNode=f(.1),this.thicknessPowerNode=f(2),this.thicknessScaleNode=f(10)}get useSSS(){return this.thicknessColorNode!==null}setupLightingModel(){return new C0(this.useClearcoat,this.useSheen,this.useIridescence,this.useSSS)}copy(t){return this.thicknessColorNode=t.thicknessColorNode,this.thicknessDistortionNode=t.thicknessDistortionNode,this.thicknessAmbientNode=t.thicknessAmbientNode,this.thicknessAttenuationNode=t.thicknessAttenuationNode,this.thicknessPowerNode=t.thicknessPowerNode,this.thicknessScaleNode=t.thicknessScaleNode,super.copy(t)}}St("MeshSSSNodeMaterial",E0);const I0=b(({normal:n,lightDirection:t,builder:e})=>{const s=n.dot(t),i=D(s.mul(.5).add(.5),0);if(e.material.gradientMap){const o=Fe("gradientMap","texture").context({getUV:()=>i});return x(o.r)}else{const o=i.fwidth().mul(.5);return Mt(x(.7),x(1),we(f(.7).sub(o.x),f(.7).add(o.x),i.x))}});class F0 extends In{direct({lightDirection:t,lightColor:e,reflectedLight:s},i,o){const r=I0({normal:wn,lightDirection:t,builder:o}).mul(e);s.directDiffuse.addAssign(r.mul(Xs({diffuseColor:et.rgb})))}indirectDiffuse({irradiance:t,reflectedLight:e}){e.indirectDiffuse.addAssign(t.mul(Xs({diffuseColor:et})))}}const L0=new hp;class O0 extends Lt{constructor(t){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(L0),this.setValues(t)}setupLightingModel(){return new F0}}St("MeshToonNodeMaterial",O0);const P0=new up;class B0 extends Lt{constructor(t){super(),this.isMeshMatcapNodeMaterial=!0,this.lights=!1,this.setDefaultValues(P0),this.setValues(t)}setupVariants(t){const e=Rg;let s;t.material.matcap?s=Fe("matcap","texture").context({getUV:()=>e}):s=x(Mt(.2,.8,e.y)),et.rgb.mulAssign(s.rgb)}}St("MeshMatcapNodeMaterial",B0);const D0=new _h;class k0 extends Lt{constructor(t){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.normals=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(D0),this.setValues(t)}copy(t){return this.sizeNode=t.sizeNode,super.copy(t)}}St("PointsNodeMaterial",k0);const U0=new ip;class G0 extends Lt{constructor(t){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this.normals=!1,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(U0),this.setValues(t)}setupPosition({object:t,context:e}){const{positionNode:s,rotationNode:i,scaleNode:o}=this,r=zt;let a=ds.mul(x(s||0)),h=D(wi[0].xyz.length(),wi[1].xyz.length());o!==null&&(h=h.mul(o));let c=r.xy;t.center&&t.center.isVector2===!0&&(c=c.sub(j(t.center).sub(.5))),c=c.mul(h);const l=f(i||Vf),u=c.rotate(l);a=B(a.xy.add(u),a.zw);const d=ge.mul(a);return e.vertex=r,d}copy(t){return this.positionNode=t.positionNode,this.rotationNode=t.rotationNode,this.scaleNode=t.scaleNode,super.copy(t)}}St("SpriteNodeMaterial",G0);class W0 extends In{constructor(){super(),this.shadowNode=f(1).toVar("shadowMask")}direct({shadowMask:t}){this.shadowNode.mulAssign(t)}finish(t){et.a.mulAssign(this.shadowNode.oneMinus()),t.outgoingLight.rgb.assign(et.rgb)}}const q0=new op;class H0 extends Lt{constructor(t){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(q0),this.setValues(t)}setupLightingModel(){return new W0}}St("ShadowNodeMaterial",H0);class j0 extends Lt{constructor(t={}){super(),this.normals=!1,this.lights=!1,this.isVolumeNodeMaterial=!0,this.testNode=null,this.setValues(t)}setup(t){const e=Hg(this.map,null,0),s=b(({orig:i,dir:o})=>{const r=x(-.5),a=x(.5),h=o.reciprocal(),c=r.sub(i).mul(h),l=a.sub(i).mul(h),u=ae(c,l),d=_t(c,l),p=_t(u.x,_t(u.y,u.z)),m=ae(d.x,ae(d.y,d.z));return D(p,m)});this.fragmentNode=b(()=>{const i=gt(x(gf.mul(B(yc,1)))),r=gt(Bt.sub(i)).normalize(),a=at("vec2","bounds").assign(s({orig:i,dir:r}));a.x.greaterThan(a.y).discard(),a.assign(D(_t(a.x,0),a.y));const h=at("vec3","p").assign(i.add(a.x.mul(r))),c=at("vec3","inc").assign(x(r.abs().reciprocal())),l=at("float","delta").assign(ae(c.x,ae(c.y,c.z)));l.divAssign(Fe("steps","float"));const u=at("vec4","ac").assign(B(Fe("base","color"),0));return Q({type:"float",start:a.x,end:a.y,update:"+= delta"},()=>{const d=at("float","d").assign(e.uv(h.add(.5)).r);this.testNode!==null?this.testNode({map:e,mapValue:d,probe:h,finalColor:u}).append():(u.a.assign(1),Ec()),h.addAssign(r.mul(l))}),u.a.equal(0).discard(),B(u)})(),super.setup(t)}}St("VolumeNodeMaterial",j0);const qs=b(([n,t,e])=>{const s=f(e).toVar(),i=f(t).toVar(),o=us(n).toVar();return Xt(o,i,s)}),bi=b(([n,t])=>{const e=us(t).toVar(),s=f(n).toVar();return Xt(e,s.negate(),s)}),ct=b(([n])=>{const t=f(n).toVar();return g(Zs(t))}),nt=b(([n,t])=>{const e=f(n).toVar();return t.assign(ct(e)),e.sub(f(t))}),Xl=b(([n,t,e,s,i,o])=>{const r=f(o).toVar(),a=f(i).toVar(),h=f(s).toVar(),c=f(e).toVar(),l=f(t).toVar(),u=f(n).toVar(),d=f(dt(1,a)).toVar();return dt(1,r).mul(u.mul(d).add(l.mul(a))).add(r.mul(c.mul(d).add(h.mul(a))))}),$l=b(([n,t,e,s,i,o])=>{const r=f(o).toVar(),a=f(i).toVar(),h=x(s).toVar(),c=x(e).toVar(),l=x(t).toVar(),u=x(n).toVar(),d=f(dt(1,a)).toVar();return dt(1,r).mul(u.mul(d).add(l.mul(a))).add(r.mul(c.mul(d).add(h.mul(a))))}),Yl=te([Xl,$l]),Zl=b(([n,t,e,s,i,o,r,a,h,c,l])=>{const u=f(l).toVar(),d=f(c).toVar(),p=f(h).toVar(),m=f(a).toVar(),y=f(r).toVar(),w=f(o).toVar(),S=f(i).toVar(),R=f(s).toVar(),z=f(e).toVar(),C=f(t).toVar(),O=f(n).toVar(),P=f(dt(1,p)).toVar(),F=f(dt(1,d)).toVar();return f(dt(1,u)).toVar().mul(F.mul(O.mul(P).add(C.mul(p))).add(d.mul(z.mul(P).add(R.mul(p))))).add(u.mul(F.mul(S.mul(P).add(w.mul(p))).add(d.mul(y.mul(P).add(m.mul(p))))))}),Jl=b(([n,t,e,s,i,o,r,a,h,c,l])=>{const u=f(l).toVar(),d=f(c).toVar(),p=f(h).toVar(),m=x(a).toVar(),y=x(r).toVar(),w=x(o).toVar(),S=x(i).toVar(),R=x(s).toVar(),z=x(e).toVar(),C=x(t).toVar(),O=x(n).toVar(),P=f(dt(1,p)).toVar(),F=f(dt(1,d)).toVar();return f(dt(1,u)).toVar().mul(F.mul(O.mul(P).add(C.mul(p))).add(d.mul(z.mul(P).add(R.mul(p))))).add(u.mul(F.mul(S.mul(P).add(w.mul(p))).add(d.mul(y.mul(P).add(m.mul(p))))))}),Ql=te([Zl,Jl]),Kl=b(([n,t,e])=>{const s=f(e).toVar(),i=f(t).toVar(),o=E(n).toVar(),r=E(o.bitAnd(E(7))).toVar(),a=f(qs(r.lessThan(E(4)),i,s)).toVar(),h=f(H(2,qs(r.lessThan(E(4)),s,i))).toVar();return bi(a,us(r.bitAnd(E(1)))).add(bi(h,us(r.bitAnd(E(2)))))}),tu=b(([n,t,e,s])=>{const i=f(s).toVar(),o=f(e).toVar(),r=f(t).toVar(),a=E(n).toVar(),h=E(a.bitAnd(E(15))).toVar(),c=f(qs(h.lessThan(E(8)),r,o)).toVar(),l=f(qs(h.lessThan(E(4)),o,qs(h.equal(E(12)).or(h.equal(E(14))),r,i))).toVar();return bi(c,us(h.bitAnd(E(1)))).add(bi(l,us(h.bitAnd(E(2)))))}),Tt=te([Kl,tu]),eu=b(([n,t,e])=>{const s=f(e).toVar(),i=f(t).toVar(),o=Ri(n).toVar();return x(Tt(o.x,i,s),Tt(o.y,i,s),Tt(o.z,i,s))}),su=b(([n,t,e,s])=>{const i=f(s).toVar(),o=f(e).toVar(),r=f(t).toVar(),a=Ri(n).toVar();return x(Tt(a.x,r,o,i),Tt(a.y,r,o,i),Tt(a.z,r,o,i))}),Qt=te([eu,su]),iu=b(([n])=>{const t=f(n).toVar();return H(.6616,t)}),nu=b(([n])=>{const t=f(n).toVar();return H(.982,t)}),ou=b(([n])=>{const t=x(n).toVar();return H(.6616,t)}),ru=te([iu,ou]),au=b(([n])=>{const t=x(n).toVar();return H(.982,t)}),hu=te([nu,au]),Dt=b(([n,t])=>{const e=g(t).toVar(),s=E(n).toVar();return s.shiftLeft(e).bitOr(s.shiftRight(g(32).sub(e)))}),cu=b(([n,t,e])=>{n.subAssign(e),n.bitXorAssign(Dt(e,g(4))),e.addAssign(t),t.subAssign(n),t.bitXorAssign(Dt(n,g(6))),n.addAssign(e),e.subAssign(t),e.bitXorAssign(Dt(t,g(8))),t.addAssign(n),n.subAssign(e),n.bitXorAssign(Dt(e,g(16))),e.addAssign(t),t.subAssign(n),t.bitXorAssign(Dt(n,g(19))),n.addAssign(e),e.subAssign(t),e.bitXorAssign(Dt(t,g(4))),t.addAssign(n)}),ei=b(([n,t,e])=>{const s=E(e).toVar(),i=E(t).toVar(),o=E(n).toVar();return s.bitXorAssign(i),s.subAssign(Dt(i,g(14))),o.bitXorAssign(s),o.subAssign(Dt(s,g(11))),i.bitXorAssign(o),i.subAssign(Dt(o,g(25))),s.bitXorAssign(i),s.subAssign(Dt(i,g(16))),o.bitXorAssign(s),o.subAssign(Dt(s,g(4))),i.bitXorAssign(o),i.subAssign(Dt(o,g(14))),s.bitXorAssign(i),s.subAssign(Dt(i,g(24))),s}),Rt=b(([n])=>{const t=E(n).toVar();return f(t).div(f(E(g(4294967295))))}),ue=b(([n])=>{const t=f(n).toVar();return t.mul(t.mul(t.mul(t.mul(t.mul(6).sub(15)).add(10))))}),lu=b(([n])=>{const t=g(n).toVar(),e=E(E(1)).toVar(),s=E(E(g(3735928559)).add(e.shiftLeft(E(2)).add(E(13)))).toVar();return ei(s.add(E(t)),s,s)}),uu=b(([n,t])=>{const e=g(t).toVar(),s=g(n).toVar(),i=E(E(2)).toVar(),o=E().toVar(),r=E().toVar(),a=E().toVar();return o.assign(r.assign(a.assign(E(g(3735928559)).add(i.shiftLeft(E(2)).add(E(13)))))),o.addAssign(E(s)),r.addAssign(E(e)),ei(o,r,a)}),du=b(([n,t,e])=>{const s=g(e).toVar(),i=g(t).toVar(),o=g(n).toVar(),r=E(E(3)).toVar(),a=E().toVar(),h=E().toVar(),c=E().toVar();return a.assign(h.assign(c.assign(E(g(3735928559)).add(r.shiftLeft(E(2)).add(E(13)))))),a.addAssign(E(o)),h.addAssign(E(i)),c.addAssign(E(s)),ei(a,h,c)}),pu=b(([n,t,e,s])=>{const i=g(s).toVar(),o=g(e).toVar(),r=g(t).toVar(),a=g(n).toVar(),h=E(E(4)).toVar(),c=E().toVar(),l=E().toVar(),u=E().toVar();return c.assign(l.assign(u.assign(E(g(3735928559)).add(h.shiftLeft(E(2)).add(E(13)))))),c.addAssign(E(a)),l.addAssign(E(r)),u.addAssign(E(o)),cu(c,l,u),c.addAssign(E(i)),ei(c,l,u)}),mu=b(([n,t,e,s,i])=>{const o=g(i).toVar(),r=g(s).toVar(),a=g(e).toVar(),h=g(t).toVar(),c=g(n).toVar(),l=E(E(5)).toVar(),u=E().toVar(),d=E().toVar(),p=E().toVar();return u.assign(d.assign(p.assign(E(g(3735928559)).add(l.shiftLeft(E(2)).add(E(13)))))),u.addAssign(E(c)),d.addAssign(E(h)),p.addAssign(E(a)),cu(u,d,p),u.addAssign(E(r)),d.addAssign(E(o)),ei(u,d,p)}),Y=te([lu,uu,du,pu,mu]),fu=b(([n,t])=>{const e=g(t).toVar(),s=g(n).toVar(),i=E(Y(s,e)).toVar(),o=Ri().toVar();return o.x.assign(i.bitAnd(g(255))),o.y.assign(i.shiftRight(g(8)).bitAnd(g(255))),o.z.assign(i.shiftRight(g(16)).bitAnd(g(255))),o}),gu=b(([n,t,e])=>{const s=g(e).toVar(),i=g(t).toVar(),o=g(n).toVar(),r=E(Y(o,i,s)).toVar(),a=Ri().toVar();return a.x.assign(r.bitAnd(g(255))),a.y.assign(r.shiftRight(g(8)).bitAnd(g(255))),a.z.assign(r.shiftRight(g(16)).bitAnd(g(255))),a}),Kt=te([fu,gu]),yu=b(([n])=>{const t=D(n).toVar(),e=g().toVar(),s=g().toVar(),i=f(nt(t.x,e)).toVar(),o=f(nt(t.y,s)).toVar(),r=f(ue(i)).toVar(),a=f(ue(o)).toVar(),h=f(Yl(Tt(Y(e,s),i,o),Tt(Y(e.add(g(1)),s),i.sub(1),o),Tt(Y(e,s.add(g(1))),i,o.sub(1)),Tt(Y(e.add(g(1)),s.add(g(1))),i.sub(1),o.sub(1)),r,a)).toVar();return ru(h)}),xu=b(([n])=>{const t=x(n).toVar(),e=g().toVar(),s=g().toVar(),i=g().toVar(),o=f(nt(t.x,e)).toVar(),r=f(nt(t.y,s)).toVar(),a=f(nt(t.z,i)).toVar(),h=f(ue(o)).toVar(),c=f(ue(r)).toVar(),l=f(ue(a)).toVar(),u=f(Ql(Tt(Y(e,s,i),o,r,a),Tt(Y(e.add(g(1)),s,i),o.sub(1),r,a),Tt(Y(e,s.add(g(1)),i),o,r.sub(1),a),Tt(Y(e.add(g(1)),s.add(g(1)),i),o.sub(1),r.sub(1),a),Tt(Y(e,s,i.add(g(1))),o,r,a.sub(1)),Tt(Y(e.add(g(1)),s,i.add(g(1))),o.sub(1),r,a.sub(1)),Tt(Y(e,s.add(g(1)),i.add(g(1))),o,r.sub(1),a.sub(1)),Tt(Y(e.add(g(1)),s.add(g(1)),i.add(g(1))),o.sub(1),r.sub(1),a.sub(1)),h,c,l)).toVar();return hu(u)}),X0=te([yu,xu]),Nu=b(([n])=>{const t=D(n).toVar(),e=g().toVar(),s=g().toVar(),i=f(nt(t.x,e)).toVar(),o=f(nt(t.y,s)).toVar(),r=f(ue(i)).toVar(),a=f(ue(o)).toVar(),h=x(Yl(Qt(Kt(e,s),i,o),Qt(Kt(e.add(g(1)),s),i.sub(1),o),Qt(Kt(e,s.add(g(1))),i,o.sub(1)),Qt(Kt(e.add(g(1)),s.add(g(1))),i.sub(1),o.sub(1)),r,a)).toVar();return ru(h)}),Mu=b(([n])=>{const t=x(n).toVar(),e=g().toVar(),s=g().toVar(),i=g().toVar(),o=f(nt(t.x,e)).toVar(),r=f(nt(t.y,s)).toVar(),a=f(nt(t.z,i)).toVar(),h=f(ue(o)).toVar(),c=f(ue(r)).toVar(),l=f(ue(a)).toVar(),u=x(Ql(Qt(Kt(e,s,i),o,r,a),Qt(Kt(e.add(g(1)),s,i),o.sub(1),r,a),Qt(Kt(e,s.add(g(1)),i),o,r.sub(1),a),Qt(Kt(e.add(g(1)),s.add(g(1)),i),o.sub(1),r.sub(1),a),Qt(Kt(e,s,i.add(g(1))),o,r,a.sub(1)),Qt(Kt(e.add(g(1)),s,i.add(g(1))),o.sub(1),r,a.sub(1)),Qt(Kt(e,s.add(g(1)),i.add(g(1))),o,r.sub(1),a.sub(1)),Qt(Kt(e.add(g(1)),s.add(g(1)),i.add(g(1))),o.sub(1),r.sub(1),a.sub(1)),h,c,l)).toVar();return hu(u)}),$0=te([Nu,Mu]),Y0=b(([n])=>{const t=f(n).toVar(),e=g(ct(t)).toVar();return Rt(Y(e))}),Z0=b(([n])=>{const t=D(n).toVar(),e=g(ct(t.x)).toVar(),s=g(ct(t.y)).toVar();return Rt(Y(e,s))}),J0=b(([n])=>{const t=x(n).toVar(),e=g(ct(t.x)).toVar(),s=g(ct(t.y)).toVar(),i=g(ct(t.z)).toVar();return Rt(Y(e,s,i))}),Q0=b(([n])=>{const t=B(n).toVar(),e=g(ct(t.x)).toVar(),s=g(ct(t.y)).toVar(),i=g(ct(t.z)).toVar(),o=g(ct(t.w)).toVar();return Rt(Y(e,s,i,o))}),wu=b(([n])=>{const t=f(n).toVar(),e=g(ct(t)).toVar();return x(Rt(Y(e,g(0))),Rt(Y(e,g(1))),Rt(Y(e,g(2))))}),Tu=b(([n])=>{const t=D(n).toVar(),e=g(ct(t.x)).toVar(),s=g(ct(t.y)).toVar();return x(Rt(Y(e,s,g(0))),Rt(Y(e,s,g(1))),Rt(Y(e,s,g(2))))}),vu=b(([n])=>{const t=x(n).toVar(),e=g(ct(t.x)).toVar(),s=g(ct(t.y)).toVar(),i=g(ct(t.z)).toVar();return x(Rt(Y(e,s,i,g(0))),Rt(Y(e,s,i,g(1))),Rt(Y(e,s,i,g(2))))}),Su=b(([n])=>{const t=B(n).toVar(),e=g(ct(t.x)).toVar(),s=g(ct(t.y)).toVar(),i=g(ct(t.z)).toVar(),o=g(ct(t.w)).toVar();return x(Rt(Y(e,s,i,o,g(0))),Rt(Y(e,s,i,o,g(1))),Rt(Y(e,s,i,o,g(2))))}),bu=te([wu,Tu,vu,Su]),bn=b(([n,t,e,s])=>{const i=f(s).toVar(),o=f(e).toVar(),r=g(t).toVar(),a=x(n).toVar(),h=f(0).toVar(),c=f(1).toVar();return Q({start:g(0),end:r},({i:l})=>{h.addAssign(c.mul(X0(a))),c.mulAssign(i),a.mulAssign(o)}),h}),_u=b(([n,t,e,s])=>{const i=f(s).toVar(),o=f(e).toVar(),r=g(t).toVar(),a=x(n).toVar(),h=x(0).toVar(),c=f(1).toVar();return Q({start:g(0),end:r},({i:l})=>{h.addAssign(c.mul($0(a))),c.mulAssign(i),a.mulAssign(o)}),h}),K0=b(([n,t,e,s])=>{const i=f(s).toVar(),o=f(e).toVar(),r=g(t).toVar(),a=x(n).toVar();return D(bn(a,r,o,i),bn(a.add(x(g(19),g(193),g(17))),r,o,i))}),tx=b(([n,t,e,s])=>{const i=f(s).toVar(),o=f(e).toVar(),r=g(t).toVar(),a=x(n).toVar(),h=x(_u(a,r,o,i)).toVar(),c=f(bn(a.add(x(g(19),g(193),g(17))),r,o,i)).toVar();return B(h,c)}),Au=b(([n,t,e,s,i,o,r])=>{const a=g(r).toVar(),h=f(o).toVar(),c=g(i).toVar(),l=g(s).toVar(),u=g(e).toVar(),d=g(t).toVar(),p=D(n).toVar(),m=x(bu(D(d.add(l),u.add(c)))).toVar(),y=D(m.x,m.y).toVar();y.subAssign(.5),y.mulAssign(h),y.addAssign(.5);const w=D(D(f(d),f(u)).add(y)).toVar(),S=D(w.sub(p)).toVar();return G(a.equal(g(2)),()=>mt(S.x).add(mt(S.y))),G(a.equal(g(3)),()=>_t(mt(S.x),mt(S.y))),Js(S,S)}),zu=b(([n,t,e,s,i,o,r,a,h])=>{const c=g(h).toVar(),l=f(a).toVar(),u=g(r).toVar(),d=g(o).toVar(),p=g(i).toVar(),m=g(s).toVar(),y=g(e).toVar(),w=g(t).toVar(),S=x(n).toVar(),R=x(bu(x(w.add(p),y.add(d),m.add(u)))).toVar();R.subAssign(.5),R.mulAssign(l),R.addAssign(.5);const z=x(x(f(w),f(y),f(m)).add(R)).toVar(),C=x(z.sub(S)).toVar();return G(c.equal(g(2)),()=>mt(C.x).add(mt(C.y).add(mt(C.z)))),G(c.equal(g(3)),()=>_t(_t(mt(C.x),mt(C.y)),mt(C.z))),Js(C,C)}),si=te([Au,zu]),ex=b(([n,t,e])=>{const s=g(e).toVar(),i=f(t).toVar(),o=D(n).toVar(),r=g().toVar(),a=g().toVar(),h=D(nt(o.x,r),nt(o.y,a)).toVar(),c=f(1e6).toVar();return Q({start:-1,end:g(1),name:"x",condition:"<="},({x:l})=>{Q({start:-1,end:g(1),name:"y",condition:"<="},({y:u})=>{const d=f(si(h,l,u,r,a,i,s)).toVar();c.assign(ae(c,d))})}),G(s.equal(g(0)),()=>{c.assign(gs(c))}),c}),sx=b(([n,t,e])=>{const s=g(e).toVar(),i=f(t).toVar(),o=D(n).toVar(),r=g().toVar(),a=g().toVar(),h=D(nt(o.x,r),nt(o.y,a)).toVar(),c=D(1e6,1e6).toVar();return Q({start:-1,end:g(1),name:"x",condition:"<="},({x:l})=>{Q({start:-1,end:g(1),name:"y",condition:"<="},({y:u})=>{const d=f(si(h,l,u,r,a,i,s)).toVar();G(d.lessThan(c.x),()=>{c.y.assign(c.x),c.x.assign(d)}).elseif(d.lessThan(c.y),()=>{c.y.assign(d)})})}),G(s.equal(g(0)),()=>{c.assign(gs(c))}),c}),ix=b(([n,t,e])=>{const s=g(e).toVar(),i=f(t).toVar(),o=D(n).toVar(),r=g().toVar(),a=g().toVar(),h=D(nt(o.x,r),nt(o.y,a)).toVar(),c=x(1e6,1e6,1e6).toVar();return Q({start:-1,end:g(1),name:"x",condition:"<="},({x:l})=>{Q({start:-1,end:g(1),name:"y",condition:"<="},({y:u})=>{const d=f(si(h,l,u,r,a,i,s)).toVar();G(d.lessThan(c.x),()=>{c.z.assign(c.y),c.y.assign(c.x),c.x.assign(d)}).elseif(d.lessThan(c.y),()=>{c.z.assign(c.y),c.y.assign(d)}).elseif(d.lessThan(c.z),()=>{c.z.assign(d)})})}),G(s.equal(g(0)),()=>{c.assign(gs(c))}),c}),nx=b(([n,t,e])=>{const s=g(e).toVar(),i=f(t).toVar(),o=x(n).toVar(),r=g().toVar(),a=g().toVar(),h=g().toVar(),c=x(nt(o.x,r),nt(o.y,a),nt(o.z,h)).toVar(),l=f(1e6).toVar();return Q({start:-1,end:g(1),name:"x",condition:"<="},({x:u})=>{Q({start:-1,end:g(1),name:"y",condition:"<="},({y:d})=>{Q({start:-1,end:g(1),name:"z",condition:"<="},({z:p})=>{const m=f(si(c,u,d,p,r,a,h,i,s)).toVar();l.assign(ae(l,m))})})}),G(s.equal(g(0)),()=>{l.assign(gs(l))}),l}),ox=b(([n,t,e])=>{const s=g(e).toVar(),i=f(t).toVar(),o=x(n).toVar(),r=g().toVar(),a=g().toVar(),h=g().toVar(),c=x(nt(o.x,r),nt(o.y,a),nt(o.z,h)).toVar(),l=D(1e6,1e6).toVar();return Q({start:-1,end:g(1),name:"x",condition:"<="},({x:u})=>{Q({start:-1,end:g(1),name:"y",condition:"<="},({y:d})=>{Q({start:-1,end:g(1),name:"z",condition:"<="},({z:p})=>{const m=f(si(c,u,d,p,r,a,h,i,s)).toVar();G(m.lessThan(l.x),()=>{l.y.assign(l.x),l.x.assign(m)}).elseif(m.lessThan(l.y),()=>{l.y.assign(m)})})})}),G(s.equal(g(0)),()=>{l.assign(gs(l))}),l}),rx=b(([n,t,e])=>{const s=g(e).toVar(),i=f(t).toVar(),o=x(n).toVar(),r=g().toVar(),a=g().toVar(),h=g().toVar(),c=x(nt(o.x,r),nt(o.y,a),nt(o.z,h)).toVar(),l=x(1e6,1e6,1e6).toVar();return Q({start:-1,end:g(1),name:"x",condition:"<="},({x:u})=>{Q({start:-1,end:g(1),name:"y",condition:"<="},({y:d})=>{Q({start:-1,end:g(1),name:"z",condition:"<="},({z:p})=>{const m=f(si(c,u,d,p,r,a,h,i,s)).toVar();G(m.lessThan(l.x),()=>{l.z.assign(l.y),l.y.assign(l.x),l.x.assign(m)}).elseif(m.lessThan(l.y),()=>{l.z.assign(l.y),l.y.assign(m)}).elseif(m.lessThan(l.z),()=>{l.z.assign(m)})})})}),G(s.equal(g(0)),()=>{l.assign(gs(l))}),l});qs.setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]});bi.setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]});ct.setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]});Xl.setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]});$l.setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]});Zl.setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});Jl.setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});Kl.setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]});tu.setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});eu.setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]});su.setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});iu.setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]});nu.setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]});ou.setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});au.setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});Dt.setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]});ei.setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]});Rt.setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]});ue.setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]});lu.setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]});uu.setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});du.setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});pu.setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]});mu.setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]});fu.setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});gu.setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});yu.setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]});xu.setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]});Nu.setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]});Mu.setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]});Y0.setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]});Z0.setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]});J0.setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]});Q0.setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]});wu.setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]});Tu.setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]});vu.setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]});Su.setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]});bn.setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});_u.setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});K0.setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});tx.setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Au.setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});zu.setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});ex.setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});sx.setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});ix.setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});nx.setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});ox.setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});rx.setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});const ax=b(([n])=>{const t=x(n).toVar(),e=f(t.x).toVar(),s=f(t.y).toVar(),i=f(t.z).toVar();G(s.lessThan(1e-4),()=>x(i,i,i)).else(()=>{e.assign(H(6,e.sub(Zs(e))));const o=g(ac(e)).toVar(),r=f(e.sub(f(o))).toVar(),a=f(i.mul(dt(1,s))).toVar(),h=f(i.mul(dt(1,s.mul(r)))).toVar(),c=f(i.mul(dt(1,s.mul(dt(1,r))))).toVar();return G(o.equal(g(0)),()=>x(i,c,a)).elseif(o.equal(g(1)),()=>x(h,i,a)).elseif(o.equal(g(2)),()=>x(a,i,c)).elseif(o.equal(g(3)),()=>x(a,h,i)).elseif(o.equal(g(4)),()=>x(c,a,i)),x(i,a,h)})}),hx=b(([n])=>{const t=x(n).toVar(),e=f(t.x).toVar(),s=f(t.y).toVar(),i=f(t.z).toVar(),o=f(ae(e,ae(s,i))).toVar(),r=f(_t(e,_t(s,i))).toVar(),a=f(r.sub(o)).toVar(),h=f().toVar(),c=f().toVar(),l=f().toVar();return l.assign(r),G(r.greaterThan(0),()=>{c.assign(a.div(r))}).else(()=>{c.assign(0)}),G(c.lessThanEqual(0),()=>{h.assign(0)}).else(()=>{G(e.greaterThanEqual(r),()=>{h.assign(s.sub(i).div(a))}).elseif(s.greaterThanEqual(r),()=>{h.assign(Zt(2,i.sub(e).div(a)))}).else(()=>{h.assign(Zt(4,e.sub(s).div(a)))}),h.mulAssign(1/6),G(h.lessThan(0),()=>{h.addAssign(1)})}),x(h,c,l)});ax.setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]});hx.setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]});const cx=b(([n])=>{const t=x(n).toVar(),e=Dh(ec(t,x(.04045))).toVar(),s=x(t.div(12.92)).toVar(),i=x(Ne(_t(t.add(x(.055)),x(0)).div(1.055),x(2.4))).toVar();return Mt(s,i,e)});cx.setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]});const he={mouse:{clientX:-1,clientY:-1,gridX:-1,gridY:-1,isDown:!1},tickRate:60},q={config:{},proxy:{},drawArray:[],window:{gridWidth:0,gridHeight:0},cellSize:0,initialized:!1,drawBuffer:[],decayCounter:0,alertIssued:!1};function Ru(n){return n===null||typeof n!="object"?n:new Proxy(n,{get(t,e,s){const i=Reflect.get(t,e,s);return typeof i=="object"?Ru(i):i},set(t,e,s){throw new Error("Cannot modify read-only object.")},deleteProperty(t,e){throw new Error("Cannot delete property of read-only object.")}})}function Za(n){he.mouse.isDown=!he.mouse.isDown}function Ja(n,t,e){return Math.min(Math.max(n,t),e)}function lx(n,t){const e=[],{gridWidth:s,gridHeight:i}=q.window,o=Math.max(n.x-t,0),r=Math.min(n.x+t,s-1),a=Math.max(n.y-t,0),h=Math.min(n.y+t,i-1);for(let c=a;c<=h;c++)for(let l=o;l<=r;l++){const u=l-n.x,d=c-n.y;Math.sqrt(u*u+d*d)<=t&&e.push({x:l,y:c})}return e}function Qa(n){if(he.mouse.isDown){const t=Ja(he.mouse.gridX,0,q.window.gridWidth-1),e=Ja(he.mouse.gridY,0,q.window.gridHeight-1),s=q.config.input.brushSize,i=lx({x:t,y:e},s);for(const{x:o,y:r}of i)q.drawBuffer.push({x:o,y:r})}}function ux(n){const t=window.innerWidth,e=window.innerHeight,s=t/q.config.core.grid.cellSize,i=e/q.config.core.grid.cellSize,o=Math.floor(n.clientX/t*s),r=Math.floor(i-n.clientY/e*i);he.mouse.clientX=n.clientX,he.mouse.clientY=n.clientY,he.mouse.gridX=o,he.mouse.gridY=r}function Ka(){q.window.gridWidth=Math.floor(window.innerWidth/q.cellSize),q.window.gridHeight=Math.floor(window.innerHeight/q.cellSize),q.drawArray=new Float32Array(q.window.gridWidth*q.window.gridHeight)}function Vu(){return q.drawArray}function dx(n){const t=q.window.gridWidth;let e="";for(let s=0;s<n.length;s+=t){const i=Array.from(n.slice(s,s+t));e+=i.join(" ")+`
`}console.log(e)}function Cu(n){if(q.initialized)throw new Error("Input already initialized.");return q.config=n,q.proxy=Ru(he),q.initialized=!0,q.cellSize=n.core.grid.cellSize,he.tickRate=n.input.tickRate,Ka(),window.addEventListener("resize",()=>{Ka(),q.alertIssued||(alert("Window resizing not yet supported by input module. Please refresh the page."),q.alertIssued=!0)}),document.addEventListener("mousedown",Za),document.addEventListener("mousedown",Qa),document.addEventListener("mousemove",ux),document.addEventListener("mousemove",Qa),document.addEventListener("mouseup",Za),q.proxy}function px(n,t){const e=q.config.input.decay*Math.PI*q.config.input.brushSize^2;q.drawArray.fill(0);for(const{x:s,y:i}of q.drawBuffer){const o=i*q.window.gridWidth+s;q.drawArray[o]=1}for(;q.drawBuffer.length>0&&q.decayCounter<e;)q.drawBuffer.shift(),q.decayCounter++;q.decayCounter=0}const mx=Object.freeze(Object.defineProperty({__proto__:null,GetDrawArray:Vu,Init:Cu,PrintDrawArray:dx,Tick:px},Symbol.toStringTag,{value:"Module"}));function fx(n){return new Float32Array([-n,-n,n,-n,n,n,-n,-n,n,n,-n,n])}function Eu(n,t){let e=0;const s=1e3/t.tickRate;function i(o){const r=o-e;r>=s&&(e=o,n.Tick(t,r)),requestAnimationFrame(i)}requestAnimationFrame(i)}const Gn=ku(),Ii=await oh(Gn),gx=Cu(Gn);Ii.drawArray=Vu();const yx=fx(Gn.core.grid.cellRatio);ih(Ii,yx);th(Ii,Gn.renderer.fps);rh(Ii);Eu(ed,Ii);Eu(mx,gx);
